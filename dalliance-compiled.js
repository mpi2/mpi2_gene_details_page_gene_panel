function getLocationForMgi(){console.debug("http://www.sanger.ac.uk/mouseportal/solr/select?q=MGI:105369&wt=json");this.doCrossDomainRequest("http://www.sanger.ac.uk/mouseportal/solr/select?q=MGI:105369&wt=json",function(a){if(!a)return callback([]);for(var b=[],a=a.getElementsByTagName("SEGMENT"),c=0;c<a.length;++c){var e=a[c],d=e.getAttribute("id"),f=e.getAttribute("size"),h;f?h=1:(h=e.getAttribute("start"),f=e.getAttribute("stop"));var g=null;e.firstChild&&(g=e.firstChild.nodeValue);b.push(new DASSegment(d,
h,f,g))}callback(b)})}function doCrossDomainRequest(a,b,c){if(window.XDomainRequest){var e=new XDomainRequest;e.onload=function(){var a=new ActiveXObject("Microsoft.XMLDOM");a.async=!1;a.loadXML(e.responseText);b(a)};e.open("get",a)}else e=new XMLHttpRequest,e.onreadystatechange=function(){4==e.readyState&&(200==e.status||0==e.status)&&b(e.responseXML,e)},e.open("get",a,!0),c&&(e.withCredentials=!0);e.send("")}
DASSource.prototype.doCrossDomainRequest=function(a,b){return doCrossDomainRequest(a,b,this.credentials)};var BAM_MAGIC=21840194,BAI_MAGIC=21578050;function BamFile(){}function Vob(a,b){this.block=a;this.offset=b}Vob.prototype.toString=function(){return""+this.block+":"+this.offset};function Chunk(a,b){this.minv=a;this.maxv=b}
function makeBam(a,b,c){var e=new BamFile;e.data=a;e.bai=b;e.data.slice(0,65536).fetch(function(a){if(!a)return dlog("Couldn't access BAM");a=unbgzf(a);a=new Uint8Array(a);readInt(a,0);for(var b=readInt(a,4),h="",g=0;g<b;++g)h+=String.fromCharCode(a[g+8]);h=readInt(a,b+8);b+=12;e.chrToIndex={};e.indexToChr=[];for(g=0;g<h;++g){for(var j=readInt(a,b),m="",u=0;u<j-1;++u)m+=String.fromCharCode(a[b+4+u]);readInt(a,b+j+4);e.chrToIndex[m]=g;0==m.indexOf("chr")?e.chrToIndex[m.substring(3)]=g:e.chrToIndex["chr"+
m]=g;e.indexToChr.push(m);b=b+8+j}if(e.indices)return c(e)});e.bai.fetch(function(a){if(!a)return dlog("Couldn't access BAI");var b=new Uint8Array(a);if(readInt(b,0)!=BAI_MAGIC)return dlog("Not a BAI file");var h=readInt(b,4);e.indices=[];for(var g=8,j=0;j<h;++j){for(var m=g,u=readInt(b,g),g=g+4,s=0;s<u;++s){readInt(b,g);var o=readInt(b,g+4),g=g+(8+16*o)}s=readInt(b,g);g+=4;g+=8*s;0<u&&(e.indices[j]=new Uint8Array(a,m,g-m))}if(e.chrToIndex)return c(e)})}
BamFile.prototype.blocksForRange=function(a,b,c){var e=this.indices[a];if(!e)return[];for(var a=reg2bins(b,c),d=[],f=0;f<a.length;++f)d[a[f]]=!0;for(var a=[],h=[],f=readInt(e,0),g=4,j=0;j<f;++j){var m=readInt(e,g),u=readInt(e,g+4),g=g+8;if(d[m])for(var s=0;s<u;++s){var o=readVob(e,g),p=readVob(e,g+8);(4681>m?h:a).push(new Chunk(o,p));g+=16}else g+=16*u}f=readInt(e,g);d=null;b=Math.min(b>>14,f-1);c=Math.min(c>>14,f-1);for(f=b;f<=c;++f)if((b=readVob(e,g+4+8*f))&&(!d||b.block<d.block||b.offset<d.offset))d=
b;e=[];if(null!=d)for(f=0;f<h.length;++f)c=h[f],c.maxv.block>=d.block&&c.maxv.offset>=d.offset&&e.push(c);h=e;e=[];for(f=0;f<h.length;++f)e.push(h[f]);for(f=0;f<a.length;++f)e.push(a[f]);e.sort(function(a,b){var c=a.minv.block-b.minv.block;return 0!=c?c:a.minv.offset-b.minv.offset});a=[];if(0<e.length){h=e[0];for(f=1;f<e.length;++f)c=e[f],c.minv.block==h.maxv.block?h=new Chunk(h.minv,c.maxv):(a.push(h),h=c);a.push(h)}return a};
BamFile.prototype.fetch=function(a,b,c,e){function d(){if(m>=g.length)return e(j);if(u){var a=new Uint8Array(u);f.readBamRecords(a,g[m].minv.offset,j,b,c,h);u=null;++m;return d()}var o=g[m],a=o.minv.block;f.data.slice(a,o.maxv.block+65536-a).fetch(function(a){u=unbgzf(a,o.maxv.block-o.minv.block+1);return d()})}var f=this,h=this.chrToIndex[a],g;void 0===h?g=[]:(g=this.blocksForRange(h,b,c))||e(null,"Error in index fetch");var j=[],m=0,u;d()};
var SEQRET_DECODER="=ACxGxxxTxxxxxxN".split(""),CIGAR_DECODER="MIDNSHP=X???????".split("");function BamRecord(){}
BamFile.prototype.readBamRecords=function(a,b,c,e,d,f){for(;;){var h=readInt(a,b),h=b+h+4;if(h>=a.length)return c;var g=new BamRecord,j=readInt(a,b+4),m=readInt(a,b+8),u=readInt(a,b+12),s=(u&65280)>>8,o=u&255,p=readInt(a,b+16)&65535,u=readInt(a,b+20);readInt(a,b+24);readInt(a,b+28);readInt(a,b+32);for(var r="",w=0;w<o-1;++w)r+=String.fromCharCode(a[b+36+w]);b=b+36+o;w="";for(o=0;o<p;++o)var v=readInt(a,b),w=w+(v>>4)+CIGAR_DECODER[v&15],b=b+4;g.cigar=w;p="";o=u+1>>1;for(w=0;w<o;++w)v=a[b+w],p+=SEQRET_DECODER[(v&
240)>>4],p+=SEQRET_DECODER[v&15];b+=o;g.seq=p;p="";for(w=0;w<u;++w)p+=String.fromCharCode(a[b+w]);b+=u;g.quals=p;g.pos=m;g.mq=s;g.readName=r;for(g.segment=this.indexToChr[j];b<h;){m=String.fromCharCode(a[b])+String.fromCharCode(a[b+1]);s=String.fromCharCode(a[b+2]);if("A"==s)s=String.fromCharCode(a[b+3]),b+=4;else if("i"==s||"I"==s)s=readInt(a,b+3),b+=7;else if("c"==s||"C"==s)s=a[b+3],b+=4;else if("s"==s||"S"==s)s=readShort(a,b+3),b+=5;else{if("f"==s)throw"FIXME need floats";if("Z"==s){b+=3;for(s=
"";!(r=a[b++],0==r);)s+=String.fromCharCode(r)}else throw"Unknown type "+s;}g[m]=s}if(!e||g.pos<=d&&g.pos+u>=e)(void 0===f||j==f)&&c.push(g);b=h}};function readInt(a,b){return a[b+3]<<24|a[b+2]<<16|a[b+1]<<8|a[b]}function readShort(a,b){return a[b+1]<<8|a[b]}function readVob(a,b){var c=4294967296*(a[b+6]&255)+16777216*(a[b+5]&255)+65536*(a[b+4]&255)+256*(a[b+3]&255)+(a[b+2]&255),e=a[b+1]<<8|a[b];return 0==c&&0==e?null:new Vob(c,e)}
function unbgzf(a,b){for(var b=Math.min(b||1,a.byteLength-100),c=[],e=[0],d=0;e[0]<b;){var f=new Uint8Array(a,e[0],100),f=f[11]<<8|f[10],f=jszlib_inflate_buffer(a,12+f+e[0],Math.min(65536,a.byteLength-12-f-e[0]),e);e[0]+=8;d+=f.byteLength;c.push(f)}if(1==c.length)return c[0];e=new Uint8Array(d);for(f=d=0;f<c.length;++f){var h=new Uint8Array(c[f]);arrayCopy(h,0,e,d,h.length);d+=h.length}return e.buffer}
function reg2bin(a,b){--b;return a>>14==b>>14?4681+(a>>14):a>>17==b>>17?585+(a>>17):a>>20==b>>20?73+(a>>20):a>>23==b>>23?9+(a>>23):a>>26==b>>26?1+(a>>26):0}var MAX_BIN=37449;function reg2bins(a,b){var c,e=[];--b;e.push(0);for(c=1+(a>>26);c<=1+(b>>26);++c)e.push(c);for(c=9+(a>>23);c<=9+(b>>23);++c)e.push(c);for(c=73+(a>>20);c<=73+(b>>20);++c)e.push(c);for(c=585+(a>>17);c<=585+(b>>17);++c)e.push(c);for(c=4681+(a>>14);c<=4681+(b>>14);++c)e.push(c);return e}
var BIG_WIG_MAGIC=-2003829722,BIG_BED_MAGIC=-2021002517,BIG_WIG_TYPE_GRAPH=1,BIG_WIG_TYPE_VSTEP=2,BIG_WIG_TYPE_FSTEP=3;function BigWig(){}
BigWig.prototype.readChromTree=function(a){var b=this;this.chromsToIDs={};this.idsToChroms={};for(var c=this.unzoomedDataOffset;0!=c%4;)++c;this.data.slice(this.chromTreeOffset,c-this.chromTreeOffset).fetch(function(c){var d=new Uint8Array(c),f=new Int16Array(c),h=new Int32Array(c),g=h[2],j=function(a){for(var c=d[a],e=f[a/2+1],a=a+4,o=0;o<e;++o)if(0==c){var a=a+g,p=h[a/4]<<32|h[a/4+1],a=a+8,p=p-b.chromTreeOffset;j(p)}else{for(var p="",r=0;r<g;++r){var w=d[a++];0!=w&&(p+=String.fromCharCode(w))}r=
d[a+3]<<24|d[a+2]<<16|d[a+1]<<8|d[a+0];a+=8;b.chromsToIDs[p]=r;0==p.indexOf("chr")&&(b.chromsToIDs[p.substr(3)]=r);b.idsToChroms[r]=p}};j(32);a(b)})};function BigWigView(a,b,c,e){this.bwg=a;this.cirTreeOffset=b;this.cirTreeLength=c;this.isSummary=e}BigWigView.prototype.readWigData=function(a,b,c,e){a=this.bwg.chromsToIDs[a];if(void 0===a)return e([]);this.readWigDataById(a,b,c,e)};
BigWigView.prototype.readWigDataById=function(a,b,c,e){var d=this;if(this.cirHeader){var f=[],h=0;Date.now();var g=function(a,b){h+=a.length;for(var c=4+32*d.cirBlockSize,e,f=0;f<a.length;++f){var g=new Range(a[f],Math.min(a[f]+c,d.cirTreeOffset+d.cirTreeLength));e=e?union(e,g):g}c=e.ranges();for(e=0;e<c.length;++e)j(a,c[e],b)},j=function(e,j,o){j.max();j.min();d.bwg.data.slice(j.min(),j.max()-j.min()).fetch(function(d){for(var r=0;r<e.length;++r)if(j.contains(e[r])){var w=d,v=e[r]-j.min(),t=o,q=
new Int8Array(w),z=new Int16Array(w),w=new Int32Array(w),q=q[v],z=z[v/2+1],v=v+4;if(0!=q)for(q=0;q<z;++q){var x=v/4,C=w[x],E=w[x+1],A=w[x+2],G=w[x+3],B=w[x+4]<<32|w[x+5],t=w[x+6]<<32|w[x+7];(C<a||C==a&&E<=c)&&(A>a||A==a&&G>=b)&&f.push({offset:B,size:t});v+=32}else{for(var y=[],q=0;q<z;++q)x=v/4,C=w[x],E=w[x+1],A=w[x+2],G=w[x+3],B=w[x+4]<<32|w[x+5],(C<a||C==a&&E<=c)&&(A>a||A==a&&G>=b)&&y.push(B),v+=24;0<y.length&&g(y,t+1)}--h;0==h&&m()}})},m=function(){f.sort(function(a,b){return(a.offset|0)-(b.offset|
0)});if(0==f.length)e([]);else{var g=[],h=function(b,c,e){e||(e={});var f=new DASFeature;f.segment=d.bwg.idsToChroms[a];f.min=b;f.max=c;f.type="bigwig";for(k in e)f[k]=e[k];g.push(f)},j=function(a,d,e){a<=c&&d>=b&&h(a,d,e)},m=function(){if(0==f.length)Date.now(),e(g);else{var r=f[0];if(r.data){var w=new Uint8Array(r.data);if(d.isSummary)for(var v=new Int16Array(r.data),t=new Int32Array(r.data),q=new Float32Array(r.data),w=r.data.byteLength/32,v=0;v<w;++v){var z=t[8*v],r=t[8*v+1],x=t[8*v+2],C=t[8*
v+3],E=q[8*v+6];z==a&&(z={type:"bigwig",score:E/C},"bigbed"==d.bwg.type&&(z.type="density"),j(r,x,z))}else if("bigwig"==d.bwg.type)if(v=new Int16Array(r.data),t=new Int32Array(r.data),q=new Float32Array(r.data),z=t[0],r=t[1],z=t[3],x=t[4],C=w[20],w=v[11],C==BIG_WIG_TYPE_FSTEP)for(v=0;v<w;++v)C=q[v+6],j(r+v*z,r+v*z+x,{score:C});else if(C==BIG_WIG_TYPE_VSTEP)for(v=0;v<w;++v)r=t[2*v+6],C=q[2*v+7],j(r,r+x,{score:C});else if(C==BIG_WIG_TYPE_GRAPH)for(v=0;v<w;++v)r=t[3*v+6],x=t[3*v+7],C=q[3*v+8],j(r,x,
{score:C});else dlog("Currently not handling bwgType="+C);else if("bigbed"==d.bwg.type)for(t=0;t<w.length;){z=w[t+3]<<24|w[t+2]<<16|w[t+1]<<8|w[t+0];r=w[t+7]<<24|w[t+6]<<16|w[t+5]<<8|w[t+4];x=w[t+11]<<24|w[t+10]<<16|w[t+9]<<8|w[t+8];t+=12;for(v="";;)if(q=w[t++],0!=q)v+=String.fromCharCode(q);else break;var q={},A=v.split("\t");0<A.length&&(q.label=A[0]);1<A.length&&(q.score=100);2<A.length&&(q.orientation=A[2]);if(9>A.length)z==a&&j(r+1,x,q);else if(z==a&&r<=c&&x>=b){x=A[3]|0;z=A[4]|0;v=A[6]|0;C=
A[7].split(",");E=A[8].split(",");q.type="bb-transcript";var G=new DASGroup;G.id=A[0];G.type="bb-transcript";G.notes=[];q.groups=[G];if(10<A.length){var G=A[9],A=A[10],B=new DASGroup;B.id=G;B.label=A;B.type="gene";q.groups.push(B)}A=null;for(G=0;G<v;++G)B=(E[G]|0)+r,B=new Range(B,B+(C[G]|0)),A=A?union(A,B):B;C=A.ranges();for(r=0;r<C.length;++r)v=C[r],h(v.min()+1,v.max(),q);if(r=intersection(A,new Range(x,z))){q.type="bb-translation";x=r.ranges();for(r=0;r<x.length;++r)v=x[r],h(v.min()+1,v.max(),q)}}}else dlog("Don't know what to do with "+
d.bwg.type);f.splice(0,1);m()}else{for(var w=r.offset,y=r.size,r=1;r<f.length&&f[r].offset==w+y;)y+=f[r].size,++r;d.bwg.data.slice(w,y).fetch(function(a){for(var b=0,c=0;b<y;){var e=f[c],g;0<d.bwg.uncompressBufSize?g=jszlib_inflate_buffer(a,b+2,e.size-2):(g=new Uint8Array(e.size),arrayCopy(new Uint8Array(a,b,e.size),0,g,0,e.size),g=g.buffer);e.data=g;b+=e.size;++c}m()})}}};m()}};g([d.cirTreeOffset+48],1)}else this.bwg.data.slice(this.cirTreeOffset,48).fetch(function(f){d.cirHeader=f;f=new Int32Array(d.cirHeader);
d.cirBlockSize=f[1];d.readWigDataById(a,b,c,e)})};BigWig.prototype.readWigData=function(a,b,c,e){this.getUnzoomedView().readWigData(a,b,c,e)};BigWig.prototype.getUnzoomedView=function(){this.unzoomedView||(this.unzoomedView=new BigWigView(this,this.unzoomedIndexOffset,this.zoomLevels[0].dataOffset-this.unzoomedIndexOffset,!1));return this.unzoomedView};
BigWig.prototype.getZoomedView=function(a){var b=this.zoomLevels[a];b.view||(b.view=new BigWigView(this,b.indexOffset,this.zoomLevels[a+1].dataOffset-b.indexOffset,!0));return b.view};function makeBwgFromURL(a,b,c){makeBwg(new URLFetchable(a,{credentials:c}),b,a)}function makeBwgFromFile(a,b){makeBwg(new BlobFetchable(a),b,"file")}
function makeBwg(a,b,c){var e=new BigWig;e.data=a;e.name=c;e.data.slice(0,512).fetch(function(a){if(!a)return b(null,"Couldn't fetch file");var c=new Int16Array(a),a=new Int32Array(a);a[0]==BIG_WIG_MAGIC?e.type="bigwig":a[0]==BIG_BED_MAGIC?e.type="bigbed":b(null,"Not a supported format");e.version=c[2];e.numZoomLevels=c[3];e.chromTreeOffset=a[2]<<32|a[3];e.unzoomedDataOffset=a[4]<<32|a[5];e.unzoomedIndexOffset=a[6]<<32|a[7];e.fieldCount=c[16];e.definedFieldCount=c[17];e.asOffset=a[9]<<32|a[10];e.totalSummaryOffset=
a[11]<<32|a[12];e.uncompressBufSize=a[13];e.zoomLevels=[];for(c=0;c<e.numZoomLevels;++c)e.zoomLevels.push({reduction:a[6*c+16],dataOffset:a[6*c+18]<<32|a[6*c+19],indexOffset:a[6*c+20]<<32|a[6*c+21]});e.readChromTree(function(){return b(e)})})}function BlobFetchable(a){this.blob=a}BlobFetchable.prototype.slice=function(a,b){var c;c=b?this.blob.slice(a,b):this.blob.slice(a);return new BlobFetchable(c)};
BlobFetchable.prototype.fetch=function(a){var b=new FileReader;b.onloadend=function(){a(bstringToBuffer(b.result))};b.readAsBinaryString(this.blob)};function URLFetchable(a,b,c,e){e||("object"===typeof b?(e=b,b=void 0):e={});this.url=a;this.start=b||0;c&&(this.end=c);this.opts=e}URLFetchable.prototype.slice=function(a,b){var c=this.start,e=this.end,c=c&&a?c+a:a||c;return new URLFetchable(this.url,c,b&&c?c+b-1:e||b-1,this.opts)};
URLFetchable.prototype.fetch=function(a,b,c){var e=this,b=b||1;if(3<b)return a(null);var d=new XMLHttpRequest,f;d.open("GET",this.url,!0);d.overrideMimeType("text/plain; charset=x-user-defined");this.end&&(d.setRequestHeader("Range","bytes="+this.start+"-"+this.end),f=this.end-this.start+1);d.responseType="arraybuffer";d.onreadystatechange=function(){if(d.readyState==4){if(d.status==200||d.status==206){if(d.response)return a(d.response);if(d.mozResponseArrayBuffer)return a(d.mozResponseArrayBuffer);
var h=d.responseText;return f&&f!=h.length&&(!c||h.length!=c)?e.fetch(a,b+1,h.length):a(bstringToBuffer(d.responseText))}return e.fetch(a,b+1)}};this.opts.credentials&&(d.withCredentials=!0);d.send("")};function bstringToBuffer(a){if(!a)return null;for(var b=new Uint8Array(a.length),c=0;c<b.length;++c)b[c]=a.charCodeAt(c);return b.buffer}var NS_SVG="http://www.w3.org/2000/svg",NS_HTML="http://www.w3.org/1999/xhtml",NS_XLINK="http://www.w3.org/1999/xlink";MAX_VIEW_SIZE=5E5;
function Browser(a){a||(a={});this.sources=[];this.tiers=[];this.cookieKey="browser";this.karyoEndpoint=new DASSource("http://www.derkholm.net:8080/das/hsa_54_36p/");this.registry="http://www.dasregistry.org/das/sources";this.coordSystem={speciesName:"Human",taxon:9606,auth:"NCBI",version:"36"};this.chains={};this.exportServer="http://www.biodalliance.org:8765/";this.pageName="svgHolder";this.maxExtra=1.5;this.minExtra=0.2;this.zoomFactor=1;this.origin=0;this.targetQuantRes=5;this.featurePanelWidth=
750;this.zoomBase=100;this.zoomExpt=30;this.entryPoints=null;this.currentSeqMax=-1;this.highlight=!1;this.highlightMax=this.highlightMin=-1;this.autoSizeTiers=!1;this.guidelineStyle="foreground";this.guidelineSpacing=75;this.fgGuide=null;this.positionFeedback=!1;this.placards=[];this.tierBackgroundColors=["rgb(245,245,245)","rgb(230,230,250)"];this.minTierHeight=25;this.tabMargin=120;this.browserLinks={Ensembl:"http://ncbi36.ensembl.org/Homo_sapiens/Location/View?r=${chr}:${start}-${end}",UCSC:"http://genome.ucsc.edu/cgi-bin/hgTracks?db=hg18&position=chr${chr}:${start}-${end}"};
this.iconsURI="http://www.biodalliance.org/resources/icons.svg";this.availableSources=new Observed;this.defaultSources=[];this.mappableSources={};for(var b in a)this[b]=a[b];var c=this;window.addEventListener("load",function(){c.realInit()},!1)}function formatQuantLabel(a){var a=""+a,b=a.indexOf(".");if(0>b)return a;var c=2;"-"==a.substring(0,1)&&++c;return b>=c?a.substring(0,b):a.substring(0,b+2)}
Browser.prototype.labelForTier=function(a,b,c){var e=this.tabMargin,d=document.createElementNS(NS_SVG,"path");d.setAttribute("d","M 15 2 L 10 7 L 10 18 L 15 22 L "+(10+e)+" 22 L "+(10+e)+" 2 Z");d.setAttribute("fill",this.tierBackgroundColors[b%this.tierBackgroundColors.length]);d.setAttribute("stroke","none");c.appendChild(d);this.setupTierDrag(d,b);e=!1;if(a.dasSource.collapseSuperGroups||a.hasBumpedFeatures)e=!0,this.makeToggleButton(c,a,0);if(a.isQuantitative){e=!0;d=makeElementNS(NS_SVG,"g");
d.appendChild(makeElementNS(NS_SVG,"rect",null,{x:this.tabMargin-25,y:0,width:25,height:a.layoutHeight,stroke:"none",fill:this.tierBackgroundColors[b%this.tierBackgroundColors.length]}));c.appendChild(d);d.appendChild(makeElementNS(NS_SVG,"line",null,{x1:this.tabMargin,y1:0+(a.clientMin|0),x2:this.tabMargin,y2:0+(a.clientMax|0),strokeWidth:1}));d.appendChild(makeElementNS(NS_SVG,"line",null,{x1:this.tabMargin-5,y1:0+(a.clientMin|0),x2:this.tabMargin,y2:0+(a.clientMin|0),strokeWidth:1}));d.appendChild(makeElementNS(NS_SVG,
"line",null,{x1:this.tabMargin-3,y1:0+((a.clientMin|0)+(a.clientMax|0))/2,x2:this.tabMargin,y2:0+((a.clientMin|0)+(a.clientMax|0))/2,strokeWidth:1}));d.appendChild(makeElementNS(NS_SVG,"line",null,{x1:this.tabMargin-5,y1:0+(a.clientMax|0),x2:this.tabMargin,y2:0+(a.clientMax|0),strokeWidth:1}));var f=makeElementNS(NS_SVG,"text",formatQuantLabel(a.min),{x:80,y:a.clientMin|0,strokeWidth:0,fill:"black",fontSize:"8pt"});d.appendChild(f);b=f.getBBox();f.setAttribute("x",this.tabMargin-b.width-7);f.setAttribute("y",
(a.clientMin|0)+b.height/2-4);f=makeElementNS(NS_SVG,"text",formatQuantLabel(a.max),{x:80,y:a.clientMax|0,strokeWidth:0,fill:"black",fontSize:"8pt"});d.appendChild(f);f.setAttribute("x",this.tabMargin-f.getBBox().width-3);b=f.getBBox();f.setAttribute("x",this.tabMargin-b.width-7);f.setAttribute("y",(a.clientMax|0)+b.height/2-1);var h=this.icons.createIcon("magnifier",c);h.setAttribute("transform","translate("+(this.tabMargin-18)+", "+(a.layoutHeight/2-8)+"), scale(0.6,0.6)");h.addEventListener("mouseover",
function(){h.setAttribute("fill","red")},!1);h.addEventListener("mouseout",function(){h.setAttribute("stroke","gray")},!1);d.appendChild(h);this.makeQuantConfigButton(d,a,0);this.makeTooltip(d,"Click to adjust how this data is displayed")}d=this.tabMargin-20;e&&(d-=20);a=a.dasSource.name;e=document.createElementNS(NS_SVG,"text");e.setAttribute("x",15);e.setAttribute("y",17);e.setAttribute("stroke-width",0);e.setAttribute("fill","black");e.appendChild(document.createTextNode(a));e.setAttribute("pointer-events",
"none");for(c.appendChild(e);e.getBBox().width>d;)removeChildren(e),a=a.substring(0,a.length-1),e.appendChild(document.createTextNode(a+"..."));return c};
Browser.prototype.arrangeTiers=function(){for(var a=this.svgRoot,b=0;b<this.placards.length;++b)a.removeChild(this.placards[b]);this.placards=[];var b=this.dasLabelHolder,c=50;for(ti=0;ti<this.tiers.length;++ti){var e=this.tiers[ti];e.y=c;e.isLabelValid||(e.label&&b.removeChild(e.label),e.label=makeElementNS(NS_SVG,"g"),b.appendChild(e.label),this.labelForTier(e,ti,e.label));this.xfrmTier(e,this.tabMargin-1*(this.viewStart-this.origin)*this.scale,-1);e.placard&&(e.placard.setAttribute("transform",
"translate("+this.tabMargin+", "+(c+e.layoutHeight-4)+")"),a.appendChild(e.placard),this.placards.push(e.placard));c+=e.layoutHeight}this.featureBackground.setAttribute("height",(c|0)-50);150>c&&(c=150);this.browserFrameHeight!=c&&(this.svgRoot.setAttribute("height",""+((c|0)+10)+"px"),this.svgBackground.setAttribute("height",""+((c|0)+10)),this.featureClipRect.setAttribute("height",""+((c|0)-10)),this.labelClipRect.setAttribute("height",""+((c|0)-10)),this.browserFrameHeight=c)};
Browser.prototype.offsetForTier=function(a){for(var b=50,c=0;c<a;++c)b+=this.tiers[c].layoutHeight;return b};
Browser.prototype.tierInfoPopup=function(a,b){var c,e=[];a.dasSource.desc&&e.push(a.dasSource.desc);var d=this.availableSources.get();a.dasSource.mapping&&(d=this.chains[a.dasSource.mapping].coords,e.push(makeElement("p",makeElement("i","Mapped from "+d.auth+d.version))),d=this.mappableSources[a.dasSource.mapping].get());if(!d||0==d)c=makeElement("p","Registry data not available");else{for(var f=0;f<d.length;++f){var h=d[f];if(h.uri==a.dasSource.uri&&h.source_uri){c=makeElement("p",makeElement("a",
"Registry entry: "+h.name,{href:"http://www.dasregistry.org/showdetails.jsp?auto_id="+h.source_uri,target:"_new"}));break}}c||(c=makeElement("p","No registry information for this source"))}e.push(c);this.popit(b,a.dasSource.name,e,{width:300})};
Browser.prototype.setupTierDrag=function(a,b){var c=this,e,d,f,h=null,g=this.tiers[b],j=function(a){for(var a=(a.clientY+window.scrollY-e|0)-50,b=0;b<c.tiers.length&&a>c.tiers[b].layoutHeight;)a-=c.tiers[b].layoutHeight,++b;b!=f&&(f=b,d.setAttribute("y",c.offsetForTier(f)-2))},m=!1,u=function(){c.bin.setAttribute("stroke","red");d.setAttribute("fill","none");m=!0},s=function(){c.bin.setAttribute("stroke","gray");d.setAttribute("fill","red");m=!1},o=function(a){window.removeEventListener("mousemove",
j,!0);window.removeEventListener("mouseup",o,!0);c.bin.removeEventListener("mouseover",u,!0);c.bin.removeEventListener("mouseout",s,!0);c.bin.setAttribute("stroke","gray");if(h)clearTimeout(h),h=null,c.tierInfoPopup(g,a);else if(c.popupHolder.removeChild(d),m)c.removeTier(c.tiers[b]);else if(f!=b){var a=[],e=0;for(f>b&&--f;a.length<c.tiers.length;)a.length==f?a.push(c.tiers[b]):(e!=b&&a.push(c.tiers[e]),++e);c.tiers=a;c.knownSpace&&(c.knownSpace.tierMap=c.tiers);for(a=0;a<c.tiers.length;++a)c.tiers[a].background.setAttribute("fill",
c.tierBackgroundColors[a%c.tierBackgroundColors.length]),c.tiers[a].isLabelValid=!1;c.arrangeTiers();c.storeStatus()}};a.addEventListener("mousedown",function(a){c.removeAllPopups();a.stopPropagation();a.preventDefault();e=c.svgHolder.getBoundingClientRect().top+window.scrollY;window.addEventListener("mousemove",j,!0);window.addEventListener("mouseup",o,!0);c.bin.addEventListener("mouseover",u,!0);c.bin.addEventListener("mouseout",s,!0);f=b;d=makeElementNS(NS_SVG,"rect",null,{x:c.tabMargin,y:c.offsetForTier(f)-
2,width:c.featurePanelWidth,height:4,fill:"red",stroke:"none"});h=setTimeout(function(){h=null;c.popupHolder.appendChild(d)},200)},!0)};
Browser.prototype.makeToggleButton=function(a,b,c){var e=makeElementNS(NS_SVG,"g",null,{fill:"cornsilk",strokeWidth:1,stroke:"gray"});e.appendChild(makeElementNS(NS_SVG,"rect",null,{x:this.tabMargin-15,y:c+8,width:8,height:8}));e.appendChild(makeElementNS(NS_SVG,"line",null,{x1:this.tabMargin-15,y1:c+12,x2:this.tabMargin-7,y2:c+12}));b.bumped||e.appendChild(makeElementNS(NS_SVG,"line",null,{x1:this.tabMargin-11,y1:c+8,x2:this.tabMargin-11,y2:c+16}));a.appendChild(e);e.addEventListener("mouseover",
function(){e.setAttribute("stroke","red")},!1);e.addEventListener("mouseout",function(){e.setAttribute("stroke","gray")},!1);e.addEventListener("mousedown",function(){b.bumped=!b.bumped;b.layoutWasDone=!1;b.isLabelValid=!1;b.draw()},!1);this.makeTooltip(e,"Click to "+(b.bumped?"collapse":"expand"))};Browser.prototype.updateRegion=function(){if(!this.updateRegionBaton){var a=this;this.updateRegionBaton=setTimeout(function(){a.updateRegionBaton=null;a.realUpdateRegion()},25)}};
Browser.prototype.realUpdateRegion=function(){var a=this.chr;0>a.indexOf("chr")&&(a="chr"+a);var b=a+":"+(this.viewStart|0)+".."+(this.viewEnd|0);removeChildren(this.regionLabel);this.regionLabel.appendChild(document.createTextNode(b));b=this.regionLabel.getBBox();b=b.x+b.width;this.regionLabelMax&&b>this.regionLabelMax&&(removeChildren(this.regionLabel),this.regionLabel.appendChild(document.createTextNode(a)))};
Browser.prototype.refresh=function(){var a=this.viewEnd-this.viewStart+1,b=a*this.minExtra|0,a=a*this.maxExtra|0,c=(this.viewStart+this.viewEnd)/2,e=c-this.origin;this.origin=c;this.scaleAtLastRedraw=this.scale;for(c=0;c<this.tiers.length;++c){var d=e;this.tiers[c].originHaxx&&(d+=this.tiers[c].originHaxx);this.tiers[c].originHaxx=d}e=this.targetQuantRes/this.scale;c=Math.max(1,(this.viewStart|0)-b);b=Math.min((this.viewEnd|0)+b,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9);d=Math.max(1,(this.viewStart|
0)-a);a=Math.min((this.viewEnd|0)+a,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9);if(!this.knownSpace||this.knownSpace.chr!==this.chr){for(var f=null,h=0;h<this.tiers.length;++h)if(this.tiers[h].sequenceSource){f=this.tiers[h].sequenceSource;break}this.knownSpace=new KnownSpace(this.tiers,this.chr,d,a,e,f)}(f=this.knownSpace.bestCacheOverlapping(this.chr,c,b))&&f.min<=c&&f.max>=b?(this.drawnStart=Math.max(f.min,d),this.drawnEnd=Math.min(f.max,a)):(this.drawnStart=d,this.drawnEnd=a);this.knownSpace.viewFeatures(this.chr,
this.drawnStart,this.drawnEnd,e)};
Browser.prototype.mouseDownHandler=function(a){var b=this;this.removeAllPopups();a.stopPropagation();a.preventDefault();for(var c=document.elementFromPoint(a.clientX,a.clientY);c&&!c.dalliance_feature&&!c.dalliance_group;)c=c.parentNode;if(c&&(c.dalliance_feature||c.dalliance_group))if(this.dcTimeoutID&&c.dalliance_feature){var e=c.dalliance_feature,d=this.svgHolder.getBoundingClientRect(),d=((e.min|0)-(this.viewStart|0))*this.scale+d.left+this.tabMargin,f=(e.max-e.min+1)*this.scale;clearTimeout(this.dcTimeoutID);
this.dcTimeoutID=null;e=((c.dalliance_feature.min|0)+(c.dalliance_feature.max|0))/2;10<f&&(d=1*(a.clientX-d)/f,0.3>d?e=c.dalliance_feature.min|0:0.7<d&&(e=(c.dalliance_feature.max|0)+1));d=this.viewEnd-this.viewStart;this.setLocation(e-d/2,e+d/2);e=this.featurePanelWidth-(d+1)*this.scale;1<Math.abs(e)&&this.move(e/2)}else this.dcTimeoutID=setTimeout(function(){b.dcTimeoutID=null;b.featurePopup(a,c.dalliance_feature,c.dalliance_group)},200);else this.originX=a.clientX,document.addEventListener("mousemove",
this.__mouseMoveHandler,!0),document.addEventListener("mouseup",this.__mouseUpHandler,!0),this.clickTestTB=setTimeout(function(){b.clickTestTB=null},200)};var TAGVAL_NOTE_RE=/^([A-Za-z]+)=(.+)/;
Browser.prototype.featurePopup=function(a,b,c){b||(b={});c||(c={});this.removeAllPopups();var e=makeElement("table",null);e.style.width="100%";var d=pick(c.type,b.type),f=pick(b.label,c.label,c.id,b.id);f&&0!=f.indexOf("__dazzle")&&(d=d+": "+f);f=0;if(b.method){var h=makeElement("tr",[makeElement("th","Method"),makeElement("td",b.method)]);h.style.backgroundColor=this.tierBackgroundColors[f%this.tierBackgroundColors.length];e.appendChild(h);++f}h=c.segment?c:b;h=makeElement("tr",[makeElement("th",
"Location"),makeElement("td",h.segment+":"+h.min+"-"+h.max)]);h.style.backgroundColor=this.tierBackgroundColors[f%this.tierBackgroundColors.length];e.appendChild(h);++f;void 0!==b.score&&(null!==b.score&&"-"!=b.score)&&(h=makeElement("tr",[makeElement("th","Score"),makeElement("td",""+b.score)]),h.style.backgroundColor=this.tierBackgroundColors[f%this.tierBackgroundColors.length],e.appendChild(h),++f);if((h=maybeConcat(c.links,b.links))&&0<h.length)h=makeElement("tr",[makeElement("th","Links"),makeElement("td",
h.map(function(a){return a.desc=="Cassette Image"?makeElement("div",makeElement("a",makeElement("img",a.desc,{width:320,src:a.uri}),{href:a.uri,target:"_new"})):makeElement("div",makeElement("a",a.desc,{href:a.uri,target:"_new"}))}))]),h.style.backgroundColor=this.tierBackgroundColors[f%this.tierBackgroundColors.length],e.appendChild(h),++f;b=maybeConcat(c.notes,b.notes);for(c=0;c<b.length;++c){var h="Note",g=b[c],j=g.match(TAGVAL_NOTE_RE);j&&(h=j[1],g=j[2]);h=makeElement("tr",[makeElement("th",h),
makeElement("td",g)]);h.style.backgroundColor=this.tierBackgroundColors[f%this.tierBackgroundColors.length];e.appendChild(h);++f}this.popit(a,d,e,{width:400})};
Browser.prototype.mouseUpHandler=function(a){var b=this;if(this.clickTestTB&&this.positionFeedback){var c=svgHolder.getBoundingClientRect(),e=makeElement("div",""+(1*(a.clientX-c.left-this.tabMargin)/this.scale+this.viewStart|0),{},{position:"absolute",top:""+(a.clientY+window.scrollY+20)+"px",left:""+Math.max(a.clientX+window.scrollX-30,20)+"px",backgroundColor:"rgb(250, 240, 220)",borderWidth:"1px",borderColor:"black",borderStyle:"solid",padding:"2px",maxWidth:"400px"});this.hPopupHolder.appendChild(e);
var d;d=function(){try{b.hPopupHolder.removeChild(e)}catch(a){}window.removeEventListener("mousemove",d,!1)};window.addEventListener("mousemove",d,!1)}a.stopPropagation();a.preventDefault();document.removeEventListener("mousemove",this.__mouseMoveHandler,!0);document.removeEventListener("mouseup",this.__mouseUpHandler,!0);this.storeStatus()};
Browser.prototype.mouseMoveHandler=function(a){a.stopPropagation();a.preventDefault();a.clientX!=this.originX&&(this.move(a.clientX-this.originX),this.originX=a.clientX)};Browser.prototype.removeAllPopups=function(){removeChildren(this.popupHolder);removeChildren(this.hPopupHolder)};function EPMenuItem(a){this.entryPoint=a;this.nums=stringToNumbersArray(a.name)}
Browser.prototype.makeHighlight=function(){this.highlight&&(this.dasTierHolder.removeChild(this.highlight),this.highlight=null);0<this.highlightMin&&(this.highlight=document.createElementNS(NS_SVG,"rect"),this.highlight.setAttribute("x",(this.highlightMin-this.origin)*this.scale),this.highlight.setAttribute("y",0),this.highlight.setAttribute("width",(this.highlightMax-this.highlightMin+1)*this.scale),this.highlight.setAttribute("height",1E4),this.highlight.setAttribute("stroke","none"),this.highlight.setAttribute("fill",
"red"),this.highlight.setAttribute("fill-opacity",0.15),this.highlight.setAttribute("pointer-events","none"),this.dasTierHolder.appendChild(this.highlight))};Browser.prototype.init=function(){};
Browser.prototype.realInit=function(a){a||(a={});this.supportsBinary="function"===typeof Int8Array;var b=this;this.defaultSources=[];for(var c=0;c<this.sources.length;++c)this.defaultSources.push(this.sources[c]);this.defaultChr=this.chr;this.defaultStart=this.viewStart;this.defaultEnd=this.viewEnd;this.icons=new IconSet(this.iconsURI);var e,d=!1,f=a=null,h=null,c={};if(location.search){for(var d=location.search.substring(1).split(/[&;]/),g=0;g<d.length;++g){var j=d[g].split("="),m=decodeURIComponent(j[0]),
u=null;1<j.length&&(u=decodeURIComponent(j[1]));c[m]=u}d=c.reset}g=localStorage["dalliance."+this.cookieKey+".version"];VERSION.CONFIG!=(g?g|0:-100)&&(d=!0);g=localStorage["dalliance."+this.cookieKey+".configHash"]||"";j=hex_sha1(miniJSONify(this.sources));j!=g&&(d=!0,localStorage["dalliance."+this.cookieKey+".configHash"]=j);this.cookieKey&&(localStorage["dalliance."+this.cookieKey+".view-chr"]&&!d)&&(a=localStorage["dalliance."+this.cookieKey+".view-chr"],f=localStorage["dalliance."+this.cookieKey+
".view-start"]|0,h=localStorage["dalliance."+this.cookieKey+".view-end"]|0);this.cookieKey&&(g=localStorage["dalliance."+this.cookieKey+".sources"])&&!d&&(e=JSON.parse(g));d=/([\d+,\w,\.,\_,\-]+):(\d+)[\-,\,](\d+)/;g=!1;c.chr&&(a=c.chr,f=c.min,h=c.max,g=!0);this.positionFeedback=c.positionFeedback||!1;guidelineConfig=c.guidelines||"foreground";"true"==guidelineConfig?this.guidelineStyle="background":STRICT_NUM_REGEXP.test(guidelineConfig)?(this.guidelineStyle="background",this.guidelineSpacing=guidelineConfig|
0):this.guidelineStyle=guidelineConfig;g||((regstr=c.r)||(regstr=c.segment||""),g=regstr.match(d),""!=regstr&&g&&(a=g[1],f=g[2]|0,h=g[3]|0),g=!0);h<f&&(h=f+1E4);if(g=(c.h||"").match(d))this.highlightMin=g[2]|0,this.highlightMax=g[3]|0;this.svgHolder=document.getElementById(this.pageName);this.svgRoot=makeElementNS(NS_SVG,"svg",null,{version:"1.1",width:"860px",height:"500px",id:"browser_svg"});removeChildren(this.svgHolder);this.svgHolder.appendChild(this.svgRoot);d="";for(c=-90;90>=c;c+=20)d=d+"M "+
(Math.max(0,c)-2)+" "+(Math.max(-c,0)-2)+" L "+(Math.min(100+c,100)+2)+" "+(Math.min(100-c,100)+2)+" ",d=d+"M "+Math.max(c,0)+" "+Math.min(c+100,100)+" L "+Math.min(c+100,100)+" "+Math.max(c,0)+" ";c=makeElementNS(NS_SVG,"pattern",makeElementNS(NS_SVG,"path",null,{stroke:"lightgray",strokeWidth:2,d:d}),{id:"bgpattern-"+this.pageName,x:0,y:0,width:100,height:100});c.setAttribute("patternUnits","userSpaceOnUse");this.svgRoot.appendChild(c);this.svgBackground=makeElementNS(NS_SVG,"rect",null,{id:"background",
fill:"white"});c=makeElementNS(NS_SVG,"g",this.svgBackground,{fillOpacity:1,stroke:"black",strokeWidth:"0.1cm",fontFamily:"helvetica",fontSize:"10pt"});this.svgRoot.appendChild(c);this.regionLabel=makeElementNS(NS_SVG,"text","chr???",{x:260,y:30,strokeWidth:0});c.appendChild(this.regionLabel);this.makeTooltip(this.regionLabel,"Click to jump to a new location or gene");d=this.icons.createButton("add-track",c,30,30);d.setAttribute("transform","translate(100, 10)");this.makeTooltip(d,"Add tracks from the DAS registry");
c.appendChild(d);g=this.icons.createButton("link",c,30,30);g.setAttribute("transform","translate(140, 10)");this.makeTooltip(g,"Follow links to other genome browsers");c.appendChild(g);j=this.icons.createButton("reset",c,30,30);j.setAttribute("transform","translate(180, 10)");this.makeTooltip(j,"Reset the browser to a default state");c.appendChild(j);m=this.icons.createButton("export",c,30,30);m.setAttribute("transform","translate(220, 10)");this.makeTooltip(m,"Export the current genome display as a vector graphics file");
c.appendChild(m);var s;m.addEventListener("mousedown",function(a){a.stopPropagation();a.preventDefault();var c=s&&s.displayed;b.removeAllPopups();if(!c){var c=document.implementation.createDocument(NS_SVG,"svg",null),d=b.svgRoot.getAttribute("width")|0;c.documentElement.setAttribute("width",d);c.documentElement.setAttribute("height",b.svgRoot.getAttribute("height"));var e=makeElementNS(NS_SVG,"g",null,{fontFamily:"helvetica"});c.documentElement.appendChild(e);var f=makeElementNS(NS_SVG,"text","Graphics from Dalliance "+
VERSION,{x:80,y:30,strokeWidth:0,fill:"black",fontSize:"12pt"});b.svgRoot.appendChild(f);var g=f.getBBox().width;b.svgRoot.removeChild(f);f.setAttribute("x",d-g-60);e.appendChild(f);d=b.chr;d.indexOf("chr")<0&&(d="chr"+d);e.appendChild(makeElementNS(NS_SVG,"text",d+":"+(b.viewStart|0)+".."+(b.viewEnd|0),{x:40,y:30,strokeWidth:0,fill:"black",fontSize:"12pt"}));e.appendChild(p.cloneNode(true));e.appendChild(b.dasLabelHolder.cloneNode(true));e.appendChild(o.cloneNode(true));e.appendChild(b.dasTierHolder.cloneNode(true));
var e=makeElement("input",null,{type:"radio",name:"format",value:"svg",checked:true}),d=makeElement("input",null,{type:"radio",name:"format",value:"pdf"}),i=makeElement("form",[makeElement("p","To work around restrictions on saving files from web applications, image export currently requires transmission of the browser's current state to a remote server.  Depending on connection speed, this can take a few seconds -- please be patient."),makeElement("p","The download links only work once, so if you wish to keep or share your exported images, please save a copy on your computer"),
e,"SVG",makeElement("br"),d,"PDF",makeElement("br"),makeElement("br"),makeElement("input",null,{type:"hidden",name:"svgdata",value:(new XMLSerializer).serializeToString(c)}),makeElement("input",null,{type:"submit"})],{action:b.exportServer+"browser-image.svg",method:"POST"});e.addEventListener("click",function(){i.setAttribute("action",b.exportServer+"browser-image.svg")},false);d.addEventListener("click",function(){i.setAttribute("action",b.exportServer+"browser-image.pdf")},false);i.addEventListener("submit",
function(){setTimeout(function(){b.removeAllPopups()},200);return true},false);s=b.popit(a,"Export",i,{width:400})}},!1);this.bin=this.icons.createIcon("bin",c);this.bin.setAttribute("transform","translate(10, 18)");c.appendChild(this.bin);this.makeTooltip(this.bin,"Drag tracks here to discard");this.featureClipRect=makeElementNS(NS_SVG,"rect",null,{x:this.tabMargin,y:50,width:850-this.tabMargin,height:440});var o=makeElementNS(NS_SVG,"clipPath",this.featureClipRect,{id:"featureClip-"+this.pageName});
c.appendChild(o);this.labelClipRect=makeElementNS(NS_SVG,"rect",null,{x:10,y:50,width:this.tabMargin-10,height:440});var p=makeElementNS(NS_SVG,"clipPath",this.labelClipRect,{id:"labelClip-"+this.pageName});c.appendChild(p);this.featureBackground=makeElementNS(NS_SVG,"rect",null,{x:this.tabMargin,y:50,width:850-this.tabMargin,height:440,stroke:"none",fill:"url(#bgpattern-"+this.pageName+")"});c.appendChild(this.featureBackground);this.dasTierHolder=makeElementNS(NS_SVG,"g",null,{clipPath:"url(#featureClip-"+
this.pageName+")"});c.appendChild(this.dasTierHolder);m=makeElementNS(NS_SVG,"g",null,{id:"dasTiers"});this.dasTierHolder.appendChild(m);this.makeHighlight();this.dasLabelHolder=makeElementNS(NS_SVG,"g",makeElementNS(NS_SVG,"g",null,{id:"dasLabels"}),{clipPath:"url(#labelClip-"+this.pageName+")"});c.appendChild(this.dasLabelHolder);var u=this.icons.createIcon("magnifier-plus",c),r=this.icons.createIcon("magnifier-minus",c);this.zoomTickMarks=makeElementNS(NS_SVG,"g");this.zoomSlider=new DSlider(250);
this.zoomSlider.onchange=function(a,c){b.zoom(Math.exp(1*a/b.zoomExpt));if(c){b.invalidateLayouts();b.refresh();b.storeStatus()}};u.setAttribute("transform","translate(0,15)");u.setAttribute("pointer-events","all");u.addEventListener("mousedown",function(a){a.stopPropagation();a.preventDefault();a=b.zoomSlider.getValue();b.zoomSlider.setValue(a-10);var c=b.zoomSlider.getValue();if(c!=a){b.zoom(Math.exp(1*c/b.zoomExpt));b.scheduleRefresh(500)}},!1);this.zoomSlider.svg.setAttribute("transform","translate(30, 0)");
r.setAttribute("transform","translate(285,15)");r.setAttribute("pointer-events","all");r.addEventListener("mousedown",function(a){a.stopPropagation();a.preventDefault();a=b.zoomSlider.getValue();b.zoomSlider.setValue(a+10);var c=b.zoomSlider.getValue();if(c!=a){b.zoom(Math.exp(1*c/b.zoomExpt));b.scheduleRefresh(500)}},!1);this.zoomWidget=makeElementNS(NS_SVG,"g",[this.zoomTickMarks,u,this.zoomSlider.svg,r]);this.makeTooltip(this.zoomWidget,"Drag to zoom");c.appendChild(this.zoomWidget);this.karyo=
new Karyoscape(this,this.karyoEndpoint);this.karyo.svg.setAttribute("transform","translate(480, 15)");this.karyo.onchange=function(a){var c=b.viewEnd-b.viewStart+1,a=a*b.currentSeqMax-c/2|0;b.setLocation(a,a+c-1)};c.appendChild(this.karyo.svg);this.popupHolder=makeElementNS(NS_SVG,"g");c.appendChild(this.popupHolder);this.hPopupHolder=makeElement("div");this.hPopupHolder.style["font-family"]="helvetica";this.hPopupHolder.style["font-size"]="12pt";this.svgHolder.appendChild(this.hPopupHolder);this.bhtmlRoot=
makeElement("div");this.disablePoweredBy||this.bhtmlRoot.appendChild(makeElement("span",["Powered by ",makeElement("a","Dalliance",{href:"http://www.biodalliance.org/"})," "+VERSION]));this.svgHolder.appendChild(this.bhtmlRoot);"foreground"==this.guidelineStyle&&(this.fgGuide=document.createElementNS(NS_SVG,"line"),this.fgGuide.setAttribute("x1",500),this.fgGuide.setAttribute("y1",50),this.fgGuide.setAttribute("x2",500),this.fgGuide.setAttribute("y2",1E4),this.fgGuide.setAttribute("stroke","red"),
this.fgGuide.setAttribute("stroke-width",1),this.fgGuide.setAttribute("pointer-events","none"),c.appendChild(this.fgGuide));var w;g.addEventListener("mousedown",function(a){var c=w&&w.displayed;a.stopPropagation();a.preventDefault();b.removeAllPopups();if(!c){c=makeElement("ul");for(l in b.browserLinks)c.appendChild(makeElement("li",makeElement("a",l,{href:b.browserLinks[l].replace(RegExp("\\${([a-z]+)}","g"),function(a,c){return c=="chr"?b.chr:c=="start"?b.viewStart|0:c=="end"?b.viewEnd|0:""}),target:"_new"})));
w=b.popit(a,"Follow links to...",c)}},!1);var v;this.regionLabel.addEventListener("mousedown",function(a){a.stopPropagation();a.preventDefault();var c=v&&v.displayed;b.removeAllPopups();if(!c)if(b.entryPoints==null)alert("entry_points aren't currently available for this genome");else{for(var c=[],d=0;d<b.entryPoints.length;++d)c.push(new EPMenuItem(b.entryPoints[d]));c=c.sort(function(a,b){for(var c=a.nums,d=b.nums,e=0;;){if(e>=c.length)return-1;if(e>=d.length)return 1;var f=c[e]-d[e];if(f!=0)return f;
++e}});c=makeElement("div");c.style.padding="5px";c.style.paddingRight="9px";d=makeElement("form");d.appendChild(document.createTextNode("Location:"));var e=makeElement("div",null,{},{color:"red"});d.appendChild(e);var f=makeElement("input",null,{type:"text",value:b.chr+":"+(b.viewStart|0)+".."+(b.viewEnd|0)});d.appendChild(f);d.appendChild(makeElement("br"));d.appendChild(makeElement("input",null,{type:"submit",value:"Go"}));c.appendChild(d);v=b.popit(a,"Jump to...",c,{width:300});d.addEventListener("submit",
function(a){a.stopPropagation();a.preventDefault();var c=/^([A-Za-z0-9]+)[:\t ]([0-9]+)([-:.\t ]+([0-9]+))?$/.exec(f.value.trim());if(c&&c.length==5){var a=c[1],d=stringToInt(c[2]);if(c[4])c=stringToInt(c[4]);else{c=b.viewEnd-b.viewStart+1;d=d-c/2|0;c=d+c}if(a!=b.chr){b.highlightMin=-1;b.highlightMax=-1}try{b.setLocation(d,c,a);b.removeAllPopups()}catch(g){removeChildren(e);e.appendChild(document.createTextNode(g))}}else{removeChildren(e);e.appendChild(document.createTextNode("Should match chr:start...end or chr:midpoint"))}return false},
false);if(b.searchEndpoint){a=makeElement("form");a.appendChild(makeElement("p","Or search for..."));a.appendChild(document.createTextNode("Gene:"));var g=makeElement("input",null,{value:""});a.appendChild(g);a.appendChild(makeElement("br"));a.appendChild(makeElement("input",null,{type:"submit",value:"Go"}));c.appendChild(a);a.addEventListener("submit",function(a){a.stopPropagation();a.preventDefault();var c=g.value;b.removeAllPopups();if(!c||c.length==0)return false;b.searchEndpoint.features(null,
{group:c,type:"transcript"},function(a){a||(a=[]);for(var d=5E8,e=-1E8,f=null,g=0;g<a.length;++g){var i=a[g];if(i.label==c){if(f==null)f=i.segment;d=Math.min(d,i.min);e=Math.max(e,i.max)}}if(f){b.highlightMin=d;b.highlightMax=e;b.makeHighlight();a=Math.max(2500,0.3*(e-d+1)|0);b.setLocation(d-a,e+a,f)}else alert("no match for '"+c+"' (NB. server support for search is currently rather limited...)")},false);return false},false)}}},!1);var t;d.addEventListener("mousedown",function(a){a.stopPropagation();
a.preventDefault();var c=t&&t.displayed;b.removeAllPopups();c||(t=b.showTrackAdder(a))},!1);j.addEventListener("mousedown",function(a){a.stopPropagation();a.preventDefault();removeChildren(b.tierHolder);removeChildren(b.dasLabelHolder);b.tiers=[];b.sources=[];b.knownSpace=null;for(a=0;a<b.defaultSources.length;++a){var c=b.defaultSources[a];b.sources.push(c);b.makeTier(c)}b.arrangeTiers();b.highlightMin=b.highlightMax=-1;b.setLocation(b.defaultStart,b.defaultEnd,b.defaultChr)},!1);this.tierHolder=
m;this.tiers=[];e&&(this.sources=e);for(e=0;e<this.sources.length;++e)d=this.sources[e],d.bwgURI&&!this.supportsBinary?this.binaryWarningGiven||(this.popit({clientX:300,clientY:100},"Warning",makeElement("p","your browser does not support binary data formats, some track(s) not loaded.  We currently recommend Google Chrome 9 or later, or Firefox 4 or later.")),this.binaryWarningGiven=!0):this.makeTier(d);b.arrangeTiers();this.resizeViewer(!0);window.addEventListener("resize",function(){b.resizeViewer()},
!1);a&&(f&&h)&&(this.chr=a,this.viewStart=f,this.viewEnd=h,0>this.highlightMin&&(this.highlightMin=f,this.highlightMax=h));this.viewEnd-this.viewStart>MAX_VIEW_SIZE&&(a=(this.viewEnd+this.viewStart)/2|0,this.viewStart=a-MAX_VIEW_SIZE/2,this.viewEnd=a+MAX_VIEW_SIZE/2-1);this.origin=(this.viewStart+this.viewEnd)/2|0;this.scale=this.featurePanelWidth/(this.viewEnd-this.viewStart);this.zoomExpt=250/Math.log(MAX_VIEW_SIZE/this.zoomBase);this.zoomSlider.setValue(this.zoomExpt*Math.log((this.viewEnd-this.viewStart+
1)/this.zoomBase));this.move(0);this.makeZoomerTicks();this.__mouseMoveHandler=function(a){return b.mouseMoveHandler(a)};this.__mouseUpHandler=function(a){return b.mouseUpHandler(a)};c.addEventListener("mousedown",function(a){return b.mouseDownHandler(a)},!1);this.svgRoot.addEventListener("mousewheel",function(a){if(a.wheelDeltaX){a.stopPropagation();a.preventDefault();b.move(-a.wheelDeltaX/5)}},!1);this.svgRoot.addEventListener("MozMousePixelScroll",function(a){if(a.axis==1){a.stopPropagation();
a.preventDefault();a.detail!=0&&b.move(a.detail/4)}},!1);var q=function(a){if(a.keyCode==13){for(var c=false,a=0;a<b.tiers.length;++a){var d=b.tiers[a];if(d.wantedLayoutHeight&&d.wantedLayoutHeight!=d.layoutHeight){d.layoutHeight=d.wantedLayoutHeight;d.placard=null;d.clipTier();c=true}}c&&b.arrangeTiers()}else if(a.keyCode==32||a.charCode==32){if(!b.snapZoomLockout){if(b.isSnapZooming){b.isSnapZooming=false;d=b.savedZoom||10;b.savedZoom=b.zoomSlider.getValue();b.zoomSlider.setValue(d);b.zoom(Math.exp(1*
d/b.zoomExpt));b.invalidateLayouts();b.zoomSlider.setColor("blue")}else{b.isSnapZooming=true;d=b.savedZoom||1;b.savedZoom=b.zoomSlider.getValue();b.zoomSlider.setValue(d);b.zoom(Math.exp(1*d/b.zoomExpt));b.invalidateLayouts();b.zoomSlider.setColor("red")}b.refresh();b.snapZoomLockout=true}a.stopPropagation();a.preventDefault()}else if(a.keyCode==39){a.stopPropagation();a.preventDefault();b.move(a.shiftKey?100:25)}else if(a.keyCode==37){a.stopPropagation();a.preventDefault();b.move(a.shiftKey?-100:
-25)}else if(a.charCode==61){a.stopPropagation();a.preventDefault();a=b.zoomSlider.getValue();b.zoomSlider.setValue(a-10);d=b.zoomSlider.getValue();if(d!=a){b.zoom(Math.exp(1*d/b.zoomExpt));b.scheduleRefresh(500)}}else if(a.charCode==45){a.stopPropagation();a.preventDefault();a=b.zoomSlider.getValue();b.zoomSlider.setValue(a+10);d=b.zoomSlider.getValue();if(d!=a){b.zoom(Math.exp(1*d/b.zoomExpt));b.scheduleRefresh(500)}}else if(a.keyCode==84)for(a=0;a<b.tiers.length;++a){d=b.tiers[a];if(d.dasSource.collapseSuperGroups){c===
void 0&&(c=!d.bumped);d.bumped=c;d.layoutWasDone=false;d.draw()}}},z=function(){b.snapZoomLockout=false},x;x=function(){window.removeEventListener("keydown",q,false);window.removeEventListener("keyup",z,false);window.removeEventListener("keypress",q,false);b.svgRoot.removeEventListener("mouseout",x,false)};this.svgRoot.addEventListener("mouseover",function(){window.addEventListener("keydown",q,false);window.addEventListener("keyup",z,false);window.addEventListener("keypress",q,false);b.svgRoot.addEventListener("mouseout",
x,false)},!1);this.storeStatus();for(var C,a=0;a<this.tiers.length;++a)if(this.tiers[a].dasSource.provides_entrypoints){C=this.tiers[a].dasSource;break}C&&C.entryPoints(function(a){b.entryPoints=a;for(a=0;a<b.entryPoints.length;++a)if(b.entryPoints[a].name==b.chr){b.currentSeqMax=b.entryPoints[a].end;break}});b.queryRegistry(null,!0);for(var E in this.chains)this.queryRegistry(E,!0)};function setSources(a,b,c){if(c)for(var e=0;e<b.length;++e)b[e].mapping=c;a.set(b)}
Browser.prototype.queryRegistry=function(a,b){var c,e;a?(c=this.chains[a].coords,this.mappableSources[a]||(this.mappableSources[a]=new Observed),e=this.mappableSources[a]):(c=this.coordSystem,e=this.availableSources);var d=hex_sha1(miniJSONify(c));if(b){var f=localStorage["dalliance.registry."+d+".last_queried"];if(f)try{if(setSources(e,JSON.parse(localStorage["dalliance.registry."+d+".sources"]),a),432E5>(Date.now()|0)-(f|0))return}catch(h){dlog("Bad registry cache: "+h)}}(new DASRegistry(this.registry)).sources(function(b){for(var f=
[],h=0;h<b.length;++h){var u=b[h];if(u.coords&&u.coords.length!=0){var s=u.coords[0];s.taxon!=c.taxon||(s.auth!=c.auth||s.version!=c.version)||f.push(u)}}localStorage["dalliance.registry."+d+".sources"]=JSON.stringify(f);localStorage["dalliance.registry."+d+".last_queried"]=""+Date.now();setSources(e,f,a)},function(){},c)};Browser.prototype.makeTier=function(a){try{this.realMakeTier(a)}catch(b){dlog("Error creating tier: "+b)}};
Browser.prototype.realMakeTier=function(a){var b=document.createElementNS(NS_SVG,"g"),c=document.createElementNS(NS_SVG,"rect");c.setAttribute("fill",this.tierBackgroundColors[this.tiers.length%this.tierBackgroundColors.length]);c.setAttribute("x","-1000000");c.setAttribute("y","0");c.setAttribute("width","2000000");c.setAttribute("height","200");c.setAttribute("stroke-width","0");b.appendChild(c);b.setAttribute("transform","translate(200, 450)");a=new DasTier(this,a,b,c);a.init();this.tierHolder.appendChild(b);
this.tiers.push(a);this.refreshTier(a);this.arrangeTiers()};Browser.prototype.removeTier=function(a){a=arrayIndexOf(this.tiers,a);if(0>a)return dlog("Couldn't find tier");var b=this.tiers[a];this.tierHolder.removeChild(b.viewport);b.label&&this.dasLabelHolder.removeChild(b.label);this.tiers.splice(a,1);for(a=0;a<this.tiers.length;++a)this.tiers[a].background.setAttribute("fill",this.tierBackgroundColors[a%this.tierBackgroundColors.length]),this.tiers[a].isLabelValid=!1;this.arrangeTiers();this.storeStatus()};
Browser.prototype.makeZoomerTicks=function(){var a=this;removeChildren(this.zoomTickMarks);var b=function(b){var e=a.zoomExpt*Math.log(b/a.zoomBase);if(!(0>e||250<e)){var d=makeElementNS(NS_SVG,"line",null,{x1:30+e,y1:35,x2:30+e,y2:38,stroke:"gray",strokeWidth:1}),b=makeElementNS(NS_SVG,"text",1500<b?""+b/1E3+"kb":""+b+"bp",{x:30+e,y:48,fontSize:"8pt",stroke:"none"});a.zoomTickMarks.appendChild(d);a.zoomTickMarks.appendChild(b);b.setAttribute("x",29+e-b.getBBox().width/2)}};b(1E6);b(5E5);b(1E5);b(2E4);
b(4E3);b(500);b(100);b(50)};
Browser.prototype.resizeViewer=function(a){var b=window.innerWidth,b=Math.max(b,640);this.forceWidth&&(b=this.forceWidth);this.center&&(this.svgHolder.style["margin-left"]=((window.innerWidth-b)/2|0)+"px");this.svgRoot.setAttribute("width",b-30);this.svgBackground.setAttribute("width",b-30);this.featureClipRect.setAttribute("width",b-this.tabMargin-40);this.featureBackground.setAttribute("width",b-this.tabMargin-40);this.zoomWidget.setAttribute("transform","translate("+(b-this.zoomSlider.width-100)+
", 0)");1075>b?this.karyo.svg.setAttribute("transform","translate(2000, 15)"):this.karyo.svg.setAttribute("transform","translate(450, 20)");this.regionLabelMax=b-this.zoomSlider.width-120;var c=this.featurePanelWidth;this.featurePanelWidth=b-this.tabMargin-40|0;c!=this.featurePanelWidth&&(b=this.viewStart+(this.viewEnd-this.viewStart)*this.featurePanelWidth/c-this.viewEnd,this.viewStart-=b/2,this.viewEnd+=b/2,b=this.viewEnd-this.viewStart+1,0<this.currentSeqMax&&this.viewEnd>this.currentSeqMax&&(this.viewEnd=
this.currentSeqMax,this.viewStart=this.viewEnd-b+1),1>this.viewStart&&(this.viewStart=1,this.viewEnd=this.viewStart+b-1),this.xfrmTiers(this.tabMargin-1*(this.viewStart-this.origin)*this.scale,1),this.updateRegion(),a||this.spaceCheck());this.fgGuide&&(this.fgGuide.setAttribute("x1",this.featurePanelWidth/2+this.tabMargin),this.fgGuide.setAttribute("x2",this.featurePanelWidth/2+this.tabMargin));for(a=0;a<this.placards.length;++a)b=this.placards[a].getElementsByTagName("rect"),0<b.length&&b[0].setAttribute("width",
this.featurePanelWidth)};Browser.prototype.xfrmTiers=function(a,b){for(var c=0;c<this.tiers.length;++c)this.xfrmTier(this.tiers[c],a,b);this.highlight&&(this.highlight.setAttribute("transform","translate("+a+",0)"),this.highlight.setAttribute("x",(this.highlightMin-this.origin)*this.scale),this.highlight.setAttribute("width",(this.highlightMax-this.highlightMin+1)*this.scale))};
Browser.prototype.jiggleLabels=function(a){for(var b=a.xfrmX,a=a.viewport.getElementsByClassName("label-text"),c=0;c<a.length;++c){var e=a[c];e.jiggleMin&&e.jiggleMax&&e.setAttribute("x",Math.min(Math.max(this.tabMargin-b,e.jiggleMin),e.jiggleMax))}};
Browser.prototype.xfrmTier=function(a,b,c){a.originHaxx&&0!=a.originHaxx&&(b-=1*a.originHaxx*this.scale);var e=c;0>e?e=a.scale:a.scale=c;c=a.y;if(b!=a.xfrmX||c!=a.xfrmY||e!=a.xfrmS){var d="translate("+b+","+a.y+")";1!=e&&(d+=", scale("+e+",1)");a.viewport.setAttribute("transform",d)}if(a.label&&(c!=a.xfrmY||!a.isLabelValid))a.label.setAttribute("transform","translate(0, "+c+")"),a.isLabelValid=!0;a.xfrmX=b;a.xfrmY=c;a.xfrmS=e;this.jiggleLabels(a)};
Browser.prototype.spaceCheck=function(){if(!this.knownSpace||this.knownSpace.chr!==this.chr)this.refresh();else{var a=((this.viewEnd-this.viewStart|0)+1)*this.minExtra|0;((this.drawnStart|0)>Math.max(1,(this.viewStart|0)-a|0)||(this.drawnEnd|0)<Math.min((this.viewEnd|0)+a,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9))&&this.refresh()}};
Browser.prototype.move=function(a){var b=this.viewEnd-this.viewStart;this.viewStart-=a/this.scale;this.viewEnd=this.viewStart+b;0<this.currentSeqMax&&this.viewEnd>this.currentSeqMax&&(this.viewEnd=this.currentSeqMax,this.viewStart=this.viewEnd-b);1>this.viewStart&&(this.viewStart=1,this.viewEnd=this.viewStart+b);this.xfrmTiers(this.tabMargin-1*(this.viewStart-this.origin)*this.scale,1);this.updateRegion();this.karyo.update(this.chr,this.viewStart,this.viewEnd);this.spaceCheck()};
Browser.prototype.zoom=function(a){this.zoomFactor=a;a=Math.round((this.viewStart+this.viewEnd)/2)|0;this.viewStart=a-this.zoomBase*this.zoomFactor/2;this.viewEnd=a+this.zoomBase*this.zoomFactor/2;0<this.currentSeqMax&&this.viewEnd>this.currentSeqMax+5&&(a=this.viewEnd-this.viewStart+1,this.viewEnd=this.currentSeqMax,this.viewStart=this.viewEnd-a+1);1>this.viewStart&&(a=this.viewEnd-this.viewStart+1,this.viewStart=1,this.viewEnd=this.viewStart+a-1);this.scale=this.featurePanelWidth/(this.viewEnd-
this.viewStart);this.updateRegion();this.xfrmTiers(this.tabMargin-1*(this.viewStart-this.origin)*this.scale,this.scale/this.scaleAtLastRedraw);for(var a=this.svgRoot.getElementsByClassName("label-text"),b=0;b<a.length;++b){var c=a[b],e=c.getAttribute("x");c.setAttribute("transform","scale("+this.scaleAtLastRedraw/this.scale+",1), translate( "+(e*this.scale-e*this.scaleAtLastRedraw)/this.scaleAtLastRedraw+",0)")}};
Browser.prototype.setLocation=function(a,b,c){a|=0;b|=0;if(c&&c!=this.chr){if(!this.entryPoints)throw"Need entry points";for(var e=null,d=0;d<this.entryPoints.length;++d){var f=this.entryPoints[d].name;if(f===c||"chr"+f===c||f==="chr"+c){e=this.entryPoints[d];break}}if(!e)throw"Couldn't find chromosome "+c;this.chr=e.name;this.currentSeqMax=e.end}c=b-a+1;c>MAX_VIEW_SIZE&&(a=(b+a-MAX_VIEW_SIZE)/2|0,b=a+MAX_VIEW_SIZE-1|0);c<this.zoomBase&&(a=(b+a-this.zoomBase)/2|0,mewMax=a+this.zoomBase-1|0);1>a&&
(c=b-a+1,a=1,b=Math.min(a+c-1,this.currentSeqMax));0<this.currentSeqMax&&b>this.currentSeqMax&&(c=b-a+1,b=this.currentSeqMax,a=Math.max(1,b-c+1));this.viewStart=a|0;this.viewEnd=b|0;this.scale=this.featurePanelWidth/(this.viewEnd-this.viewStart);this.zoomSlider.setValue(this.zoomExpt*Math.log((this.viewEnd-this.viewStart+1)/this.zoomBase));this.updateRegion();this.karyo.update(this.chr,this.viewStart,this.viewEnd);this.spaceCheck();this.xfrmTiers(this.tabMargin-1*(this.viewStart-this.origin)*this.scale,
1);this.storeStatus()};Browser.prototype.storeStatus=function(){};Browser.prototype.scheduleRefresh=function(a){a||(a=500);var b=this;this.refreshTB&&clearTimeout(this.refreshTB);this.refreshTB=setTimeout(function(){b.refreshTB=null;b.refresh()},a)};Browser.prototype.invalidateLayouts=function(){for(var a=0;a<this.tiers.length;++a)this.tiers[a].layoutWasDone=!1};Browser.prototype.refreshTier=function(a){this.knownSpace&&this.knownSpace.invalidate(a)};
function Chainset(a,b,c,e){this.uri=a;this.srcTag=b;this.destTag=c;this.coords=e;this.chainsBySrc={};this.chainsByDest={};this.postFetchQueues={}}function parseCigar(a){for(var b=[],c=RegExp("([0-9]*)([MID])","g"),e;null!=(e=c.exec(a));){var d=e[1];0==d.length&&(d=1);b.push({cnt:d|0,op:e[2]})}return b}
Chainset.prototype.fetchChainsTo=function(a){var b=this;(new DASSource(this.uri)).alignments(a,{},function(c){b.chainsByDest[a]||(b.chainsByDest[a]=[]);for(var e=0;e<c.length;++e)for(var d=c[e],f=0;f<d.blocks.length;++f){for(var h=d.blocks[f],g,j,m=0;m<h.segments.length;++m){var u=h.segments[m],s=d.objects[u.object];s.dbSource===b.srcTag?g=u:s.dbSource===b.destTag&&(j=u)}if(g&&j){for(var h={srcChr:d.objects[g.object].accession,srcMin:g.min|0,srcMax:g.max|0,srcOri:g.strand,destChr:d.objects[j.object].accession,
destMin:j.min|0,destMax:j.max|0,destOri:j.strand,blocks:[]},m=parseCigar(g.cigar),u=parseCigar(j.cigar),o=s=0,p=0,r=0;p<m.length&&r<u.length;)if("M"==m[p].op&&"M"==u[r].op){var w=Math.min(m[p].cnt,u[r].cnt);h.blocks.push([s,o,w]);m[p].cnt==w?++p:m[p].cnt-=w;u[r].cnt==w?++r:u[r]-=w;s+=w;o+=w}else"I"==m[p].op?o+=m[p++].cnt:"I"==u[r].op&&(s+=u[r++].cnt);pusho(b.chainsBySrc,h.srcChr,h);pusho(b.chainsByDest,h.destChr,h)}}if(b.postFetchQueues[a]){c=b.postFetchQueues[a];for(e=0;e<c.length;++e)c[e]();b.postFetchQueues[a]=
null}})};Chainset.prototype.mapPoint=function(a,b){for(var c=this.chainsBySrc[a]||[],e=0;e<c.length;++e){var d=c[e];if(b>=d.srcMin&&b<=d.srcMax){var f;f="-"==d.srcOri?d.srcMax-b:b-d.srcMin;for(var h=d.blocks,g=0;g<h.length;++g){var j=h[g],m=j[0],u=j[1],j=j[2];if(f>=m&&f<=m+j)return c=f-m,{seq:d.destChr,pos:"-"==d.destOri?d.destMax-u-c:c+u+d.destMin,flipped:d.srcOri!=d.destOri}}}}return null};
Chainset.prototype.unmapPoint=function(a,b){for(var c=this.chainsByDest[a]||[],e=0;e<c.length;++e){var d=c[e];if(b>=d.destMin&&b<=d.destMax){for(var e="-"==d.srcOri?d.destMax-b:b-d.destMin,f=d.blocks,h=0;h<f.length;++h){var g=f[h],c=g[0],j=g[1],g=g[2];if(e>=j&&e<=j+g)return e-=j,f=e+c+d.srcMin,f="-"==d.destOri?d.srcMax-c-e:e+c+d.srcMin,{seq:d.srcChr,pos:f,flipped:d.srcOri!=d.destOri}}break}}return null};
Chainset.prototype.sourceBlocksForRange=function(a,b,c,e){if(this.chainsByDest[a]){var d=this.unmapPoint(a,b),f=this.unmapPoint(a,c);!d||!f||d.seq!=f.seq?e([]):e([new DASSegment(d.seq,d.pos,f.pos)])}else{var d=!this.postFetchQueues[a],h=this;pusho(this.postFetchQueues,a,function(){h.sourceBlocksForRange(a,b,c,e)});d&&this.fetchChainsTo(a)}};var dasLibErrorHandler=function(a){alert(a)},dasLibRequestQueue=[];function DASSegment(a,b,c,e){this.name=a;this.start=b;this.end=c;this.description=e}
DASSegment.prototype.toString=function(){return this.name+":"+this.start+".."+this.end};DASSegment.prototype.isBounded=function(){return this.start&&this.end};DASSegment.prototype.toDASQuery=function(){var a="segment="+this.name;this.start&&this.end&&(a+=":"+this.start+","+this.end);return a};
function DASSource(a,b){var c;"string"==typeof a?(this.uri=a,c=b||{}):c=a||{};for(var e in c)"function"!=typeof c[e]&&(this[e]=c[e]);this.coords||(this.coords=[]);this.props||(this.props={});this.uri&&"/"!=this.uri.substr(this.uri.length-1)&&(this.uri+="/")}function DASCoords(){}function coordsMatch(a,b){return a.taxon==b.taxon&&a.auth==b.auth&&a.version==b.version}
DASSource.prototype.entryPoints=function(a){this.doCrossDomainRequest(this.uri+"entry_points",function(b){if(!b)return a([]);for(var c=[],b=b.getElementsByTagName("SEGMENT"),e=0;e<b.length;++e){var d=b[e],f=d.getAttribute("id"),h=d.getAttribute("size"),g;h?g=1:(g=d.getAttribute("start"),h=d.getAttribute("stop"));var j=null;d.firstChild&&(j=d.firstChild.nodeValue);c.push(new DASSegment(f,g,h,j))}a(c)})};
function DASSequence(a,b,c,e,d){this.name=a;this.start=b;this.end=c;this.alphabet=e;this.seq=d}
DASSource.prototype.sequence=function(a,b){this.doCrossDomainRequest(this.uri+"sequence?"+a.toDASQuery(),function(a){if(a){for(var e=[],a=a.getElementsByTagName("SEQUENCE"),d=0;d<a.length;++d){var f=a[d],h=f.getAttribute("id"),g=f.getAttribute("start"),j=f.getAttribute("stop"),m=null;if(f.firstChild)for(var f=f.firstChild.nodeValue,m="",u=0;;){var s=f.indexOf("\n",u);if(0<=s)m+=f.substring(u,s),u=s+1;else{m+=f.substring(u);break}}e.push(new DASSequence(h,g,j,"DNA",m))}b(e)}else b([])})};
function DASFeature(){}function DASGroup(){}function DASLink(a,b){this.desc=a;this.uri=b}
DASSource.prototype.features=function(a,b,c){var b=b||{},e;if(0==this.uri.indexOf("http://")){e=this.uri+"features?";if(a)e+=a.toDASQuery();else if(b.group)if(a=b.group,"string"==typeof a)e+=";group_id="+a;else for(var d=0;d<a.length;++d)e+=";group_id="+a[d];if(b.type)if("string"==typeof b.type)e+=";type="+b.type;else for(a=0;a<b.type.length;++a)e+=";type="+b.type[a];b.maxbins&&(e+=";maxbins="+b.maxbins)}else e=this.uri;this.doCrossDomainRequest(e,function(a,b){if(a){for(var d=[],e={},m=a.getElementsByTagName("SEGMENT"),
u=0;u<m.length;++u){var s=m[u],o=s.getAttribute("id");e[o]={min:s.getAttribute("start"),max:s.getAttribute("stop")};for(var s=s.getElementsByTagName("FEATURE"),p=0;p<s.length;++p){var r=s[p],w=new DASFeature;w.segment=o;w.id=r.getAttribute("id");w.label=r.getAttribute("label");var v=elementValue(r,"START"),t=elementValue(r,"END");(v|0)>(t|0)?(w.min=t,w.max=v):(w.min=v,w.max=t);v=r.getElementsByTagName("TYPE");0<v.length&&(v=v[0],v.firstChild&&(w.type=v.firstChild.nodeValue),w.typeId=v.getAttribute("id"),
w.typeCv=v.getAttribute("cvId"));w.type=elementValue(r,"TYPE");!w.type&&w.typeId&&(w.type=w.typeId);w.method=elementValue(r,"METHOD");(v=elementValue(r,"ORIENTATION"))||(v="0");w.orientation=v;w.score=elementValue(r,"SCORE");w.links=dasLinksOf(r);w.notes=dasNotesOf(r);v=r.getElementsByTagName("GROUP");for(t=0;t<v.length;++t){var q=v[t],z=new DASGroup;z.type=q.getAttribute("type");z.id=q.getAttribute("id");z.links=dasLinksOf(q);z.notes=dasNotesOf(q);w.groups?w.groups.push(z):w.groups=Array(z)}if(w.notes)for(v=
0;v<w.notes.length;++v)t=w.notes[v],0==t.indexOf("Genename=")&&(q=new DASGroup,q.type="gene",q.id=t.substring(9),w.groups?w.groups.push(q):w.groups=Array(q));v=r.getElementsByTagName("PART");if(0<v.length){q=[];for(t=0;t<v.length;++t)q.push(v[t].getAttribute("id"));w.parts=q}v=r.getElementsByTagName("PARENT");if(0<v.length){r=[];for(t=0;t<v.length;++t)r.push(v[t].getAttribute("id"));w.parents=r}d.push(w)}}c(d,void 0,e)}else c([],"Failed request: "+(0==b.status?"server may not support CORS":"status="+
b.status))})};function DASAlignment(a){this.type=a;this.objects={};this.blocks=[]}
DASSource.prototype.alignments=function(a,b,c){var e=this.uri+"alignment?query="+a;this.doCrossDomainRequest(e,function(a){if(a){for(var b=[],a=a.getElementsByTagName("alignment"),h=0;h<a.length;++h){for(var g=a[h],j=new DASAlignment(g.getAttribute("alignType")),m=g.getElementsByTagName("alignObject"),u=0;u<m.length;++u){var s=m[u],s={id:s.getAttribute("intObjectId"),accession:s.getAttribute("dbAccessionId"),version:s.getAttribute("objectVersion"),dbSource:s.getAttribute("dbSource"),dbVersion:s.getAttribute("dbVersion")};
j.objects[s.id]=s}g=g.getElementsByTagName("block");for(m=0;m<g.length;++m){for(var s=g[m],u={order:s.getAttribute("blockOrder"),segments:[]},s=s.getElementsByTagName("segment"),o=0;o<s.length;++o){var p=s[o],p={object:p.getAttribute("intObjectId"),min:p.getAttribute("start"),max:p.getAttribute("end"),strand:p.getAttribute("strand"),cigar:elementValue(p,"cigar")};u.segments.push(p)}j.blocks.push(u)}b.push(j)}c(b)}else c([],"Failed request "+e)})};function DASStylesheet(){this.styles=[]}
DASStylesheet.prototype.pushStyle=function(a,b,c){a||(a={type:"default"});a=shallowCopy(a);b&&(a.zoom=b);a.style=c;this.styles.push(a)};function DASStyle(){}
DASSource.prototype.stylesheet=function(a,b){var c,e=this.credentials;this.stylesheet_uri?(c=this.stylesheet_uri,e=!1):c=this.uri+"stylesheet";doCrossDomainRequest(c,function(c){if(c){for(var e=new DASStylesheet,c=c.getElementsByTagName("TYPE"),h=0;h<c.length;++h){var g=c[h],j={};j.type=g.getAttribute("id");j.label=g.getAttribute("label");j.method=g.getAttribute("method");for(var g=g.getElementsByTagName("GLYPH"),m=0;m<g.length;++m){var u=g[m],s=u.getAttribute("zoom"),o=childElementOf(u),u=new DASStyle;
u.glyph=o.localName;for(o=o.firstChild;o;){if(o.nodeType==Node.ELEMENT_NODE)u[o.localName]=o.firstChild.nodeValue;o=o.nextSibling}e.pushStyle(j,s,u)}}a(e)}else b&&b()},e)};function DASRegistry(a,b){b=b||{};this.uri=a;this.opts=b}
DASRegistry.prototype.sources=function(a,b,c){c||(c={});var e=[];c.taxon&&e.push("organism="+c.taxon);c.auth&&e.push("authority="+c.auth);c.version&&e.push("version="+c.version);c=this.uri;0<e.length&&(c=c+"?"+e.join("&"));doCrossDomainRequest(c,function(c){if(!c&&b)b();else{for(var e=[],c=c.getElementsByTagName("SOURCE"),h=0;h<c.length;++h){var g=c[h],j=g.getElementsByTagName("VERSION");if(!(1>j.length)){for(var m=j[0],u=m.getElementsByTagName("COORDINATES"),j=[],s=0;s<u.length;++s){var o=u[s],p=
new DASCoords;p.auth=o.getAttribute("authority");p.taxon=o.getAttribute("taxid");p.version=o.getAttribute("version");j.push(p)}for(var u=m.getElementsByTagName("CAPABILITY"),r,s=0;s<u.length;++s)o=u[s],"das1:features"==o.getAttribute("type")&&(r=o.getAttribute("query_uri"),r=r.substring(0,r.length-8));s={};m=m.getElementsByTagName("PROP");for(u=0;u<m.length;++u)pusho(s,m[u].getAttribute("name"),m[u].getAttribute("value"));r&&(g=new DASSource(r,{source_uri:g.getAttribute("uri"),name:g.getAttribute("title"),
desc:g.getAttribute("description"),coords:j,props:s}),e.push(g))}}a(e)}})};function elementValue(a,b){var c=a.getElementsByTagName(b);return 0<c.length&&c[0].firstChild?c[0].firstChild.nodeValue:null}function childElementOf(a){if(a.hasChildNodes()){a=a.firstChild;do{if(a.nodeType==Node.ELEMENT_NODE)return a;a=a.nextSibling}while(null!=a)}return null}
function dasLinksOf(a){for(var b=[],c=a.getElementsByTagName("LINK"),e=0;e<c.length;++e){var d=c[e];d.parentNode==a&&b.push(new DASLink(d.firstChild?d.firstChild.nodeValue:"Unknown",d.getAttribute("href")))}return b}function dasNotesOf(a){for(var b=[],a=a.getElementsByTagName("NOTE"),c=0;c<a.length;++c)a[c].firstChild&&b.push(a[c].firstChild.nodeValue);return b}
function doCrossDomainRequest(a,b,c){console.debug("calling cross domain");if(window.XDomainRequest){var e=new XDomainRequest;e.onload=function(){var a=new ActiveXObject("Microsoft.XMLDOM");a.async=!1;a.loadXML(e.responseText);b(a)};e.open("get",a)}else e=new XMLHttpRequest,e.onreadystatechange=function(){4==e.readyState&&(200==e.status||0==e.status)&&b(e.responseXML,e)},e.open("get",a,!0),c&&(e.withCredentials=!0);e.send("")}
DASSource.prototype.doCrossDomainRequest=function(a,b){return doCrossDomainRequest(a,b,this.credentials)};
Browser.prototype.makeTooltip=function(a,b){var c=!1,e=this,d=null,f;f=function(){c=!1;d&&(clearTimeout(d),d=null);a.removeEventListener("mouseout",f,!1)};var h;h=function(f){var j=f.clientX+window.scrollX,m=f.clientY+window.scrollY;d||(d=setTimeout(function(){var f=makeElement("div",b,{},{position:"absolute",top:""+(m+20)+"px",left:""+Math.max(j-30,20)+"px",backgroundColor:"rgb(250, 240, 220)",borderWidth:"1px",borderColor:"black",borderStyle:"solid",padding:"2px",maxWidth:"400px"});e.hPopupHolder.appendChild(f);
var g;g=function(b){try{e.hPopupHolder.removeChild(f)}catch(d){}window.removeEventListener("mousemove",g,!1);c&&null!=a.offsetParent&&h(b)};window.addEventListener("mousemove",g,!1);d=null},1E3))};a.addEventListener("mouseover",function(b){c=!0;a.addEventListener("mouseout",f,!1);h(b)},!1);a.addEventListener("DOMNodeRemovedFromDocument",function(){c=!1;d&&(clearTimeout(d),d=null)},!1)};
Browser.prototype.popit=function(a,b,c,e){var d=this;e||(e={});var f=e.width||200,e=a.clientX,a=a.clientY,e=e+(document.documentElement.scrollLeft||document.body.scrollLeft),a=a+(document.documentElement.scrollTop||document.body.scrollTop),h=window.innerWidth,g=a+30,j=Math.min(e-30,h-f-10),m=makeElement("div");m.style.position="absolute";m.style.top=""+g+"px";m.style.left=""+j+"px";m.style.width=f+"px";m.style.backgroundColor="white";m.style.borderWidth="2px";m.style.borderColor="black";m.style.borderStyle=
"solid";if(b){var u=makeElement("div","X",null,{marginTop:"-3px",padding:"3px",borderStyle:"none",borderLeftStyle:"solid",borderWidth:"1px",borderColor:"rgb(128,128,128)",cssFloat:"right"});u.style["float"]="right";u.addEventListener("mouseover",function(){u.style.color="red"},!1);u.addEventListener("mouseout",function(){u.style.color="black"},!1);u.addEventListener("mousedown",function(){d.removeAllPopups()},!1);var b=makeElement("div",[makeElement("span",b,null,{maxWidth:"200px"}),u],null,{backgroundColor:"rgb(230,230,250)",
borderColor:"rgb(128,128,128)",borderStyle:"none",borderBottomStyle:"solid",borderWidth:"1px",padding:"3px"}),s,o,p,r;p=function(a){a.stopPropagation();a.preventDefault();j+=a.clientX-s;8>j&&(j=8);j>h-f-32&&(j=h-f-26);g+=a.clientY-o;g=Math.max(10,g);m.style.top=""+g+"px";m.style.left=""+Math.min(j,h-f-10)+"px";s=a.clientX;o=a.clientY};r=function(a){a.stopPropagation();a.preventDefault();window.removeEventListener("mousemove",p,!1);window.removeEventListener("mouseup",r,!1)};b.addEventListener("mousedown",
function(a){a.preventDefault();a.stopPropagation();s=a.clientX;o=a.clientY;window.addEventListener("mousemove",p,!1);window.addEventListener("mouseup",r,!1)},!1);m.appendChild(b)}m.appendChild(makeElement("div",c,null,{padding:"3px",clear:"both"}));this.hPopupHolder.appendChild(m);var w={node:m,displayed:!0};m.addEventListener("DOMNodeRemoved",function(){w.displayed=!1},!1);return w};function IconSet(a){var b=new XMLHttpRequest;b.open("get",a,!1);b.send();this.icons=b.responseXML}
IconSet.prototype.createIcon=function(a,b){var c=this.icons.getElementById(a);if(c){c=document.importNode(c,!0);b.appendChild(c);var e=c.getBBox();b.removeChild(c);c.setAttribute("transform","translate("+-e.x+","+-e.y+")");return makeElementNS(NS_SVG,"g",c)}alert("couldn't find "+a)};
IconSet.prototype.createButton=function(a,b,c,e){c|=0;e|=0;a=this.icons.getElementById(a);a=document.importNode(a,!0);b.appendChild(a);var d=a.getBBox();b.removeChild(a);a.setAttribute("transform","translate("+((c-d.width-2)/2-d.x)+","+((e-d.height-2)/2-d.y)+")");return makeElementNS(NS_SVG,"g",[makeElementNS(NS_SVG,"rect",null,{x:0,y:0,width:c,height:e,fill:"rgb(230,230,250)",stroke:"rgb(150,150,220)",strokeWidth:2}),a])};
function dlog(a){var b=document.getElementById("log");b&&b.appendChild(makeElement("p",a))}var MIN_FEATURE_PX=1,MIN_PADDING=3,DEFAULT_SUBTIER_MAX=25;function DColour(a,b,c,e){this.red=a|0;this.green=b|0;this.blue=c|0;e&&(this.name=e)}DColour.prototype.toSvgString=function(){this.name||(this.name="rgb("+this.red+","+this.green+","+this.blue+")");return this.name};
var palette={red:new DColour(255,0,0,"red"),green:new DColour(0,255,0,"green"),blue:new DColour(0,0,255,"blue"),yellow:new DColour(255,255,0,"yellow"),white:new DColour(255,255,255,"white"),black:new DColour(0,0,0,"black")},COLOR_RE=/^#([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/;function dasColourForName(a){var b=palette[a];b||((b=COLOR_RE.exec(a))?b=new DColour("0x"+b[1]|0,"0x"+b[2]|0,"0x"+b[3]|0,a):(dlog("couldn't handle color: "+a),b=palette.black),palette[a]=b);return b}
function DGlyph(a,b,c,e){this.glyph=a;this.min=b;this.max=c;this.height=e;this.zindex=0}function DSubTier(){this.glyphs=[];this.height=0}DSubTier.prototype.add=function(a){this.glyphs.push(a);this.height=Math.max(this.height,a.height)};DSubTier.prototype.hasSpaceFor=function(a){for(var b=0;b<this.glyphs.length;++b){var c=this.glyphs[b];if(c.min<=a.max&&c.max>=a.min)return!1}return!0};
DasTier.prototype.styleForFeature=function(a){var b=zoomForScale(this.browser.scale);if(!this.stylesheet)return null;for(var c=null,e=this.stylesheet.styles,d=0;d<e.length;++d){var f=e[d];if(!(f.zoom&&f.zoom!=b)&&(!f.label||RegExp("^"+f.label+"$").test(a.label)))if(!f.method||RegExp("^"+f.method+"$").test(a.method)){if(f.type)if("default"==f.type){c||(c=f.style);continue}else if(f.type!=a.type)continue;return f.style}}return c};
function drawLine(a,b,c,e,d){var f=e.browser.origin,h=e.browser.scale,g=c.HEIGHT||30,j=e.dasSource.forceMin||c.MIN||e.currentFeaturesMinScore||0,m=e.dasSource.forceMax||c.MAX||e.currentFeaturesMaxScore||10,u=1*g/(m-j),s=c.LINEWIDTH||1,o=c.COLOR||c.COLOR1||"black",c=document.createElementNS(NS_SVG,"path");c.setAttribute("fill","none");c.setAttribute("stroke",o);c.setAttribute("stroke-width",s);s="";for(o=0;o<b.length;++o)var p=b[o],r=(((p.min|0)+(p.max|0))/2-f)*h,p=d+(g-((p.score-1*j)*u|0)),s=0==o?
"M "+r+" "+p:s+(" L "+r+" "+p);c.setAttribute("d",s);a.appendChild(c);b="line_clip_"+ ++clipIdSeed;f=document.createElementNS(NS_SVG,"clipPath");f.setAttribute("id",b);h=document.createElementNS(NS_SVG,"rect");h.setAttribute("x",-5E5);h.setAttribute("y",d-1);h.setAttribute("width",1E6);h.setAttribute("height",g+2);f.appendChild(h);a.appendChild(f);c.setAttribute("clip-path","url(#"+b+")");e.isQuantitative||(e.isQuantitative=!0,e.isLabelValid=!1);e.min!=j&&(e.min=j,e.isLabelValid=!1);e.max!=m&&(e.max=
m,e.isLabelValid=!1);e.clientMin!=d|0+g&&(e.clientMin=d|0+g,e.isLabelValid=!1);e.clientMax!=d&&(e.clientMax=d,e.isLabelValid=!1);return g|0+MIN_PADDING}
function sortFeatures(a){for(var b={},c={},e={},d={},f={},h=[],g,j,m,u=function(){m={};for(var b=0;b<a.currentFeatures.length;++b){var c=a.currentFeatures[b];c.id&&(m[c.id]=c)}},s=function(a){var b=[];if(a.parents)for(var c=0;c<a.parents.length;++c){var d=a.parents[c],e=m[d];e&&"SO:0000704"==e.typeCv&&pushnew(b,d)}return b},o=0;o<a.currentFeatures.length;++o){var p=a.currentFeatures[o];if(!p.parts)if(!p.min||!p.max)h.push(p);else{if(p.score&&"."!=p.score&&"-"!=p.score){sc=1*p.score;if(!g||sc<g)g=
sc;if(!j||sc>j)j=sc}var r=[],w=null;if(p.groups)for(var v=0;v<p.groups.length;++v){var t=p.groups[v],q=t.id;"gene"==t.type?(w=q,e[q]=shallowCopy(t)):"translation"!=t.type&&(pusho(c,q,p),e[q]=shallowCopy(t),r.push(q))}if(p.parents){m||u();for(v=0;v<p.parents.length;++v)if(t=p.parents[v],q=m[t])if(q.parts||(q.parts=[p]),pushnewo(c,t,q),pusho(c,t,p),e[t]||(e[t]={type:q.type,id:q.id,label:q.label||q.id}),r.push(t),t=s(q),0<t.length)w=t[0],q=m[t[0]],e[t[0]]={type:q.type,id:q.id,label:q.label||q.id},a.dasSource.collapseSuperGroups||
(a.dasSource.collapseSuperGroups=!0,a.isLabelValid=!1)}if(0==r.length)pusho(b,p.type,p);else if(w)for(t=0;t<r.length;++t)q=r[t],pushnewo(d,w,q),f[q]=w}}a.ungroupedFeatures=b;a.groupedFeatures=c;a.groups=e;a.superGroups=d;a.groupsToSupers=f;g&&(0<g?g=0:0>j&&(j=0),a.currentFeaturesMinScore=g,a.currentFeaturesMaxScore=j)}var clipIdSeed=0;
function drawFeatureTier(a){sortFeatures(a);a.placard=null;a.isQuantitative=!1;for(var b=a.viewport;0<b.childNodes.length;)b.removeChild(b.firstChild);b.appendChild(a.background);drawGuidelines(a,b);var c=MIN_PADDING,e=[],d=!1,f;for(f in a.ungroupedFeatures){var h=a.ungroupedFeatures[f],g=a.styleForFeature(h[0]);if(g)if("LINEPLOT"==g.glyph)c+=Math.max(drawLine(b,h,g,a,c)),d=!0;else for(var j=0;j<h.length;++j)if(g=h[j],!g.parts){var m=glyphForFeature(g,0,a.styleForFeature(g),a);e.push(m)}}if(a.dasSource.collapseSuperGroups&&
!a.bumped)for(var u in a.superGroups){f=a.superGroups[u];a.groups[u].type=a.groups[f[0]].type;j={};for(m=0;m<f.length;++m){for(var h=a.groupedFeatures[f[m]],s=0;s<h.length;++s)g=h[s],pusho(j,g.type,g);if(a.groups[u]&&!a.groups[u].links||0==a.groups[u].links.length)a.groups[u].links=a.groups[f[0]].links;delete a.groupedFeatures[f[m]]}for(var o in j){for(var p=j[o],r=p[0],h=null,s=0;s<p.length;++s)g=p[s],g=new Range(g.min,g.max),h=h?union(h,g):g;for(var w=h.ranges(),h=0;h<w.length;++h){for(var v=w[h],
t=((v.max()|0)-(v.min()|0)+1)*f.length,q=0,s=0;s<p.length;++s)if(g=p[s],(g.min|0)<=v.max()&&(g.max|0)>=v.min())var z=Math.max(g.min|0,v.min()),g=Math.min(g.max|0,v.max()),q=q+(g-z+1);g=new DASFeature;for(k in r)g[k]=r[k];g.min=v.min();g.max=v.max();g.label&&1<f.length&&(g.label+=" ("+f.length+" vars)");g.visualWeight=1*q/t;pusho(a.groupedFeatures,u,g)}}delete a.superGroups[u]}f=[];for(var x in a.groupedFeatures)f.push(x);f.sort(function(b,c){var d=a.groupedFeatures[b][0].score-a.groupedFeatures[c][0].score;
return 0<d?-1:0==d?0:1});o={};for(h=0;h<f.length;++h)x=f[h],(m=glyphsForGroup(a.groupedFeatures[x],0,a.groups[x],a,a.dasSource.collapseSuperGroups&&!a.bumped?"collapsed_gene":"tent"))&&(o[x]=m);for(u in a.superGroups){f=a.superGroups[u];x=[];h=1E10;g=-1E10;for(j=0;j<f.length;++j)s=o[f[j]],o[f[j]]=null,s&&(x.push(s),h=Math.min(h,s.min),g=Math.max(g,s.max));for(j=0;j<x.length;++j)s=x[j],s.min=h,s.max=g,e.push(s)}for(m in o)(s=o[m])&&e.push(s);u=new DSubTier;x=[];h=!1;g=a.dasSource.subtierMax||DEFAULT_SUBTIER_MAX;
f=0;a:for(;f<e.length;++f)if(m=e[f],m=labelGlyph(a,m,b),m.bump&&(h=!0),m.bump&&(a.bumped||a.dasSource.collapseSuperGroups)){for(j=0;j<x.length;++j)if(o=x[j],o.hasSpaceFor(m)){o.add(m);continue a}x.length>=g?a.status="Too many overlapping features, truncating at "+g:(o=new DSubTier,o.add(m),x.push(o))}else u.add(m);a.hasBumpedFeatures=h;0<u.glyphs.length&&(x=[u].concat(x));u=[];d&&u.push(c);for(h=0;h<x.length;++h){o=x[h];g=o.glyphs;g=g.sort(function(a,b){return a.zindex-b.zindex});for(f=0;f<g.length;++f)m=
g[f],m.glyph&&(gypos=c,m.height<o.height&&(gypos+=o.height-m.height),m.glyph.setAttribute("transform","translate(0, "+gypos+")"),m.glyph.setAttribute("cursor","pointer"),b.appendChild(m.glyph));m.quant&&(a.isLabelValid=!1,a.isQuantitative=!0,a.min=m.quant.min,a.max=m.quant.max,a.clientMin=c+o.height,a.clientMax=c);c+=o.height+MIN_PADDING;u.push(c)}c=Math.max(a.browser.minTierHeight,c);if(2>u.length&&(b=!1,m=c,x=a.stylesheet)){f=zoomForScale(a.browser.scale);for(h=0;h<x.styles.length;++h)if(o=x.styles[h],
!o.zoom||o.zoom==f)o=o.style,o.bump&&(b=!0),o.height&&4+o.height>m&&(m=4+o.height);b&&(c=2*m)}a.wantedLayoutHeight=c;if(!a.layoutWasDone||a.browser.autoSizeTiers){a.layoutHeight=c;if(0<e.length||d)a.layoutWasDone=!0;a.placard=null}else if(a.layoutHeight!=c){e=document.createElementNS(NS_SVG,"g");d=document.createElementNS(NS_SVG,"rect");d.setAttribute("x",0);d.setAttribute("y",-20);d.setAttribute("width",a.browser.featurePanelWidth);d.setAttribute("height",20);d.setAttribute("stroke","red");d.setAttribute("stroke-width",
1);d.setAttribute("fill","white");e.appendChild(d);d=document.createElementNS(NS_SVG,"text");d.setAttribute("stroke","none");d.setAttribute("fill","red");d.setAttribute("font-family","helvetica");d.setAttribute("font-size","10pt");if(a.layoutHeight<c){for(b=0;a.layoutHeight-20>=u[b];)++b;d.appendChild(document.createTextNode("Show "+(u.length-b)+" more"))}else d.appendChild(document.createTextNode("Show less"));d.setAttribute("x",80);d.setAttribute("y",-6);e.appendChild(d);d=document.createElementNS(NS_SVG,
"path");d.setAttribute("fill","red");d.setAttribute("stroke","none");a.layoutHeight<c?d.setAttribute("d","M 30 -16 L 42 -16 L 36 -4 Z"):d.setAttribute("d","M 30 -4 L 42 -4 L 36 -16 Z");e.appendChild(d);e.addEventListener("mousedown",function(){a.layoutHeight=a.wantedLayoutHeight;a.placard=null;a.clipTier();a.browser.arrangeTiers()},!1);d=document.createElementNS(NS_SVG,"text");d.setAttribute("stroke","none");d.setAttribute("fill","red");d.setAttribute("font-family","helvetica");d.setAttribute("font-size",
"10pt");d.appendChild(document.createTextNode("(Auto grow-shrink)"));d.setAttribute("x",750);d.setAttribute("y",-6);d.addEventListener("mousedown",function(b){b.preventDefault();b.stopPropagation();a.browser.autoSizeTiers=!0;a.browser.refresh()},!1);e.appendChild(d);a.placard=e}e=a.error||a.status;null!=e&&(c=document.createElementNS(NS_SVG,"g"),d=document.createElementNS(NS_SVG,"rect"),d.setAttribute("x",0),d.setAttribute("y",-20),d.setAttribute("width",a.browser.featurePanelWidth),d.setAttribute("height",
20),d.setAttribute("stroke","red"),d.setAttribute("stroke-width",1),d.setAttribute("fill","white"),c.appendChild(d),b=document.createElementNS(NS_SVG,"text"),b.setAttribute("stroke","none"),b.setAttribute("fill","red"),b.setAttribute("font-family","helvetica"),b.setAttribute("font-size","10pt"),b.setAttribute("x",25),b.setAttribute("y",-6),b.appendChild(document.createTextNode(e)),a.error&&(d=document.createElementNS(NS_SVG,"text"),d.setAttribute("stroke","none"),d.setAttribute("fill","red"),d.setAttribute("font-family",
"helvetica"),d.setAttribute("font-size","10pt"),d.appendChild(document.createTextNode("(Remove track)")),d.setAttribute("x",800),d.setAttribute("y",-6),d.addEventListener("mousedown",function(b){b.preventDefault();b.stopPropagation();a.browser.removeTier(a)},!1),c.appendChild(d)),c.appendChild(b),a.placard=c);a.clipTier();a.scale=1}
DasTier.prototype.clipTier=function(){var a=this.viewport;this.background.setAttribute("height",this.layoutHeight);var b="tier_clip_"+ ++clipIdSeed,c=document.createElementNS(NS_SVG,"clipPath");c.setAttribute("id",b);var e=document.createElementNS(NS_SVG,"rect");e.setAttribute("x",-5E5);e.setAttribute("y",0);e.setAttribute("width",1E6);e.setAttribute("height",this.layoutHeight);c.appendChild(e);a.appendChild(c);a.setAttribute("clip-path","url(#"+b+")")};
function glyphsForGroup(a,b,c,e,d){for(var f=e.browser.scale,h=e.browser.origin,g=1,j,m=null,u=null,s=null,o=null,p=null,r,w=e.styleForFeature(c),v=0;v<a.length;++v){var t=a[v],q=e.styleForFeature(t);q&&q.HEIGHT&&(r=r?Math.max(r,q.HEIGHT|0):q.HEIGHT|0)}var z=document.createElementNS(NS_SVG,"g"),x=[];z.dalliance_group=c;for(var C=[],v=0;v<a.length;++v)if(t=a[v],t.orientation&&null==o&&(o=t.orientation),t.notes&&null==u&&(u=t.notes),t.links&&null==m&&(m=t.links),(q=e.styleForFeature(t))&&!t.parts)(t=
glyphForFeature(t,b,q,e,r))&&t.glyph&&C.push(t);if(0==C.length)return null;C=C.sort(function(a,b){return a.zindex-b.zindex});for(v=0;v<C.length;++v)if(t=C[v],t.glyph.dalliance_group=c,x.push(t.glyph),m=new Range(t.min,t.max),s=null==s?m:union(s,m),g=Math.max(g,t.height),!j&&t.label&&(j=t.label),t.quant)p=t.quant;if(s){C=s.ranges();for(v=1;v<C.length;++v){m=(C[v-1].max()+1-h)*f;r=(C[v].min()-h)*f;if("collapsed_gene"==d){t=document.createElementNS(NS_SVG,"path");t.setAttribute("fill","none");t.setAttribute("stroke",
"black");t.setAttribute("stroke-width","1");var q=g/2,E="M "+m+" "+(b+q)+" L "+r+" "+(b+q);if(8<r-m){var A=0.5*r+0.5*m;"+"==o?E+=" M "+(A-2)+" "+(b+q-4)+" L "+(A+2)+" "+(b+q)+" L "+(A-2)+" "+(b+q+4):"-"==o&&(E+=" M "+(A+2)+" "+(b+q-4)+" L "+(A-2)+" "+(b+q)+" L "+(A+2)+" "+(b+q+4))}t.setAttribute("d",E)}else t=document.createElementNS(NS_SVG,"path"),t.setAttribute("fill","none"),t.setAttribute("stroke","black"),t.setAttribute("stroke-width","1"),E=!0,w&&(w.STYLE&&"hat"!=w.STYLE)&&(E=!1),q=p?g:g/2,
E&&("+"==o||"-"==o)?(A=(m+r)/2,t.setAttribute("d","M "+m+" "+(b+q)+" L "+A+" "+("-"==o?b+12:b)+" L "+r+" "+(b+q))):t.setAttribute("d","M "+m+" "+(b+q)+" L "+r+" "+(b+q));z.appendChild(t)}}for(v=0;v<x.length;++v)z.appendChild(x[v]);c.segment=a[0].segment;c.min=s.min();c.max=s.max();if(u&&(!c.notes||0==c.notes.length))c.notes=u;a=new DGlyph(z,s.min(),s.max(),g);a.strand=o;a.bump=!0;if(j||w&&(w.LABEL||w.LABELS))if(a.label=c.label||j,(j=e.groupsToSupers[c.id])&&e.superGroups[j]&&c.id!=e.superGroups[j][0])a.label=
null;p&&(a.quant=p);return a}
function glyphForFeature(a,b,c,e,d){var f=e.browser.scale,h=e.browser.origin,g=c.glyph||"BOX",j,m=a.min,u=a.max,s=a.orientation,o=a.score,p=(m-h)*f,r=(u-h+1)*f,w,v;if("HIDDEN"==g||a.parts)j=null;else if("CROSS"==g||"EX"==g||"SPAN"==g||"LINE"==g||"DOT"==g||"TRIANGLE"==g){var h=c.FGCOLOR||"black",t=c.BGCOLOR||"none",d=c.HEIGHT||d||12;w=d*=1;j=(p+r)/2;var o=d/2,q,f=p,e=r;"CROSS"==g?(q=document.createElementNS(NS_SVG,"path"),q.setAttribute("fill","none"),q.setAttribute("stroke",h),q.setAttribute("stroke-width",
1),q.setAttribute("d","M "+(j-o)+" "+(b+o)+" L "+(j+o)+" "+(b+o)+" M "+j+" "+b+" L "+j+" "+(b+d)),f=Math.min(p,j-o),e=Math.max(r,j+o)):"EX"==g?(q=document.createElementNS(NS_SVG,"path"),q.setAttribute("fill","none"),q.setAttribute("stroke",h),q.setAttribute("stroke-width",1),q.setAttribute("d","M "+(j-o)+" "+b+" L "+(j+o)+" "+(b+d)+" M "+(j+o)+" "+b+" L "+(j-o)+" "+(b+d)),f=Math.min(p,j-o),e=Math.max(r,j+o)):"SPAN"==g?(q=document.createElementNS(NS_SVG,"path"),q.setAttribute("fill","none"),q.setAttribute("stroke",
h),q.setAttribute("stroke-width",1),q.setAttribute("d","M "+p+" "+(b+o)+" L "+r+" "+(b+o)+" M "+p+" "+b+" L "+p+" "+(b+d)+" M "+r+" "+b+" L "+r+" "+(b+d))):"LINE"==g?(j=c.STYLE||"solid",q=document.createElementNS(NS_SVG,"path"),q.setAttribute("fill","none"),q.setAttribute("stroke",h),q.setAttribute("stroke-width",1),"hat"==j?(h=0,"-"==a.orientation&&(h=d),q.setAttribute("d","M "+p+" "+(b+o)+" L "+(r+p)/2+" "+(b+h)+" L "+r+" "+(b+o))):q.setAttribute("d","M "+p+" "+(b+o)+" L "+r+" "+(b+o)),"dashed"==
j&&q.setAttribute("stroke-dasharray","3")):"DOT"==g?(q=document.createElementNS(NS_SVG,"circle"),q.setAttribute("fill",h),q.setAttribute("stroke","none"),q.setAttribute("cx",j),q.setAttribute("cy",b+o),q.setAttribute("r",o),f=Math.min(p,j-o),e=Math.max(r,j+o)):"TRIANGLE"==g&&(f=c.DIRECTION||"N","FORWARD"===f?f="-"===s?"W":"E":"REVERSE"===f&&(f="-"===s?"E":"W"),e=c.LINEWIDTH||d,halfHeight=0.5*d,halfWidth=0.5*e,q=document.createElementNS(NS_SVG,"path"),"E"==f?q.setAttribute("d","M "+(j-halfWidth)+" 0 L "+
(j-halfWidth)+" "+d+" L "+(j+halfWidth)+" "+halfHeight+" Z"):"W"==f?q.setAttribute("d","M "+(j+halfWidth)+" 0 L "+(j+halfWidth)+" "+d+" L "+(j-halfWidth)+" "+halfHeight+" Z"):"S"==f?q.setAttribute("d","M "+(j+halfWidth)+" 0 L "+(j-halfWidth)+" 0 L "+j+" "+d+" Z"):q.setAttribute("d","M "+(j+halfWidth)+" "+d+" L "+(j-halfWidth)+" "+d+" L "+j+" 0 Z"),f=Math.min(p,j-halfWidth),e=Math.max(r,j+halfWidth),q.setAttribute("fill",h),q.setAttribute("stroke","none"));j=document.createElementNS(NS_SVG,"g");if("none"==
t||f<p||e>r)h=document.createElementNS(NS_SVG,"rect"),h.setAttribute("x",f),h.setAttribute("y",b),h.setAttribute("width",e-f),h.setAttribute("height",d),h.setAttribute("stroke","none"),h.setAttribute("fill","none"),h.setAttribute("pointer-events","all"),j.appendChild(h);"none"!=t&&(h=document.createElementNS(NS_SVG,"rect"),h.setAttribute("x",p),h.setAttribute("y",b),h.setAttribute("width",r-p),h.setAttribute("height",d),h.setAttribute("stroke","none"),h.setAttribute("fill",t),h.setAttribute("pointer-events",
"all"),j.appendChild(h));j.appendChild(q)}else if("PRIMERS"==g)b=c.BGCOLOR||"black",d=c.HEIGHT||d||12,w=d*=1,j=document.createElementNS(NS_SVG,"g"),h=document.createElementNS(NS_SVG,"path"),h.setAttribute("stroke",b),h.setAttribute("fill","none"),h.setAttribute("d","M "+p+" "+d/2+" L "+r+" "+d/2),j.appendChild(h),b=document.createElementNS(NS_SVG,"path"),b.setAttribute("stroke","none"),b.setAttribute("fill","arrowColor"),b.setAttribute("d","M "+p+" 0 L "+p+" "+d+" L "+(p+d)+" "+d/2+" Z M "+r+" 0 L "+
r+" "+d+" L "+(r-d)+" "+d/2+" Z"),j.appendChild(b);else if("ARROW"==g)g=c.PARALLEL?"yes"==c.PARALLEL:!0,b=c.NORTHEAST&&"yes"==c.NORTHEAST,e=c.SOUTHWEST&&"yes"==c.SOUTHWEST,h=c.FGCOLOR||"none",t=c.BGCOLOR||"green",d=c.HEIGHT||d||12,w=d*=1,q=g?0.5*d:0.25*d,s=(r+p)/2,f=g?0.25*d:0.4*d,g?(b&&r-s<d&&(r=s+d),e&&s-p<d&&(p=s-d)):r-p<0.75*d&&(p=s-0.375*d,r=s+0.375*d),j=document.createElementNS(NS_SVG,"path"),j.setAttribute("fill",t),j.setAttribute("stroke",h),"none"!=h&&j.setAttribute("stroke-width",1),g?(h=
"M "+s+" "+f,h=b?h+(" L "+(r-q)+" "+f+" L "+(r-q)+" 0 L "+r+" "+d/2+" L "+(r-q)+" "+d+" L "+(r-q)+" "+(d-f)):h+(" L "+r+" "+f+" L "+r+" "+(d-f)),h=e?h+(" L "+(p+q)+" "+(d-f)+" L "+(p+q)+" "+d+" L "+p+" "+d/2+" L "+(p+q)+"  0 L "+(p+q)+" "+f):h+(" L "+p+" "+(d-f)+" L "+p+" "+f)):(h="M "+(p+f)+" "+d/2,h=b?h+(" L "+(p+f)+" "+q+" L "+p+" "+q+" L "+s+" 0 L "+r+" "+q+" L "+(r-f)+" "+q):h+(" L "+(p+f)+" 0 L "+(r-f)+" 0"),h=e?h+(" L "+(r-f)+" "+(d-q)+" L "+r+" "+(d-q)+" L "+s+" "+d+" L "+p+" "+(d-q)+" L "+
(p+f)+" "+(d-q)):h+(" L "+(r-f)+" "+d+" L "+(p+f)+" "+d)),j.setAttribute("d",h+" Z");else if("ANCHORED_ARROW"==g)h=c.FGCOLOR||"none",t=c.BGCOLOR||"green",d=c.HEIGHT||d||12,w=d*=1,g=e=0,j=d+2,f=0.333333*d,a.orientation&&("+"==a.orientation?g=d/2:"-"==a.orientation&&(e=d/2)),r-p<j&&(p=(r+p-j)/2,r=p+j),j=document.createElementNS("http://www.w3.org/2000/svg","path"),j.setAttribute("fill",t),j.setAttribute("stroke",h),"none"!=h&&j.setAttribute("stroke-width",1),j.setAttribute("d","M "+(p+e)+" "+(b+f)+
" L "+(r-g)+" "+(b+f)+" L "+(r-g)+" "+b+" L "+r+" "+(b+d/2)+" L "+(r-g)+" "+(b+d)+" L "+(r-g)+" "+(b+f+f)+" L "+(p+e)+" "+(b+f+f)+" L "+(p+e)+" "+(b+d)+" L "+p+" "+(b+d/2)+" L "+(p+e)+" "+b+" L "+(p+e)+" "+(b+f));else if("TEXT"==g)t=c.FGCOLOR||"none",b=c.BGCOLOR||"none",d=c.HEIGHT||d||12,j=c.STRING,w=d,j?(j=makeElementNS(NS_SVG,"text",j,{stroke:"none",fill:t}),e.viewport.appendChild(j),t=j.getBBox(),e.viewport.removeChild(j),j.setAttribute("x",(p+r-t.width)/2),j.setAttribute("y",d-2),j="none"==b?
j:makeElementNS(NS_SVG,"g",[makeElementNS(NS_SVG,"rect",null,{x:p,y:0,width:r-p,height:d,fill:b,stroke:"none"}),j]),t.width>r-p&&(u=p+t.width,m=((p+r-t.width)/2/f|0)+h,u=(u/f|0)+h)):j=null;else{h=c.FGCOLOR||"none";t=a.override_color||c.BGCOLOR||c.COLOR1||"green";d=c.HEIGHT||d||12;w=d*=1;c.WIDTH?(q=c.WIDTH|0,p=(r+p-q)/2,r=p+q):r-p<MIN_FEATURE_PX&&(p=(r+p-MIN_FEATURE_PX)/2,r=p+MIN_FEATURE_PX);if(("HISTOGRAM"==g||"GRADIENT"==g)&&"undefined"!==o){q=e.dasSource.forceMin||c.MIN||e.currentFeaturesMinScore;
(s=e.dasSource.forceMax||c.MAX||e.currentFeaturesMaxScore)||(s=0>q?0:10);q||(q=0);1*o<1*q&&(o=q);1*o>1*s&&(o=s);o=(1*o-q)/(s-q);if(c.COLOR2){var z,x;c.COLOR3?0.5>o?(t=dasColourForName(c.COLOR1),z=dasColourForName(c.COLOR2),x=2*o):(t=dasColourForName(c.COLOR2),z=dasColourForName(c.COLOR3),x=2*o-1):(t=dasColourForName(c.COLOR1),z=dasColourForName(c.COLOR2),x=o);t=(new DColour(t.red*(1-x)+z.red*x|0,t.green*(1-x)+z.green*x|0,t.blue*(1-x)+z.blue*x|0)).toSvgString()}"HISTOGRAM"==g&&(v=-1*q/(s-q),o>=v?(d=
Math.max(1,(o-v)*w),b=b+(1-v)*w-d):(d=Math.max(1,(v-o)*w),b+=(1-v)*w),v={min:q,max:s});p-=0.25;r+=0.25}q=document.createElementNS(NS_SVG,"rect");q.setAttribute("x",p);q.setAttribute("y",b);q.setAttribute("width",r-p);q.setAttribute("height",d);q.setAttribute("stroke",h);q.setAttribute("stroke-width",1);q.setAttribute("fill",t);a.visualWeight&&1>a.visualWeight&&(q.setAttribute("fill-opacity",a.visualWeight),"none"!=h&&q.setAttribute("stroke-opacity",a.visualWeight));if("TOOMANY"==g){b=[q];for(t=3;t<
d;t+=3)b.push(makeElementNS(NS_SVG,"line",null,{x1:p,y1:t,x2:r,y2:t,stroke:h,strokeWidth:0.5}));j=makeElementNS(NS_SVG,"g",b)}else if(a.seq&&1<=f){e.currentSequence&&(j=e.currentSequence);r=a.seq.toUpperCase();h=[];for(t=0;t<r.length;++t)g=r.substr(t,1),e=null,j&&j.seq&&j.start<=m&&j.end>=u&&j.seq.substr((m|0)+(t|0)-(j.start|0),1).toUpperCase()!==g&&(e="red"),e||(e="gray"),8<=f?(w=document.createElementNS(NS_SVG,"text"),w.setAttribute("x",p+t*f),w.setAttribute("y",12),w.setAttribute("stroke","none"),
w.setAttribute("fill",e),w.appendChild(document.createTextNode(g)),h.push(w),w=14):(g=document.createElementNS(NS_SVG,"rect"),g.setAttribute("x",p+t*f),g.setAttribute("y",b),g.setAttribute("height",d),g.setAttribute("width",f),g.setAttribute("fill",e),g.setAttribute("stroke","none"),h.push(g));8<=f?(m-=1,u+=1):(m=Math.floor(m-1/f)|0,u=Math.ceil(u+1/f)|0);j=makeElementNS(NS_SVG,"g",h)}else j=q}j&&(j.dalliance_feature=a);m=new DGlyph(j,m,u,w);if(c.LABEL&&(a.label||a.id))m.label=a.label||a.id;c.BUMP&&
(m.bump=!0);m.strand=a.orientation||"0";v&&(m.quant=v);m.zindex=c.ZINDEX||0;return m}
function labelGlyph(a,b,c){var e=a.browser.scale,d=a.browser.origin;if(!1!==a.dasSource.labels&&b.glyph&&b.label){var f=b.label,a=document.createElementNS(NS_SVG,"text");a.setAttribute("x",(b.min-d)*e);a.setAttribute("y",b.height+15);a.setAttribute("stroke-width",0);a.setAttribute("fill","black");a.setAttribute("class","label-text");a.setAttribute("font-family","helvetica");a.setAttribute("font-size","10pt");a.appendChild(document.createTextNode(f));c.appendChild(a);f=a.getBBox().width;c.removeChild(a);
"g"==b.glyph.localName?c=b.glyph:(c=document.createElementNS(NS_SVG,"g"),c.appendChild(b.glyph));c.appendChild(a);b.glyph=c;b.height+=20;c=(b.min|0)+(f+10)/e;if(c>b.max){var f=(c-b.max)/2,h=(b.min-f-d)*e+5;a.setAttribute("x",h);b.min=h/e+d|0;b.max=c-f|0}else a.jiggleMin=(b.min-d)*e,a.jiggleMax=(b.max-d)*e-f}return b}MIN_FEATURE_PX=1;MIN_PADDING=3;DEFAULT_SUBTIER_MAX=25;function DColour(a,b,c,e){this.red=a|0;this.green=b|0;this.blue=c|0;e&&(this.name=e)}
DColour.prototype.toSvgString=function(){this.name||(this.name="rgb("+this.red+","+this.green+","+this.blue+")");return this.name};palette={red:new DColour(255,0,0,"red"),green:new DColour(0,255,0,"green"),blue:new DColour(0,0,255,"blue"),yellow:new DColour(255,255,0,"yellow"),white:new DColour(255,255,255,"white"),black:new DColour(0,0,0,"black")};COLOR_RE=/^#([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/;
function dasColourForName(a){var b=palette[a];b||((b=COLOR_RE.exec(a))?b=new DColour("0x"+b[1]|0,"0x"+b[2]|0,"0x"+b[3]|0,a):(dlog("couldn't handle color: "+a),b=palette.black),palette[a]=b);return new DColour(0,0,255,"blue")}function DGlyph(a,b,c,e){this.glyph=a;this.min=b;this.max=c;this.height=e;this.zindex=0}function DSubTier(){this.glyphs=[];this.height=0}DSubTier.prototype.add=function(a){this.glyphs.push(a);this.height=Math.max(this.height,a.height)};
DSubTier.prototype.hasSpaceFor=function(a){for(var b=0;b<this.glyphs.length;++b){var c=this.glyphs[b];if(c.min<=a.max&&c.max>=a.min)return!1}return!0};
DasTier.prototype.styleForFeature=function(a){var b=zoomForScale(this.browser.scale);if(!this.stylesheet)return null;for(var c=null,e=this.stylesheet.styles,d=0;d<e.length;++d){var f=e[d];if(!(f.zoom&&f.zoom!=b)&&(!f.label||RegExp("^"+f.label+"$").test(a.label)))if(!f.method||RegExp("^"+f.method+"$").test(a.method)){if(f.type)if("default"==f.type){c||(c=f.style);continue}else if(f.type!=a.type)continue;return f.style}}return c};
function drawLine(a,b,c,e,d){var f=e.browser.origin,h=e.browser.scale,g=c.HEIGHT||30,j=e.dasSource.forceMin||c.MIN||e.currentFeaturesMinScore||0,m=e.dasSource.forceMax||c.MAX||e.currentFeaturesMaxScore||10,u=1*g/(m-j),s=c.LINEWIDTH||1,o=c.COLOR||c.COLOR1||"black",c=document.createElementNS(NS_SVG,"path");c.setAttribute("fill","none");c.setAttribute("stroke",o);c.setAttribute("stroke-width",s);s="";for(o=0;o<b.length;++o)var p=b[o],r=(((p.min|0)+(p.max|0))/2-f)*h,p=d+(g-((p.score-1*j)*u|0)),s=0==o?
"M "+r+" "+p:s+(" L "+r+" "+p);c.setAttribute("d",s);a.appendChild(c);b="line_clip_"+ ++clipIdSeed;f=document.createElementNS(NS_SVG,"clipPath");f.setAttribute("id",b);h=document.createElementNS(NS_SVG,"rect");h.setAttribute("x",-5E5);h.setAttribute("y",d-1);h.setAttribute("width",1E6);h.setAttribute("height",g+2);f.appendChild(h);a.appendChild(f);c.setAttribute("clip-path","url(#"+b+")");e.isQuantitative||(e.isQuantitative=!0,e.isLabelValid=!1);e.min!=j&&(e.min=j,e.isLabelValid=!1);e.max!=m&&(e.max=
m,e.isLabelValid=!1);e.clientMin!=d|0+g&&(e.clientMin=d|0+g,e.isLabelValid=!1);e.clientMax!=d&&(e.clientMax=d,e.isLabelValid=!1);return g|0+MIN_PADDING}
function sortFeatures(a){for(var b={},c={},e={},d={},f={},h=[],g,j,m,u=function(){m={};for(var b=0;b<a.currentFeatures.length;++b){var c=a.currentFeatures[b];c.id&&(m[c.id]=c)}},s=function(a){var b=[];if(a.parents)for(var c=0;c<a.parents.length;++c){var d=a.parents[c],e=m[d];e&&"SO:0000704"==e.typeCv&&pushnew(b,d)}return b},o=0;o<a.currentFeatures.length;++o){var p=a.currentFeatures[o];if(!p.parts)if(!p.min||!p.max)h.push(p);else{if(p.score&&"."!=p.score&&"-"!=p.score){sc=1*p.score;if(!g||sc<g)g=
sc;if(!j||sc>j)j=sc}var r=[],w=null;if(p.groups)for(var v=0;v<p.groups.length;++v){var t=p.groups[v],q=t.id;"gene"==t.type?(w=q,e[q]=shallowCopy(t)):"translation"!=t.type&&(pusho(c,q,p),e[q]=shallowCopy(t),r.push(q))}if(p.parents){m||u();for(v=0;v<p.parents.length;++v)if(t=p.parents[v],q=m[t])if(q.parts||(q.parts=[p]),pushnewo(c,t,q),pusho(c,t,p),e[t]||(e[t]={type:q.type,id:q.id,label:q.label||q.id}),r.push(t),t=s(q),0<t.length)w=t[0],q=m[t[0]],e[t[0]]={type:q.type,id:q.id,label:q.label||q.id},a.dasSource.collapseSuperGroups||
(a.dasSource.collapseSuperGroups=!0,a.isLabelValid=!1)}if(0==r.length)pusho(b,p.type,p);else if(w)for(t=0;t<r.length;++t)q=r[t],pushnewo(d,w,q),f[q]=w}}a.ungroupedFeatures=b;a.groupedFeatures=c;a.groups=e;a.superGroups=d;a.groupsToSupers=f;g&&(0<g?g=0:0>j&&(j=0),a.currentFeaturesMinScore=g,a.currentFeaturesMaxScore=j)}clipIdSeed=0;
function drawFeatureTier(a){sortFeatures(a);a.placard=null;a.isQuantitative=!1;for(var b=a.viewport;0<b.childNodes.length;)b.removeChild(b.firstChild);b.appendChild(a.background);drawGuidelines(a,b);var c=MIN_PADDING,e=[],d=!1,f;for(f in a.ungroupedFeatures){var h=a.ungroupedFeatures[f],g=a.styleForFeature(h[0]);if(g)if("LINEPLOT"==g.glyph)c+=Math.max(drawLine(b,h,g,a,c)),d=!0;else for(var j=0;j<h.length;++j)if(g=h[j],!g.parts){var m=glyphForFeature(g,0,a.styleForFeature(g),a);e.push(m)}}if(a.dasSource.collapseSuperGroups&&
!a.bumped)for(var u in a.superGroups){f=a.superGroups[u];a.groups[u].type=a.groups[f[0]].type;j={};for(m=0;m<f.length;++m){for(var h=a.groupedFeatures[f[m]],s=0;s<h.length;++s)g=h[s],pusho(j,g.type,g);if(a.groups[u]&&!a.groups[u].links||0==a.groups[u].links.length)a.groups[u].links=a.groups[f[0]].links;delete a.groupedFeatures[f[m]]}for(var o in j){for(var p=j[o],r=p[0],h=null,s=0;s<p.length;++s)g=p[s],g=new Range(g.min,g.max),h=h?union(h,g):g;for(var w=h.ranges(),h=0;h<w.length;++h){for(var v=w[h],
t=((v.max()|0)-(v.min()|0)+1)*f.length,q=0,s=0;s<p.length;++s)if(g=p[s],(g.min|0)<=v.max()&&(g.max|0)>=v.min())var z=Math.max(g.min|0,v.min()),g=Math.min(g.max|0,v.max()),q=q+(g-z+1);g=new DASFeature;for(k in r)g[k]=r[k];g.min=v.min();g.max=v.max();g.label&&1<f.length&&(g.label+=" ("+f.length+" vars)");g.visualWeight=1*q/t;pusho(a.groupedFeatures,u,g)}}delete a.superGroups[u]}f=[];for(var x in a.groupedFeatures)f.push(x);f.sort(function(b,c){var d=a.groupedFeatures[b][0].score-a.groupedFeatures[c][0].score;
return 0<d?-1:0==d?0:1});o={};for(h=0;h<f.length;++h)x=f[h],(m=glyphsForGroup(a.groupedFeatures[x],0,a.groups[x],a,a.dasSource.collapseSuperGroups&&!a.bumped?"collapsed_gene":"tent"))&&(o[x]=m);for(u in a.superGroups){f=a.superGroups[u];x=[];h=1E10;g=-1E10;for(j=0;j<f.length;++j)s=o[f[j]],o[f[j]]=null,s&&(x.push(s),h=Math.min(h,s.min),g=Math.max(g,s.max));for(j=0;j<x.length;++j)s=x[j],s.min=h,s.max=g,e.push(s)}for(m in o)(s=o[m])&&e.push(s);u=new DSubTier;x=[];h=!1;g=a.dasSource.subtierMax||DEFAULT_SUBTIER_MAX;
f=0;a:for(;f<e.length;++f)if(m=e[f],m=labelGlyph(a,m,b),m.bump&&(h=!0),m.bump&&(a.bumped||a.dasSource.collapseSuperGroups)){for(j=0;j<x.length;++j)if(o=x[j],o.hasSpaceFor(m)){o.add(m);continue a}x.length>=g?a.status="Too many overlapping features, truncating at "+g:(o=new DSubTier,o.add(m),x.push(o))}else u.add(m);a.hasBumpedFeatures=h;0<u.glyphs.length&&(x=[u].concat(x));u=[];d&&u.push(c);for(h=0;h<x.length;++h){o=x[h];g=o.glyphs;g=g.sort(function(a,b){return a.zindex-b.zindex});for(f=0;f<g.length;++f)m=
g[f],m.glyph&&(gypos=c,m.height<o.height&&(gypos+=o.height-m.height),m.glyph.setAttribute("transform","translate(0, "+gypos+")"),m.glyph.setAttribute("cursor","pointer"),b.appendChild(m.glyph));m.quant&&(a.isLabelValid=!1,a.isQuantitative=!0,a.min=m.quant.min,a.max=m.quant.max,a.clientMin=c+o.height,a.clientMax=c);c+=o.height+MIN_PADDING;u.push(c)}c=Math.max(a.browser.minTierHeight,c);if(2>u.length&&(b=!1,m=c,x=a.stylesheet)){f=zoomForScale(a.browser.scale);for(h=0;h<x.styles.length;++h)if(o=x.styles[h],
!o.zoom||o.zoom==f)o=o.style,o.bump&&(b=!0),o.height&&4+o.height>m&&(m=4+o.height);b&&(c=2*m)}a.wantedLayoutHeight=c;if(!a.layoutWasDone||a.browser.autoSizeTiers){a.layoutHeight=c;if(0<e.length||d)a.layoutWasDone=!0;a.placard=null}else if(a.layoutHeight!=c){e=document.createElementNS(NS_SVG,"g");d=document.createElementNS(NS_SVG,"rect");d.setAttribute("x",0);d.setAttribute("y",-20);d.setAttribute("width",a.browser.featurePanelWidth);d.setAttribute("height",20);d.setAttribute("stroke","red");d.setAttribute("stroke-width",
1);d.setAttribute("fill","white");e.appendChild(d);d=document.createElementNS(NS_SVG,"text");d.setAttribute("stroke","none");d.setAttribute("fill","red");d.setAttribute("font-family","helvetica");d.setAttribute("font-size","10pt");if(a.layoutHeight<c){for(b=0;a.layoutHeight-20>=u[b];)++b;d.appendChild(document.createTextNode("Show "+(u.length-b)+" more"))}else d.appendChild(document.createTextNode("Show less"));d.setAttribute("x",80);d.setAttribute("y",-6);e.appendChild(d);d=document.createElementNS(NS_SVG,
"path");d.setAttribute("fill","red");d.setAttribute("stroke","none");a.layoutHeight<c?d.setAttribute("d","M 30 -16 L 42 -16 L 36 -4 Z"):d.setAttribute("d","M 30 -4 L 42 -4 L 36 -16 Z");e.appendChild(d);e.addEventListener("mousedown",function(){a.layoutHeight=a.wantedLayoutHeight;a.placard=null;a.clipTier();a.browser.arrangeTiers()},!1);d=document.createElementNS(NS_SVG,"text");d.setAttribute("stroke","none");d.setAttribute("fill","red");d.setAttribute("font-family","helvetica");d.setAttribute("font-size",
"10pt");d.appendChild(document.createTextNode("(Auto grow-shrink)"));d.setAttribute("x",750);d.setAttribute("y",-6);d.addEventListener("mousedown",function(b){b.preventDefault();b.stopPropagation();a.browser.autoSizeTiers=!0;a.browser.refresh()},!1);e.appendChild(d);a.placard=e}e=a.error||a.status;null!=e&&(c=document.createElementNS(NS_SVG,"g"),d=document.createElementNS(NS_SVG,"rect"),d.setAttribute("x",0),d.setAttribute("y",-20),d.setAttribute("width",a.browser.featurePanelWidth),d.setAttribute("height",
20),d.setAttribute("stroke","red"),d.setAttribute("stroke-width",1),d.setAttribute("fill","white"),c.appendChild(d),b=document.createElementNS(NS_SVG,"text"),b.setAttribute("stroke","none"),b.setAttribute("fill","red"),b.setAttribute("font-family","helvetica"),b.setAttribute("font-size","10pt"),b.setAttribute("x",25),b.setAttribute("y",-6),b.appendChild(document.createTextNode(e)),a.error&&(d=document.createElementNS(NS_SVG,"text"),d.setAttribute("stroke","none"),d.setAttribute("fill","red"),d.setAttribute("font-family",
"helvetica"),d.setAttribute("font-size","10pt"),d.appendChild(document.createTextNode("(Remove track)")),d.setAttribute("x",800),d.setAttribute("y",-6),d.addEventListener("mousedown",function(b){b.preventDefault();b.stopPropagation();a.browser.removeTier(a)},!1),c.appendChild(d)),c.appendChild(b),a.placard=c);a.clipTier();a.scale=1}
DasTier.prototype.clipTier=function(){var a=this.viewport;this.background.setAttribute("height",this.layoutHeight);var b="tier_clip_"+ ++clipIdSeed,c=document.createElementNS(NS_SVG,"clipPath");c.setAttribute("id",b);var e=document.createElementNS(NS_SVG,"rect");e.setAttribute("x",-5E5);e.setAttribute("y",0);e.setAttribute("width",1E6);e.setAttribute("height",this.layoutHeight);c.appendChild(e);a.appendChild(c);a.setAttribute("clip-path","url(#"+b+")")};
function glyphsForGroup(a,b,c,e,d){for(var f=e.browser.scale,h=e.browser.origin,g=1,j,m=null,u=null,s=null,o=null,p=null,r,w=e.styleForFeature(c),v=0;v<a.length;++v){var t=a[v],q=e.styleForFeature(t);q&&q.HEIGHT&&(r=r?Math.max(r,q.HEIGHT|0):q.HEIGHT|0)}var z=document.createElementNS(NS_SVG,"g"),x=[];z.dalliance_group=c;for(var C=[],v=0;v<a.length;++v)if(t=a[v],t.orientation&&null==o&&(o=t.orientation),t.notes&&null==u&&(u=t.notes),t.links&&null==m&&(m=t.links),(q=e.styleForFeature(t))&&!t.parts)(t=
glyphForFeature(t,b,q,e,r))&&t.glyph&&C.push(t);if(0==C.length)return null;C=C.sort(function(a,b){return a.zindex-b.zindex});for(v=0;v<C.length;++v)if(t=C[v],t.glyph.dalliance_group=c,x.push(t.glyph),m=new Range(t.min,t.max),s=null==s?m:union(s,m),g=Math.max(g,t.height),!j&&t.label&&(j=t.label),t.quant)p=t.quant;if(s){C=s.ranges();for(v=1;v<C.length;++v){m=(C[v-1].max()+1-h)*f;r=(C[v].min()-h)*f;if("collapsed_gene"==d){t=document.createElementNS(NS_SVG,"path");t.setAttribute("fill","none");t.setAttribute("stroke",
"black");t.setAttribute("stroke-width","1");var q=g/2,E="M "+m+" "+(b+q)+" L "+r+" "+(b+q);if(8<r-m){var A=0.5*r+0.5*m;"+"==o?E+=" M "+(A-2)+" "+(b+q-4)+" L "+(A+2)+" "+(b+q)+" L "+(A-2)+" "+(b+q+4):"-"==o&&(E+=" M "+(A+2)+" "+(b+q-4)+" L "+(A-2)+" "+(b+q)+" L "+(A+2)+" "+(b+q+4))}t.setAttribute("d",E)}else t=document.createElementNS(NS_SVG,"path"),t.setAttribute("fill","none"),t.setAttribute("stroke","black"),t.setAttribute("stroke-width","1"),E=!0,w&&(w.STYLE&&"hat"!=w.STYLE)&&(E=!1),q=p?g:g/2,
E&&("+"==o||"-"==o)?(A=(m+r)/2,t.setAttribute("d","M "+m+" "+(b+q)+" L "+A+" "+("-"==o?b+12:b)+" L "+r+" "+(b+q))):t.setAttribute("d","M "+m+" "+(b+q)+" L "+r+" "+(b+q));z.appendChild(t)}}for(v=0;v<x.length;++v)z.appendChild(x[v]);c.segment=a[0].segment;c.min=s.min();c.max=s.max();if(u&&(!c.notes||0==c.notes.length))c.notes=u;a=new DGlyph(z,s.min(),s.max(),g);a.strand=o;a.bump=!0;if(j||w&&(w.LABEL||w.LABELS))if(a.label=c.label||j,(j=e.groupsToSupers[c.id])&&e.superGroups[j]&&c.id!=e.superGroups[j][0])a.label=
null;p&&(a.quant=p);return a}
function glyphForFeature(a,b,c,e,d){var f=e.browser.scale,h=e.browser.origin,g=c.glyph||"BOX",j,m=a.min,u=a.max,s=a.orientation,o=a.score,p=(m-h)*f,r=(u-h+1)*f,w,v;if("HIDDEN"==g||a.parts)j=null;else if("CROSS"==g||"EX"==g||"SPAN"==g||"LINE"==g||"DOT"==g||"TRIANGLE"==g){var h=c.FGCOLOR||"black",t=c.BGCOLOR||"none",d=c.HEIGHT||d||12;w=d*=1;j=(p+r)/2;var o=d/2,q,f=p,e=r;"CROSS"==g?(q=document.createElementNS(NS_SVG,"path"),q.setAttribute("fill","none"),q.setAttribute("stroke",h),q.setAttribute("stroke-width",
1),q.setAttribute("d","M "+(j-o)+" "+(b+o)+" L "+(j+o)+" "+(b+o)+" M "+j+" "+b+" L "+j+" "+(b+d)),f=Math.min(p,j-o),e=Math.max(r,j+o)):"EX"==g?(q=document.createElementNS(NS_SVG,"path"),q.setAttribute("fill","none"),q.setAttribute("stroke",h),q.setAttribute("stroke-width",1),q.setAttribute("d","M "+(j-o)+" "+b+" L "+(j+o)+" "+(b+d)+" M "+(j+o)+" "+b+" L "+(j-o)+" "+(b+d)),f=Math.min(p,j-o),e=Math.max(r,j+o)):"SPAN"==g?(q=document.createElementNS(NS_SVG,"path"),q.setAttribute("fill","none"),q.setAttribute("stroke",
h),q.setAttribute("stroke-width",1),q.setAttribute("d","M "+p+" "+(b+o)+" L "+r+" "+(b+o)+" M "+p+" "+b+" L "+p+" "+(b+d)+" M "+r+" "+b+" L "+r+" "+(b+d))):"LINE"==g?(j=c.STYLE||"solid",q=document.createElementNS(NS_SVG,"path"),q.setAttribute("fill","none"),q.setAttribute("stroke",h),q.setAttribute("stroke-width",1),"hat"==j?(h=0,"-"==a.orientation&&(h=d),q.setAttribute("d","M "+p+" "+(b+o)+" L "+(r+p)/2+" "+(b+h)+" L "+r+" "+(b+o))):q.setAttribute("d","M "+p+" "+(b+o)+" L "+r+" "+(b+o)),"dashed"==
j&&q.setAttribute("stroke-dasharray","3")):"DOT"==g?(q=document.createElementNS(NS_SVG,"circle"),q.setAttribute("fill",h),q.setAttribute("stroke","none"),q.setAttribute("cx",j),q.setAttribute("cy",b+o),q.setAttribute("r",o),f=Math.min(p,j-o),e=Math.max(r,j+o)):"TRIANGLE"==g&&(f=c.DIRECTION||"N","FORWARD"===f?f="-"===s?"W":"E":"REVERSE"===f&&(f="-"===s?"E":"W"),e=c.LINEWIDTH||d,halfHeight=0.5*d,halfWidth=0.5*e,q=document.createElementNS(NS_SVG,"path"),"E"==f?q.setAttribute("d","M "+(j-halfWidth)+" 0 L "+
(j-halfWidth)+" "+d+" L "+(j+halfWidth)+" "+halfHeight+" Z"):"W"==f?q.setAttribute("d","M "+(j+halfWidth)+" 0 L "+(j+halfWidth)+" "+d+" L "+(j-halfWidth)+" "+halfHeight+" Z"):"S"==f?q.setAttribute("d","M "+(j+halfWidth)+" 0 L "+(j-halfWidth)+" 0 L "+j+" "+d+" Z"):q.setAttribute("d","M "+(j+halfWidth)+" "+d+" L "+(j-halfWidth)+" "+d+" L "+j+" 0 Z"),f=Math.min(p,j-halfWidth),e=Math.max(r,j+halfWidth),q.setAttribute("fill",h),q.setAttribute("stroke","none"));j=document.createElementNS(NS_SVG,"g");if("none"==
t||f<p||e>r)h=document.createElementNS(NS_SVG,"rect"),h.setAttribute("x",f),h.setAttribute("y",b),h.setAttribute("width",e-f),h.setAttribute("height",d),h.setAttribute("stroke","none"),h.setAttribute("fill","none"),h.setAttribute("pointer-events","all"),j.appendChild(h);"none"!=t&&(h=document.createElementNS(NS_SVG,"rect"),h.setAttribute("x",p),h.setAttribute("y",b),h.setAttribute("width",r-p),h.setAttribute("height",d),h.setAttribute("stroke","none"),h.setAttribute("fill",t),h.setAttribute("pointer-events",
"all"),j.appendChild(h));j.appendChild(q)}else if("PRIMERS"==g)b=c.BGCOLOR||"black",d=c.HEIGHT||d||12,w=d*=1,j=document.createElementNS(NS_SVG,"g"),h=document.createElementNS(NS_SVG,"path"),h.setAttribute("stroke",b),h.setAttribute("fill","none"),h.setAttribute("d","M "+p+" "+d/2+" L "+r+" "+d/2),j.appendChild(h),b=document.createElementNS(NS_SVG,"path"),b.setAttribute("stroke","none"),b.setAttribute("fill","arrowColor"),b.setAttribute("d","M "+p+" 0 L "+p+" "+d+" L "+(p+d)+" "+d/2+" Z M "+r+" 0 L "+
r+" "+d+" L "+(r-d)+" "+d/2+" Z"),j.appendChild(b);else if("ARROW"==g)g=c.PARALLEL?"yes"==c.PARALLEL:!0,b=c.NORTHEAST&&"yes"==c.NORTHEAST,e=c.SOUTHWEST&&"yes"==c.SOUTHWEST,h=c.FGCOLOR||"none",t=c.BGCOLOR||"green",d=c.HEIGHT||d||12,w=d*=1,q=g?0.5*d:0.25*d,s=(r+p)/2,f=g?0.25*d:0.4*d,g?(b&&r-s<d&&(r=s+d),e&&s-p<d&&(p=s-d)):r-p<0.75*d&&(p=s-0.375*d,r=s+0.375*d),j=document.createElementNS(NS_SVG,"path"),j.setAttribute("fill",t),j.setAttribute("stroke",h),"none"!=h&&j.setAttribute("stroke-width",1),g?(h=
"M "+s+" "+f,h=b?h+(" L "+(r-q)+" "+f+" L "+(r-q)+" 0 L "+r+" "+d/2+" L "+(r-q)+" "+d+" L "+(r-q)+" "+(d-f)):h+(" L "+r+" "+f+" L "+r+" "+(d-f)),h=e?h+(" L "+(p+q)+" "+(d-f)+" L "+(p+q)+" "+d+" L "+p+" "+d/2+" L "+(p+q)+"  0 L "+(p+q)+" "+f):h+(" L "+p+" "+(d-f)+" L "+p+" "+f)):(h="M "+(p+f)+" "+d/2,h=b?h+(" L "+(p+f)+" "+q+" L "+p+" "+q+" L "+s+" 0 L "+r+" "+q+" L "+(r-f)+" "+q):h+(" L "+(p+f)+" 0 L "+(r-f)+" 0"),h=e?h+(" L "+(r-f)+" "+(d-q)+" L "+r+" "+(d-q)+" L "+s+" "+d+" L "+p+" "+(d-q)+" L "+
(p+f)+" "+(d-q)):h+(" L "+(r-f)+" "+d+" L "+(p+f)+" "+d)),j.setAttribute("d",h+" Z");else if("ANCHORED_ARROW"==g)h=c.FGCOLOR||"none",t=c.BGCOLOR||"green",d=c.HEIGHT||d||12,w=d*=1,g=e=0,j=d+2,f=0.333333*d,a.orientation&&("+"==a.orientation?g=d/2:"-"==a.orientation&&(e=d/2)),r-p<j&&(p=(r+p-j)/2,r=p+j),j=document.createElementNS("http://www.w3.org/2000/svg","path"),j.setAttribute("fill",t),j.setAttribute("stroke",h),"none"!=h&&j.setAttribute("stroke-width",1),j.setAttribute("d","M "+(p+e)+" "+(b+f)+
" L "+(r-g)+" "+(b+f)+" L "+(r-g)+" "+b+" L "+r+" "+(b+d/2)+" L "+(r-g)+" "+(b+d)+" L "+(r-g)+" "+(b+f+f)+" L "+(p+e)+" "+(b+f+f)+" L "+(p+e)+" "+(b+d)+" L "+p+" "+(b+d/2)+" L "+(p+e)+" "+b+" L "+(p+e)+" "+(b+f));else if("TEXT"==g)t=c.FGCOLOR||"none",b=c.BGCOLOR||"none",d=c.HEIGHT||d||12,j=c.STRING,w=d,j?(j=makeElementNS(NS_SVG,"text",j,{stroke:"none",fill:t}),e.viewport.appendChild(j),t=j.getBBox(),e.viewport.removeChild(j),j.setAttribute("x",(p+r-t.width)/2),j.setAttribute("y",d-2),j="none"==b?
j:makeElementNS(NS_SVG,"g",[makeElementNS(NS_SVG,"rect",null,{x:p,y:0,width:r-p,height:d,fill:b,stroke:"none"}),j]),t.width>r-p&&(u=p+t.width,m=((p+r-t.width)/2/f|0)+h,u=(u/f|0)+h)):j=null;else{h=c.FGCOLOR||"none";t=a.override_color||c.BGCOLOR||c.COLOR1||"green";d=c.HEIGHT||d||12;w=d*=1;c.WIDTH?(q=c.WIDTH|0,p=(r+p-q)/2,r=p+q):r-p<MIN_FEATURE_PX&&(p=(r+p-MIN_FEATURE_PX)/2,r=p+MIN_FEATURE_PX);if(("HISTOGRAM"==g||"GRADIENT"==g)&&"undefined"!==o){q=e.dasSource.forceMin||c.MIN||e.currentFeaturesMinScore;
(s=e.dasSource.forceMax||c.MAX||e.currentFeaturesMaxScore)||(s=0>q?0:10);q||(q=0);1*o<1*q&&(o=q);1*o>1*s&&(o=s);o=(1*o-q)/(s-q);if(c.COLOR2){var z,x;c.COLOR3?0.5>o?(t=dasColourForName(c.COLOR1),z=dasColourForName(c.COLOR2),x=2*o):(t=dasColourForName(c.COLOR2),z=dasColourForName(c.COLOR3),x=2*o-1):(t=dasColourForName(c.COLOR1),z=dasColourForName(c.COLOR2),x=o);t=(new DColour(t.red*(1-x)+z.red*x|0,t.green*(1-x)+z.green*x|0,t.blue*(1-x)+z.blue*x|0)).toSvgString()}"HISTOGRAM"==g&&(v=-1*q/(s-q),o>=v?(d=
Math.max(1,(o-v)*w),b=b+(1-v)*w-d):(d=Math.max(1,(v-o)*w),b+=(1-v)*w),v={min:q,max:s});p-=0.25;r+=0.25}q=document.createElementNS(NS_SVG,"rect");q.setAttribute("x",p);q.setAttribute("y",b);q.setAttribute("width",r-p);q.setAttribute("height",d);q.setAttribute("stroke",h);q.setAttribute("stroke-width",1);q.setAttribute("fill",t);a.visualWeight&&1>a.visualWeight&&(q.setAttribute("fill-opacity",a.visualWeight),"none"!=h&&q.setAttribute("stroke-opacity",a.visualWeight));if("TOOMANY"==g){b=[q];for(t=3;t<
d;t+=3)b.push(makeElementNS(NS_SVG,"line",null,{x1:p,y1:t,x2:r,y2:t,stroke:h,strokeWidth:0.5}));j=makeElementNS(NS_SVG,"g",b)}else if(a.seq&&1<=f){e.currentSequence&&(j=e.currentSequence);r=a.seq.toUpperCase();h=[];for(t=0;t<r.length;++t)g=r.substr(t,1),e=null,j&&j.seq&&j.start<=m&&j.end>=u&&j.seq.substr((m|0)+(t|0)-(j.start|0),1).toUpperCase()!==g&&(e="red"),e||(e="gray"),8<=f?(w=document.createElementNS(NS_SVG,"text"),w.setAttribute("x",p+t*f),w.setAttribute("y",12),w.setAttribute("stroke","none"),
w.setAttribute("fill",e),w.appendChild(document.createTextNode(g)),h.push(w),w=14):(g=document.createElementNS(NS_SVG,"rect"),g.setAttribute("x",p+t*f),g.setAttribute("y",b),g.setAttribute("height",d),g.setAttribute("width",f),g.setAttribute("fill",e),g.setAttribute("stroke","none"),h.push(g));8<=f?(m-=1,u+=1):(m=Math.floor(m-1/f)|0,u=Math.ceil(u+1/f)|0);j=makeElementNS(NS_SVG,"g",h)}else j=q}j&&(j.dalliance_feature=a);m=new DGlyph(j,m,u,w);if(c.LABEL&&(a.label||a.id))m.label=a.label||a.id;c.BUMP&&
(m.bump=!0);m.strand=a.orientation||"0";v&&(m.quant=v);m.zindex=c.ZINDEX||0;return m}
function labelGlyph(a,b,c){var e=a.browser.scale,d=a.browser.origin;if(!1!==a.dasSource.labels&&b.glyph&&b.label){var f=b.label,a=document.createElementNS(NS_SVG,"text");a.setAttribute("x",(b.min-d)*e);a.setAttribute("y",b.height+15);a.setAttribute("stroke-width",0);a.setAttribute("fill","black");a.setAttribute("class","label-text");a.setAttribute("font-family","helvetica");a.setAttribute("font-size","10pt");"+"==b.strand?f+=">":"-"==b.strand&&(f="<"+f);a.appendChild(document.createTextNode(f));c.appendChild(a);
f=a.getBBox().width;c.removeChild(a);"g"==b.glyph.localName?c=b.glyph:(c=document.createElementNS(NS_SVG,"g"),c.appendChild(b.glyph));c.appendChild(a);b.glyph=c;b.height+=20;c=(b.min|0)+(f+10)/e;if(c>b.max){var f=(c-b.max)/2,h=(b.min-f-d)*e+5;a.setAttribute("x",h);b.min=h/e+d|0;b.max=c-f|0}else a.jiggleMin=(b.min-d)*e,a.jiggleMax=(b.max-d)*e-f}return b}
(function(a,b){function c(a){return i.isWindow(a)?a:9===a.nodeType?a.defaultView||a.parentWindow:!1}function e(a){if(!oa[a]){var b=y.body,c=i("<"+a+">").appendTo(b),d=c.css("display");c.remove();if("none"===d||""===d){O||(O=y.createElement("iframe"),O.frameBorder=O.width=O.height=0);b.appendChild(O);if(!Y||!O.createElement)Y=(O.contentWindow||O.contentDocument).document,Y.write((i.support.boxModel?"<!doctype html>":"")+"<html><body>"),Y.close();c=Y.createElement(a);Y.body.appendChild(c);d=i.css(c,
"display");b.removeChild(O)}oa[a]=d}return oa[a]}function d(a,b){var c={};i.each(ja.concat.apply([],ja.slice(0,b)),function(){c[this]=a});return c}function f(){ka=b}function h(){setTimeout(f,0);return ka=i.now()}function g(){try{return new a.XMLHttpRequest}catch(b){}}function j(a,b,c,d){if(i.isArray(b))i.each(b,function(b,e){c||Xa.test(a)?d(a,e):j(a+"["+("object"==typeof e?b:"")+"]",e,c,d)});else if(!c&&"object"===i.type(b))for(var e in b)j(a+"["+e+"]",b[e],c,d);else d(a,b)}function m(a,c){var d,
e,f=i.ajaxSettings.flatOptions||{};for(d in c)c[d]!==b&&((f[d]?a:e||(e={}))[d]=c[d]);e&&i.extend(!0,a,e)}function u(a,c,d,e,f,g){f=f||c.dataTypes[0];g=g||{};g[f]=!0;for(var f=a[f],i=0,h=f?f.length:0,j=a===pa,m;i<h&&(j||!m);i++)m=f[i](c,d,e),"string"==typeof m&&(!j||g[m]?m=b:(c.dataTypes.unshift(m),m=u(a,c,d,e,m,g)));(j||!m)&&!g["*"]&&(m=u(a,c,d,e,"*",g));return m}function s(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");if(i.isFunction(c))for(var d=b.toLowerCase().split(za),e=0,f=d.length,
g,h;e<f;e++)g=d[e],(h=/^\+/.test(g))&&(g=g.substr(1)||"*"),g=a[g]=a[g]||[],g[h?"unshift":"push"](c)}}function o(a,b,c){var d="width"===b?a.offsetWidth:a.offsetHeight,e="width"===b?1:0;if(0<d){if("border"!==c)for(;4>e;e+=2)c||(d-=parseFloat(i.css(a,"padding"+T[e]))||0),"margin"===c?d+=parseFloat(i.css(a,c+T[e]))||0:d-=parseFloat(i.css(a,"border"+T[e]+"Width"))||0;return d+"px"}d=Z(a,b);if(0>d||null==d)d=a.style[b];if(qa.test(d))return d;d=parseFloat(d)||0;if(c)for(;4>e;e+=2)d+=parseFloat(i.css(a,"padding"+
T[e]))||0,"padding"!==c&&(d+=parseFloat(i.css(a,"border"+T[e]+"Width"))||0),"margin"===c&&(d+=parseFloat(i.css(a,c+T[e]))||0);return d+"px"}function p(a){var b=(a.nodeName||"").toLowerCase();"input"===b?r(a):"script"!==b&&"undefined"!=typeof a.getElementsByTagName&&i.grep(a.getElementsByTagName("input"),r)}function r(a){if("checkbox"===a.type||"radio"===a.type)a.defaultChecked=a.checked}function w(a){return"undefined"!=typeof a.getElementsByTagName?a.getElementsByTagName("*"):"undefined"!=typeof a.querySelectorAll?
a.querySelectorAll("*"):[]}function v(a,b){var c;1===b.nodeType&&(b.clearAttributes&&b.clearAttributes(),b.mergeAttributes&&b.mergeAttributes(a),c=b.nodeName.toLowerCase(),"object"===c?b.outerHTML=a.outerHTML:"input"!==c||"checkbox"!==a.type&&"radio"!==a.type?"option"===c?b.selected=a.defaultSelected:"input"===c||"textarea"===c?b.defaultValue=a.defaultValue:"script"===c&&b.text!==a.text&&(b.text=a.text):(a.checked&&(b.defaultChecked=b.checked=a.checked),b.value!==a.value&&(b.value=a.value)),b.removeAttribute(i.expando),
b.removeAttribute("_submit_attached"),b.removeAttribute("_change_attached"))}function t(a,b){if(1===b.nodeType&&i.hasData(a)){var c,d,e;d=i._data(a);var f=i._data(b,d),g=d.events;if(g)for(c in delete f.handle,f.events={},g){d=0;for(e=g[c].length;d<e;d++)i.event.add(b,c,g[c][d])}f.data&&(f.data=i.extend({},f.data))}}function q(a){var b=Aa.split("|"),a=a.createDocumentFragment();if(a.createElement)for(;b.length;)a.createElement(b.pop());return a}function z(a,b,c){b=b||0;if(i.isFunction(b))return i.grep(a,
function(a,d){return!!b.call(a,d,a)===c});if(b.nodeType)return i.grep(a,function(a){return a===b===c});if("string"==typeof b){var d=i.grep(a,function(a){return 1===a.nodeType});if(Ya.test(b))return i.filter(b,d,!c);b=i.filter(b,d)}return i.grep(a,function(a){return 0<=i.inArray(a,b)===c})}function x(){return!0}function C(){return!1}function E(a,b,c){var d=b+"defer",e=b+"queue",f=b+"mark",g=i._data(a,d);g&&("queue"===c||!i._data(a,e))&&("mark"===c||!i._data(a,f))&&setTimeout(function(){!i._data(a,
e)&&!i._data(a,f)&&(i.removeData(a,d,!0),g.fire())},0)}function A(a){for(var b in a)if(!("data"===b&&i.isEmptyObject(a[b]))&&"toJSON"!==b)return!1;return!0}function G(a,c,d){if(d===b&&1===a.nodeType)if(d="data-"+c.replace(M,"-$1").toLowerCase(),d=a.getAttribute(d),"string"==typeof d){try{d="true"===d?!0:"false"===d?!1:"null"===d?null:i.isNumeric(d)?+d:R.test(d)?i.parseJSON(d):d}catch(e){}i.data(a,c,d)}else d=b;return d}function B(a){var b=da[a]={},c,d,a=a.split(/\s+/);c=0;for(d=a.length;c<d;c++)b[a[c]]=
!0;return b}var y=a.document,X=a.navigator,ia=a.location,i=function(){function c(){if(!d.isReady){try{y.documentElement.doScroll("left")}catch(a){setTimeout(c,1);return}d.ready()}}var d=function(a,b){return new d.fn.init(a,b,g)},e=a.jQuery,f=a.$,g,i=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,h=/\S/,j=/^\s+/,m=/\s+$/,o=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,p=/^[\],:{}\s]*$/,q=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,r=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,s=/(?:^|:|,)(?:\s*\[)+/g,
t=/(webkit)[ \/]([\w.]+)/,u=/(opera)(?:.*version)?[ \/]([\w.]+)/,w=/(msie) ([\w.]+)/,v=/(mozilla)(?:.*? rv:([\w.]+))?/,J=/-([a-z]|[0-9])/ig,x=/^-ms-/,z=function(a,b){return(b+"").toUpperCase()},B=X.userAgent,la,aa,$a=Object.prototype.toString,ra=Object.prototype.hasOwnProperty,sa=Array.prototype.push,fa=Array.prototype.slice,Ba=String.prototype.trim,Ca=Array.prototype.indexOf,A={};d.fn=d.prototype={constructor:d,init:function(a,c,e){var D,f;if(!a)return this;if(a.nodeType)return this.context=this[0]=
a,this.length=1,this;if("body"===a&&!c&&y.body)return this.context=y,this[0]=y.body,this.selector=a,this.length=1,this;if("string"==typeof a){"<"!==a.charAt(0)||">"!==a.charAt(a.length-1)||3>a.length?D=i.exec(a):D=[null,a,null];if(D&&(D[1]||!c)){if(D[1])return f=(c=c instanceof d?c[0]:c)?c.ownerDocument||c:y,(e=o.exec(a))?d.isPlainObject(c)?(a=[y.createElement(e[1])],d.fn.attr.call(a,c,!0)):a=[f.createElement(e[1])]:(e=d.buildFragment([D[1]],[f]),a=(e.cacheable?d.clone(e.fragment):e.fragment).childNodes),
d.merge(this,a);if((c=y.getElementById(D[2]))&&c.parentNode){if(c.id!==D[2])return e.find(a);this.length=1;this[0]=c}this.context=y;this.selector=a;return this}return!c||c.jquery?(c||e).find(a):this.constructor(c).find(a)}if(d.isFunction(a))return e.ready(a);a.selector!==b&&(this.selector=a.selector,this.context=a.context);return d.makeArray(a,this)},selector:"",jquery:"1.7.2",length:0,size:function(){return this.length},toArray:function(){return fa.call(this,0)},get:function(a){return null==a?this.toArray():
0>a?this[this.length+a]:this[a]},pushStack:function(a,b,c){var e=this.constructor();d.isArray(a)?sa.apply(e,a):d.merge(e,a);e.prevObject=this;e.context=this.context;"find"===b?e.selector=this.selector+(this.selector?" ":"")+c:b&&(e.selector=this.selector+"."+b+"("+c+")");return e},each:function(a,b){return d.each(this,a,b)},ready:function(a){d.bindReady();la.add(a);return this},eq:function(a){a=+a;return-1===a?this.slice(a):this.slice(a,a+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},
slice:function(){return this.pushStack(fa.apply(this,arguments),"slice",fa.call(arguments).join(","))},map:function(a){return this.pushStack(d.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||this.constructor(null)},push:sa,sort:[].sort,splice:[].splice};d.fn.init.prototype=d.fn;d.extend=d.fn.extend=function(){var a,c,e,D,f,g,i=arguments[0]||{},h=1,j=arguments.length,I=!1;"boolean"==typeof i&&(I=i,i=arguments[1]||{},h=2);"object"!=typeof i&&!d.isFunction(i)&&
(i={});for(j===h&&(i=this,--h);h<j;h++)if(null!=(a=arguments[h]))for(c in a)e=i[c],D=a[c],i!==D&&(I&&D&&(d.isPlainObject(D)||(f=d.isArray(D)))?(f?(f=!1,g=e&&d.isArray(e)?e:[]):g=e&&d.isPlainObject(e)?e:{},i[c]=d.extend(I,g,D)):D!==b&&(i[c]=D));return i};d.extend({noConflict:function(b){a.$===d&&(a.$=f);b&&a.jQuery===d&&(a.jQuery=e);return d},isReady:!1,readyWait:1,holdReady:function(a){a?d.readyWait++:d.ready(!0)},ready:function(a){if(!0===a&&!--d.readyWait||!0!==a&&!d.isReady){if(!y.body)return setTimeout(d.ready,
1);d.isReady=!0;!0!==a&&0<--d.readyWait||(la.fireWith(y,[d]),d.fn.trigger&&d(y).trigger("ready").off("ready"))}},bindReady:function(){if(!la){la=d.Callbacks("once memory");if("complete"===y.readyState)return setTimeout(d.ready,1);if(y.addEventListener)y.addEventListener("DOMContentLoaded",aa,!1),a.addEventListener("load",d.ready,!1);else if(y.attachEvent){y.attachEvent("onreadystatechange",aa);a.attachEvent("onload",d.ready);var b=!1;try{b=null==a.frameElement}catch(e){}y.documentElement.doScroll&&
b&&c()}}},isFunction:function(a){return"function"===d.type(a)},isArray:Array.isArray||function(a){return"array"===d.type(a)},isWindow:function(a){return null!=a&&a==a.window},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},type:function(a){return null==a?""+a:A[$a.call(a)]||"object"},isPlainObject:function(a){if(!a||"object"!==d.type(a)||a.nodeType||d.isWindow(a))return!1;try{if(a.constructor&&!ra.call(a,"constructor")&&!ra.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}for(var e in a);
return e===b||ra.call(a,e)},isEmptyObject:function(a){for(var b in a)return!1;return!0},error:function(a){throw Error(a);},parseJSON:function(b){if("string"!=typeof b||!b)return null;b=d.trim(b);if(a.JSON&&a.JSON.parse)return a.JSON.parse(b);if(p.test(b.replace(q,"@").replace(r,"]").replace(s,"")))return(new Function("return "+b))();d.error("Invalid JSON: "+b)},parseXML:function(c){if("string"!=typeof c||!c)return null;var e,D;try{a.DOMParser?(D=new DOMParser,e=D.parseFromString(c,"text/xml")):(e=
new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(c))}catch(f){e=b}(!e||!e.documentElement||e.getElementsByTagName("parsererror").length)&&d.error("Invalid XML: "+c);return e},noop:function(){},globalEval:function(b){b&&h.test(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(x,"ms-").replace(J,z)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toUpperCase()===b.toUpperCase()},each:function(a,c,e){var D,f=0,g=a.length,i=g===b||d.isFunction(a);
if(e)if(i)for(D in a){if(!1===c.apply(a[D],e))break}else for(;f<g&&!1!==c.apply(a[f++],e););else if(i)for(D in a){if(!1===c.call(a[D],D,a[D]))break}else for(;f<g&&!1!==c.call(a[f],f,a[f++]););return a},trim:Ba?function(a){return null==a?"":Ba.call(a)}:function(a){return null==a?"":(a+"").replace(j,"").replace(m,"")},makeArray:function(a,b){var c=b||[];if(null!=a){var e=d.type(a);null==a.length||"string"===e||"function"===e||"regexp"===e||d.isWindow(a)?sa.call(c,a):d.merge(c,a)}return c},inArray:function(a,
b,c){var d;if(b){if(Ca)return Ca.call(b,a,c);d=b.length;for(c=c?0>c?Math.max(0,d+c):c:0;c<d;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,c){var d=a.length,e=0;if("number"==typeof c.length)for(var D=c.length;e<D;e++)a[d++]=c[e];else for(;c[e]!==b;)a[d++]=c[e++];a.length=d;return a},grep:function(a,b,c){for(var d=[],e,c=!!c,D=0,f=a.length;D<f;D++)e=!!b(a[D],D),c!==e&&d.push(a[D]);return d},map:function(a,c,e){var D,f,g=[],i=0,h=a.length;if(a instanceof d||h!==b&&"number"==typeof h&&(0<
h&&a[0]&&a[h-1]||0===h||d.isArray(a)))for(;i<h;i++)D=c(a[i],i,e),null!=D&&(g[g.length]=D);else for(f in a)D=c(a[f],f,e),null!=D&&(g[g.length]=D);return g.concat.apply([],g)},guid:1,proxy:function(a,c){if("string"==typeof c)var e=a[c],c=a,a=e;if(!d.isFunction(a))return b;var D=fa.call(arguments,2),e=function(){return a.apply(c,D.concat(fa.call(arguments)))};e.guid=a.guid=a.guid||e.guid||d.guid++;return e},access:function(a,c,e,D,f,g,i){var h,j=null==e,I=0,S=a.length;if(e&&"object"==typeof e){for(I in e)d.access(a,
c,I,e[I],1,g,D);f=1}else if(D!==b){h=i===b&&d.isFunction(D);j&&(h?(h=c,c=function(a,b,c){return h.call(d(a),c)}):(c.call(a,D),c=null));if(c)for(;I<S;I++)c(a[I],e,h?D.call(a[I],I,c(a[I],e)):D,i);f=1}return f?a:j?c.call(a):S?c(a[0],e):g},now:function(){return(new Date).getTime()},uaMatch:function(a){a=a.toLowerCase();a=t.exec(a)||u.exec(a)||w.exec(a)||0>a.indexOf("compatible")&&v.exec(a)||[];return{browser:a[1]||"",version:a[2]||"0"}},sub:function(){function a(b,c){return new a.fn.init(b,c)}d.extend(!0,
a,this);a.superclass=this;a.fn=a.prototype=this();a.fn.constructor=a;a.sub=this.sub;a.fn.init=function(c,e){e&&e instanceof d&&!(e instanceof a)&&(e=a(e));return d.fn.init.call(this,c,e,b)};a.fn.init.prototype=a.fn;var b=a(y);return a},browser:{}});d.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(a,b){A["[object "+b+"]"]=b.toLowerCase()});B=d.uaMatch(B);B.browser&&(d.browser[B.browser]=!0,d.browser.version=B.version);d.browser.webkit&&(d.browser.safari=!0);h.test("\u00a0")&&
(j=/^[\s\xA0]+/,m=/[\s\xA0]+$/);g=d(y);y.addEventListener?aa=function(){y.removeEventListener("DOMContentLoaded",aa,!1);d.ready()}:y.attachEvent&&(aa=function(){"complete"===y.readyState&&(y.detachEvent("onreadystatechange",aa),d.ready())});return d}(),da={};i.Callbacks=function(a){var a=a?da[a]||B(a):{},c=[],d=[],e,f,g,h,j,m,o=function(b){var d,e,f,g;d=0;for(e=b.length;d<e;d++)f=b[d],g=i.type(f),"array"===g?o(f):"function"===g&&(!a.unique||!q.has(f))&&c.push(f)},p=function(b,i){i=i||[];e=!a.memory||
[b,i];g=f=!0;m=h||0;h=0;for(j=c.length;c&&m<j;m++)if(!1===c[m].apply(b,i)&&a.stopOnFalse){e=!0;break}g=!1;c&&(a.once?!0===e?q.disable():c=[]:d&&d.length&&(e=d.shift(),q.fireWith(e[0],e[1])))},q={add:function(){if(c){var a=c.length;o(arguments);g?j=c.length:e&&!0!==e&&(h=a,p(e[0],e[1]))}return this},remove:function(){if(c)for(var b=arguments,d=0,e=b.length;d<e;d++)for(var f=0;f<c.length&&!(b[d]===c[f]&&(g&&f<=j&&(j--,f<=m&&m--),c.splice(f--,1),a.unique));f++);return this},has:function(a){if(c)for(var b=
0,d=c.length;b<d;b++)if(a===c[b])return!0;return!1},empty:function(){c=[];return this},disable:function(){c=d=e=b;return this},disabled:function(){return!c},lock:function(){d=b;(!e||!0===e)&&q.disable();return this},locked:function(){return!d},fireWith:function(b,c){d&&(g?a.once||d.push([b,c]):(!a.once||!e)&&p(b,c));return this},fire:function(){q.fireWith(this,arguments);return this},fired:function(){return!!f}};return q};var ea=[].slice;i.extend({Deferred:function(a){var b=i.Callbacks("once memory"),
c=i.Callbacks("once memory"),d=i.Callbacks("memory"),e="pending",f={resolve:b,reject:c,notify:d},g={done:b.add,fail:c.add,progress:d.add,state:function(){return e},isResolved:b.fired,isRejected:c.fired,then:function(a,b,c){h.done(a).fail(b).progress(c);return this},always:function(){h.done.apply(h,arguments).fail.apply(h,arguments);return this},pipe:function(a,b,c){return i.Deferred(function(d){i.each({done:[a,"resolve"],fail:[b,"reject"],progress:[c,"notify"]},function(a,b){var c=b[0],e=b[1],D;i.isFunction(c)?
h[a](function(){(D=c.apply(this,arguments))&&i.isFunction(D.promise)?D.promise().then(d.resolve,d.reject,d.notify):d[e+"With"](this===h?d:this,[D])}):h[a](d[e])})}).promise()},promise:function(a){if(null==a)a=g;else for(var b in g)a[b]=g[b];return a}},h=g.promise({}),j;for(j in f)h[j]=f[j].fire,h[j+"With"]=f[j].fireWith;h.done(function(){e="resolved"},c.disable,d.lock).fail(function(){e="rejected"},b.disable,d.lock);a&&a.call(h,h);return h},when:function(a){function b(a){return function(b){g[a]=1<
arguments.length?ea.call(arguments,0):b;j.notifyWith(m,g)}}function c(a){return function(b){d[a]=1<arguments.length?ea.call(arguments,0):b;--h||j.resolveWith(j,d)}}var d=ea.call(arguments,0),e=0,f=d.length,g=Array(f),h=f,j=1>=f&&a&&i.isFunction(a.promise)?a:i.Deferred(),m=j.promise();if(1<f){for(;e<f;e++)d[e]&&d[e].promise&&i.isFunction(d[e].promise)?d[e].promise().then(c(e),j.reject,b(e)):--h;h||j.resolveWith(j,d)}else j!==a&&j.resolveWith(j,f?[a]:[]);return m}});i.support=function(){var b,c,d,e,
f,g,h,j,m=y.createElement("div");m.setAttribute("className","t");m.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>";c=m.getElementsByTagName("*");d=m.getElementsByTagName("a")[0];if(!c||!c.length||!d)return{};e=y.createElement("select");f=e.appendChild(y.createElement("option"));c=m.getElementsByTagName("input")[0];b={leadingWhitespace:3===m.firstChild.nodeType,tbody:!m.getElementsByTagName("tbody").length,htmlSerialize:!!m.getElementsByTagName("link").length,
style:/top/.test(d.getAttribute("style")),hrefNormalized:"/a"===d.getAttribute("href"),opacity:/^0.55/.test(d.style.opacity),cssFloat:!!d.style.cssFloat,checkOn:"on"===c.value,optSelected:f.selected,getSetAttribute:"t"!==m.className,enctype:!!y.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==y.createElement("nav").cloneNode(!0).outerHTML,submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,
pixelMargin:!0};i.boxModel=b.boxModel="CSS1Compat"===y.compatMode;c.checked=!0;b.noCloneChecked=c.cloneNode(!0).checked;e.disabled=!0;b.optDisabled=!f.disabled;try{delete m.test}catch(o){b.deleteExpando=!1}!m.addEventListener&&m.attachEvent&&m.fireEvent&&(m.attachEvent("onclick",function(){b.noCloneEvent=!1}),m.cloneNode(!0).fireEvent("onclick"));c=y.createElement("input");c.value="t";c.setAttribute("type","radio");b.radioValue="t"===c.value;c.setAttribute("checked","checked");c.setAttribute("name",
"t");m.appendChild(c);d=y.createDocumentFragment();d.appendChild(m.lastChild);b.checkClone=d.cloneNode(!0).cloneNode(!0).lastChild.checked;b.appendChecked=c.checked;d.removeChild(c);d.appendChild(m);if(m.attachEvent)for(h in{submit:1,change:1,focusin:1})c="on"+h,(j=c in m)||(m.setAttribute(c,"return;"),j="function"==typeof m[c]),b[h+"Bubbles"]=j;d.removeChild(m);d=e=f=m=c=null;i(function(){var c,d,e,f,h,F,I=y.getElementsByTagName("body")[0];!I||(c=y.createElement("div"),c.style.cssText="padding:0;margin:0;border:0;visibility:hidden;width:0;height:0;position:static;top:0;margin-top:1px",
I.insertBefore(c,I.firstChild),m=y.createElement("div"),c.appendChild(m),m.innerHTML="<table><tr><td style='padding:0;margin:0;border:0;display:none'></td><td>t</td></tr></table>",g=m.getElementsByTagName("td"),j=0===g[0].offsetHeight,g[0].style.display="",g[1].style.display="none",b.reliableHiddenOffsets=j&&0===g[0].offsetHeight,a.getComputedStyle&&(m.innerHTML="",F=y.createElement("div"),F.style.width="0",F.style.marginRight="0",m.style.width="2px",m.appendChild(F),b.reliableMarginRight=0===(parseInt((a.getComputedStyle(F,
null)||{marginRight:0}).marginRight,10)||0)),"undefined"!=typeof m.style.zoom&&(m.innerHTML="",m.style.width=m.style.padding="1px",m.style.border=0,m.style.overflow="hidden",m.style.display="inline",m.style.zoom=1,b.inlineBlockNeedsLayout=3===m.offsetWidth,m.style.display="block",m.style.overflow="visible",m.innerHTML="<div style='width:5px;'></div>",b.shrinkWrapBlocks=3!==m.offsetWidth),m.style.cssText="position:absolute;top:0;left:0;width:1px;height:1px;padding:0;margin:0;border:0;visibility:hidden;",
m.innerHTML="<div style='position:absolute;top:0;left:0;width:1px;height:1px;padding:0;margin:0;border:5px solid #000;display:block;'><div style='padding:0;margin:0;border:0;display:block;overflow:hidden;'></div></div><table style='position:absolute;top:0;left:0;width:1px;height:1px;padding:0;margin:0;border:5px solid #000;' cellpadding='0' cellspacing='0'><tr><td></td></tr></table>",d=m.firstChild,e=d.firstChild,f=d.nextSibling.firstChild.firstChild,h={doesNotAddBorder:5!==e.offsetTop,doesAddBorderForTableAndCells:5===
f.offsetTop},e.style.position="fixed",e.style.top="20px",h.fixedPosition=20===e.offsetTop||15===e.offsetTop,e.style.position=e.style.top="",d.style.overflow="hidden",d.style.position="relative",h.subtractsBorderForOverflowNotVisible=-5===e.offsetTop,h.doesNotIncludeMarginInBodyOffset=1!==I.offsetTop,a.getComputedStyle&&(m.style.marginTop="1%",b.pixelMargin="1%"!==(a.getComputedStyle(m,null)||{marginTop:0}).marginTop),"undefined"!=typeof c.style.zoom&&(c.style.zoom=1),I.removeChild(c),m=null,i.extend(b,
h))});return b}();var R=/^(?:\{.*\}|\[.*\])$/,M=/([A-Z])/g;i.extend({cache:{},uuid:0,expando:"jQuery"+(i.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(a){a=a.nodeType?i.cache[a[i.expando]]:a[i.expando];return!!a&&!A(a)},data:function(a,c,d,e){if(i.acceptData(a)){var f,g;f=i.expando;var h="string"==typeof c,j=a.nodeType,m=j?i.cache:a,o=j?a[f]:a[f]&&f,p="events"===c;if(o&&m[o]&&(p||e||m[o].data)||!(h&&d===
b)){o||(j?a[f]=o=++i.uuid:o=f);m[o]||(m[o]={},j||(m[o].toJSON=i.noop));if("object"==typeof c||"function"==typeof c)e?m[o]=i.extend(m[o],c):m[o].data=i.extend(m[o].data,c);a=f=m[o];e||(f.data||(f.data={}),f=f.data);d!==b&&(f[i.camelCase(c)]=d);if(p&&!f[c])return a.events;h?(g=f[c],null==g&&(g=f[i.camelCase(c)])):g=f;return g}}},removeData:function(a,b,c){if(i.acceptData(a)){var d,e,f,g=i.expando,h=a.nodeType,j=h?i.cache:a,m=h?a[g]:g;if(j[m]){if(b&&(d=c?j[m]:j[m].data)){i.isArray(b)||(b in d?b=[b]:
(b=i.camelCase(b),b in d?b=[b]:b=b.split(" ")));e=0;for(f=b.length;e<f;e++)delete d[b[e]];if(!(c?A:i.isEmptyObject)(d))return}if(!c&&(delete j[m].data,!A(j[m])))return;i.support.deleteExpando||!j.setInterval?delete j[m]:j[m]=null;h&&(i.support.deleteExpando?delete a[g]:a.removeAttribute?a.removeAttribute(g):a[g]=null)}}},_data:function(a,b,c){return i.data(a,b,c,!0)},acceptData:function(a){if(a.nodeName){var b=i.noData[a.nodeName.toLowerCase()];if(b)return!0!==b&&a.getAttribute("classid")===b}return!0}});
i.fn.extend({data:function(a,c){var d,e,f,g,h,j=this[0],m=0,o=null;if(a===b){if(this.length&&(o=i.data(j),1===j.nodeType&&!i._data(j,"parsedAttrs"))){f=j.attributes;for(h=f.length;m<h;m++)g=f[m].name,0===g.indexOf("data-")&&(g=i.camelCase(g.substring(5)),G(j,g,o[g]));i._data(j,"parsedAttrs",!0)}return o}if("object"==typeof a)return this.each(function(){i.data(this,a)});d=a.split(".",2);d[1]=d[1]?"."+d[1]:"";e=d[1]+"!";return i.access(this,function(c){if(c===b)return o=this.triggerHandler("getData"+
e,[d[0]]),o===b&&j&&(o=i.data(j,a),o=G(j,a,o)),o===b&&d[1]?this.data(d[0]):o;d[1]=c;this.each(function(){var b=i(this);b.triggerHandler("setData"+e,d);i.data(this,a,c);b.triggerHandler("changeData"+e,d)})},null,c,1<arguments.length,null,!1)},removeData:function(a){return this.each(function(){i.removeData(this,a)})}});i.extend({_mark:function(a,b){a&&(b=(b||"fx")+"mark",i._data(a,b,(i._data(a,b)||0)+1))},_unmark:function(a,b,c){!0!==a&&(c=b,b=a,a=!1);if(b){var c=c||"fx",d=c+"mark";(a=a?0:(i._data(b,
d)||1)-1)?i._data(b,d,a):(i.removeData(b,d,!0),E(b,c,"mark"))}},queue:function(a,b,c){var d;if(a)return b=(b||"fx")+"queue",d=i._data(a,b),c&&(!d||i.isArray(c)?d=i._data(a,b,i.makeArray(c)):d.push(c)),d||[]},dequeue:function(a,b){var b=b||"fx",c=i.queue(a,b),d=c.shift(),e={};"inprogress"===d&&(d=c.shift());d&&("fx"===b&&c.unshift("inprogress"),i._data(a,b+".run",e),d.call(a,function(){i.dequeue(a,b)},e));c.length||(i.removeData(a,b+"queue "+b+".run",!0),E(a,b,"queue"))}});i.fn.extend({queue:function(a,
c){var d=2;"string"!=typeof a&&(c=a,a="fx",d--);return arguments.length<d?i.queue(this[0],a):c===b?this:this.each(function(){var b=i.queue(this,a,c);"fx"===a&&"inprogress"!==b[0]&&i.dequeue(this,a)})},dequeue:function(a){return this.each(function(){i.dequeue(this,a)})},delay:function(a,b){a=i.fx?i.fx.speeds[a]||a:a;return this.queue(b||"fx",function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,c){function d(){--h||
e.resolveWith(f,[f])}"string"!=typeof a&&(c=a,a=b);for(var a=a||"fx",e=i.Deferred(),f=this,g=f.length,h=1,j=a+"defer",m=a+"queue",o=a+"mark",p;g--;)if(p=i.data(f[g],j,b,!0)||(i.data(f[g],m,b,!0)||i.data(f[g],o,b,!0))&&i.data(f[g],j,i.Callbacks("once memory"),!0))h++,p.add(d);d();return e.promise(c)}});var H=/[\n\t\r]/g,J=/\s+/,N=/\r/g,ba=/^(?:button|input)$/i,ga=/^(?:button|input|object|select|textarea)$/i,ha=/^a(?:rea)?$/i,P=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,
U=i.support.getSetAttribute,K,Da,Ea;i.fn.extend({attr:function(a,b){return i.access(this,i.attr,a,b,1<arguments.length)},removeAttr:function(a){return this.each(function(){i.removeAttr(this,a)})},prop:function(a,b){return i.access(this,i.prop,a,b,1<arguments.length)},removeProp:function(a){a=i.propFix[a]||a;return this.each(function(){try{this[a]=b,delete this[a]}catch(c){}})},addClass:function(a){var b,c,d,e,f,g,h;if(i.isFunction(a))return this.each(function(b){i(this).addClass(a.call(this,b,this.className))});
if(a&&"string"==typeof a){b=a.split(J);c=0;for(d=this.length;c<d;c++)if(e=this[c],1===e.nodeType)if(!e.className&&1===b.length)e.className=a;else{f=" "+e.className+" ";g=0;for(h=b.length;g<h;g++)~f.indexOf(" "+b[g]+" ")||(f+=b[g]+" ");e.className=i.trim(f)}}return this},removeClass:function(a){var c,d,e,f,g,h,j;if(i.isFunction(a))return this.each(function(b){i(this).removeClass(a.call(this,b,this.className))});if(a&&"string"==typeof a||a===b){c=(a||"").split(J);d=0;for(e=this.length;d<e;d++)if(f=
this[d],1===f.nodeType&&f.className)if(a){g=(" "+f.className+" ").replace(H," ");h=0;for(j=c.length;h<j;h++)g=g.replace(" "+c[h]+" "," ");f.className=i.trim(g)}else f.className=""}return this},toggleClass:function(a,b){var c=typeof a,d="boolean"==typeof b;return i.isFunction(a)?this.each(function(c){i(this).toggleClass(a.call(this,c,this.className,b),b)}):this.each(function(){if("string"===c)for(var e,f=0,g=i(this),h=b,j=a.split(J);e=j[f++];)h=d?h:!g.hasClass(e),g[h?"addClass":"removeClass"](e);else if("undefined"===
c||"boolean"===c)this.className&&i._data(this,"__className__",this.className),this.className=this.className||!1===a?"":i._data(this,"__className__")||""})},hasClass:function(a){for(var a=" "+a+" ",b=0,c=this.length;b<c;b++)if(1===this[b].nodeType&&-1<(" "+this[b].className+" ").replace(H," ").indexOf(a))return!0;return!1},val:function(a){var c,d,e,f=this[0];if(arguments.length)return e=i.isFunction(a),this.each(function(d){var f=i(this),g;if(1===this.nodeType&&(e?g=a.call(this,d,f.val()):g=a,null==
g?g="":"number"==typeof g?g+="":i.isArray(g)&&(g=i.map(g,function(a){return a==null?"":a+""})),c=i.valHooks[this.type]||i.valHooks[this.nodeName.toLowerCase()],!c||!("set"in c)||c.set(this,g,"value")===b))this.value=g});if(f){if((c=i.valHooks[f.type]||i.valHooks[f.nodeName.toLowerCase()])&&"get"in c&&(d=c.get(f,"value"))!==b)return d;d=f.value;return"string"==typeof d?d.replace(N,""):null==d?"":d}}});i.extend({valHooks:{option:{get:function(a){var b=a.attributes.value;return!b||b.specified?a.value:
a.text}},select:{get:function(a){var b,c,d=a.selectedIndex,e=[],f=a.options,g="select-one"===a.type;if(0>d)return null;a=g?d:0;for(c=g?d+1:f.length;a<c;a++)if(b=f[a],b.selected&&(i.support.optDisabled?!b.disabled:null===b.getAttribute("disabled"))&&(!b.parentNode.disabled||!i.nodeName(b.parentNode,"optgroup"))){b=i(b).val();if(g)return b;e.push(b)}return g&&!e.length&&f.length?i(f[d]).val():e},set:function(a,b){var c=i.makeArray(b);i(a).find("option").each(function(){this.selected=0<=i.inArray(i(this).val(),
c)});c.length||(a.selectedIndex=-1);return c}}},attrFn:{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0},attr:function(a,c,d,e){var f,g,h=a.nodeType;if(a&&3!==h&&8!==h&&2!==h){if(e&&c in i.attrFn)return i(a)[c](d);if("undefined"==typeof a.getAttribute)return i.prop(a,c,d);(e=1!==h||!i.isXMLDoc(a))&&(c=c.toLowerCase(),g=i.attrHooks[c]||(P.test(c)?Da:K));if(d!==b){if(null===d){i.removeAttr(a,c);return}if(g&&"set"in g&&e&&(f=g.set(a,d,c))!==b)return f;a.setAttribute(c,""+d);return d}if(g&&
"get"in g&&e&&null!==(f=g.get(a,c)))return f;f=a.getAttribute(c);return null===f?b:f}},removeAttr:function(a,b){var c,d,e,f,g,h=0;if(b&&1===a.nodeType){d=b.toLowerCase().split(J);for(f=d.length;h<f;h++)(e=d[h])&&(c=i.propFix[e]||e,g=P.test(e),g||i.attr(a,e,""),a.removeAttribute(U?e:c),g&&c in a&&(a[c]=!1))}},attrHooks:{type:{set:function(a,b){if(ba.test(a.nodeName)&&a.parentNode)i.error("type property can't be changed");else if(!i.support.radioValue&&"radio"===b&&i.nodeName(a,"input")){var c=a.value;
a.setAttribute("type",b);c&&(a.value=c);return b}}},value:{get:function(a,b){return K&&i.nodeName(a,"button")?K.get(a,b):b in a?a.value:null},set:function(a,b,c){if(K&&i.nodeName(a,"button"))return K.set(a,b,c);a.value=b}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(a,
c,d){var e,f,g;g=a.nodeType;if(a&&3!==g&&8!==g&&2!==g)return(g=1!==g||!i.isXMLDoc(a))&&(c=i.propFix[c]||c,f=i.propHooks[c]),d!==b?f&&"set"in f&&(e=f.set(a,d,c))!==b?e:a[c]=d:f&&"get"in f&&null!==(e=f.get(a,c))?e:a[c]},propHooks:{tabIndex:{get:function(a){var c=a.getAttributeNode("tabindex");return c&&c.specified?parseInt(c.value,10):ga.test(a.nodeName)||ha.test(a.nodeName)&&a.href?0:b}}}});i.attrHooks.tabindex=i.propHooks.tabIndex;Da={get:function(a,c){var d,e=i.prop(a,c);return!0===e||"boolean"!=
typeof e&&(d=a.getAttributeNode(c))&&!1!==d.nodeValue?c.toLowerCase():b},set:function(a,b,c){var d;!1===b?i.removeAttr(a,c):(d=i.propFix[c]||c,d in a&&(a[d]=!0),a.setAttribute(c,c.toLowerCase()));return c}};U||(Ea={name:!0,id:!0,coords:!0},K=i.valHooks.button={get:function(a,c){var d;return(d=a.getAttributeNode(c))&&(Ea[c]?""!==d.nodeValue:d.specified)?d.nodeValue:b},set:function(a,b,c){var d=a.getAttributeNode(c);d||(d=y.createAttribute(c),a.setAttributeNode(d));return d.nodeValue=b+""}},i.attrHooks.tabindex.set=
K.set,i.each(["width","height"],function(a,b){i.attrHooks[b]=i.extend(i.attrHooks[b],{set:function(a,c){if(""===c)return a.setAttribute(b,"auto"),c}})}),i.attrHooks.contenteditable={get:K.get,set:function(a,b,c){""===b&&(b="false");K.set(a,b,c)}});i.support.hrefNormalized||i.each(["href","src","width","height"],function(a,c){i.attrHooks[c]=i.extend(i.attrHooks[c],{get:function(a){a=a.getAttribute(c,2);return null===a?b:a}})});i.support.style||(i.attrHooks.style={get:function(a){return a.style.cssText.toLowerCase()||
b},set:function(a,b){return a.style.cssText=""+b}});i.support.optSelected||(i.propHooks.selected=i.extend(i.propHooks.selected,{get:function(a){a=a.parentNode;a&&(a.selectedIndex,a.parentNode&&a.parentNode.selectedIndex);return null}}));i.support.enctype||(i.propFix.enctype="encoding");i.support.checkOn||i.each(["radio","checkbox"],function(){i.valHooks[this]={get:function(a){return null===a.getAttribute("value")?"on":a.value}}});i.each(["radio","checkbox"],function(){i.valHooks[this]=i.extend(i.valHooks[this],
{set:function(a,b){if(i.isArray(b))return a.checked=0<=i.inArray(i(a).val(),b)}})});var ta=/^(?:textarea|input|select)$/i,Fa=/^([^\.]*)?(?:\.(.+))?$/,ab=/(?:^|\s)hover(\.\S+)?\b/,bb=/^key/,cb=/^(?:mouse|contextmenu)|click/,Ga=/^(?:focusinfocus|focusoutblur)$/,db=/^(\w*)(?:#([\w\-]+))?(?:\.([\w\-]+))?$/,eb=function(a){(a=db.exec(a))&&(a[1]=(a[1]||"").toLowerCase(),a[3]=a[3]&&RegExp("(?:^|\\s)"+a[3]+"(?:\\s|$)"));return a},Ha=function(a){return i.event.special.hover?a:a.replace(ab,"mouseenter$1 mouseleave$1")};
i.event={add:function(a,c,d,e,f){var g,h,j,m,o,p,q,r,s;if(!(3===a.nodeType||8===a.nodeType||!c||!d||!(g=i._data(a)))){d.handler&&(q=d,d=q.handler,f=q.selector);d.guid||(d.guid=i.guid++);(j=g.events)||(g.events=j={});(h=g.handle)||(g.handle=h=function(a){return"undefined"!=typeof i&&(!a||i.event.triggered!==a.type)?i.event.dispatch.apply(h.elem,arguments):b},h.elem=a);c=i.trim(Ha(c)).split(" ");for(g=0;g<c.length;g++){m=Fa.exec(c[g])||[];o=m[1];p=(m[2]||"").split(".").sort();s=i.event.special[o]||
{};o=(f?s.delegateType:s.bindType)||o;s=i.event.special[o]||{};m=i.extend({type:o,origType:m[1],data:e,handler:d,guid:d.guid,selector:f,quick:f&&eb(f),namespace:p.join(".")},q);r=j[o];if(!r&&(r=j[o]=[],r.delegateCount=0,!s.setup||!1===s.setup.call(a,e,p,h)))a.addEventListener?a.addEventListener(o,h,!1):a.attachEvent&&a.attachEvent("on"+o,h);s.add&&(s.add.call(a,m),m.handler.guid||(m.handler.guid=d.guid));f?r.splice(r.delegateCount++,0,m):r.push(m);i.event.global[o]=!0}a=null}},global:{},remove:function(a,
b,c,d,e){var f=i.hasData(a)&&i._data(a),g,h,j,m,o,p,q,r,s,t,u;if(f&&(q=f.events)){b=i.trim(Ha(b||"")).split(" ");for(g=0;g<b.length;g++)if(h=Fa.exec(b[g])||[],j=m=h[1],h=h[2],j){r=i.event.special[j]||{};j=(d?r.delegateType:r.bindType)||j;t=q[j]||[];o=t.length;h=h?RegExp("(^|\\.)"+h.split(".").sort().join("\\.(?:.*\\.)?")+"(\\.|$)"):null;for(p=0;p<t.length;p++)u=t[p],(e||m===u.origType)&&(!c||c.guid===u.guid)&&(!h||h.test(u.namespace))&&(!d||d===u.selector||"**"===d&&u.selector)&&(t.splice(p--,1),
u.selector&&t.delegateCount--,r.remove&&r.remove.call(a,u));0===t.length&&o!==t.length&&((!r.teardown||!1===r.teardown.call(a,h))&&i.removeEvent(a,j,f.handle),delete q[j])}else for(j in q)i.event.remove(a,j+b[g],c,d,!0);i.isEmptyObject(q)&&(s=f.handle,s&&(s.elem=null),i.removeData(a,["events","handle"],!0))}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(c,d,e,f){if(!e||3!==e.nodeType&&8!==e.nodeType){var g=c.type||c,h=[],j,m,o,p,q,r;if(!Ga.test(g+i.event.triggered)&&(0<=g.indexOf("!")&&
(g=g.slice(0,-1),j=!0),0<=g.indexOf(".")&&(h=g.split("."),g=h.shift(),h.sort()),e&&!i.event.customEvent[g]||i.event.global[g]))if(c="object"==typeof c?c[i.expando]?c:new i.Event(g,c):new i.Event(g),c.type=g,c.isTrigger=!0,c.exclusive=j,c.namespace=h.join("."),c.namespace_re=c.namespace?RegExp("(^|\\.)"+h.join("\\.(?:.*\\.)?")+"(\\.|$)"):null,j=0>g.indexOf(":")?"on"+g:"",e){if(c.result=b,c.target||(c.target=e),d=null!=d?i.makeArray(d):[],d.unshift(c),p=i.event.special[g]||{},!(p.trigger&&!1===p.trigger.apply(e,
d))){r=[[e,p.bindType||g]];if(!f&&!p.noBubble&&!i.isWindow(e)){m=p.delegateType||g;h=Ga.test(m+g)?e:e.parentNode;for(o=null;h;h=h.parentNode)r.push([h,m]),o=h;o&&o===e.ownerDocument&&r.push([o.defaultView||o.parentWindow||a,m])}for(m=0;m<r.length&&!c.isPropagationStopped();m++)h=r[m][0],c.type=r[m][1],(q=(i._data(h,"events")||{})[c.type]&&i._data(h,"handle"))&&q.apply(h,d),(q=j&&h[j])&&i.acceptData(h)&&!1===q.apply(h,d)&&c.preventDefault();c.type=g;!f&&!c.isDefaultPrevented()&&(!p._default||!1===
p._default.apply(e.ownerDocument,d))&&("click"!==g||!i.nodeName(e,"a"))&&i.acceptData(e)&&j&&e[g]&&("focus"!==g&&"blur"!==g||0!==c.target.offsetWidth)&&!i.isWindow(e)&&(o=e[j],o&&(e[j]=null),i.event.triggered=g,e[g](),i.event.triggered=b,o&&(e[j]=o));return c.result}}else for(m in e=i.cache,e)e[m].events&&e[m].events[g]&&i.event.trigger(c,d,e[m].handle.elem,!0)}},dispatch:function(c){var c=i.event.fix(c||a.event),d=(i._data(this,"events")||{})[c.type]||[],e=d.delegateCount,f=[].slice.call(arguments,
0),g=!c.exclusive&&!c.namespace,h=i.event.special[c.type]||{},j=[],m,o,p,q,r,s,t;f[0]=c;c.delegateTarget=this;if(!h.preDispatch||!1!==h.preDispatch.call(this,c)){if(e&&(!c.button||"click"!==c.type)){p=i(this);p.context=this.ownerDocument||this;for(o=c.target;o!=this;o=o.parentNode||this)if(!0!==o.disabled){r={};s=[];p[0]=o;for(m=0;m<e;m++){q=d[m];t=q.selector;if(r[t]===b){var u=r,w=t,v;if(q.quick){v=q.quick;var J=o.attributes||{};v=(!v[1]||o.nodeName.toLowerCase()===v[1])&&(!v[2]||(J.id||{}).value===
v[2])&&(!v[3]||v[3].test((J["class"]||{}).value))}else v=p.is(t);u[w]=v}r[t]&&s.push(q)}s.length&&j.push({elem:o,matches:s})}}d.length>e&&j.push({elem:this,matches:d.slice(e)});for(m=0;m<j.length&&!c.isPropagationStopped();m++){e=j[m];c.currentTarget=e.elem;for(d=0;d<e.matches.length&&!c.isImmediatePropagationStopped();d++)if(q=e.matches[d],g||!c.namespace&&!q.namespace||c.namespace_re&&c.namespace_re.test(q.namespace))c.data=q.data,c.handleObj=q,q=((i.event.special[q.origType]||{}).handle||q.handler).apply(e.elem,
f),q!==b&&(c.result=q,!1===q&&(c.preventDefault(),c.stopPropagation()))}h.postDispatch&&h.postDispatch.call(this,c);return c.result}},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:["char","charCode","key","keyCode"],filter:function(a,b){null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode);return a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),
filter:function(a,c){var d,e,f,g=c.button,h=c.fromElement;null==a.pageX&&null!=c.clientX&&(d=a.target.ownerDocument||y,e=d.documentElement,f=d.body,a.pageX=c.clientX+(e&&e.scrollLeft||f&&f.scrollLeft||0)-(e&&e.clientLeft||f&&f.clientLeft||0),a.pageY=c.clientY+(e&&e.scrollTop||f&&f.scrollTop||0)-(e&&e.clientTop||f&&f.clientTop||0));!a.relatedTarget&&h&&(a.relatedTarget=h===a.target?c.toElement:h);!a.which&&g!==b&&(a.which=g&1?1:g&2?3:g&4?2:0);return a}},fix:function(a){if(a[i.expando])return a;var c,
d,e=a,f=i.event.fixHooks[a.type]||{},g=f.props?this.props.concat(f.props):this.props,a=i.Event(e);for(c=g.length;c;)d=g[--c],a[d]=e[d];a.target||(a.target=e.srcElement||y);3===a.target.nodeType&&(a.target=a.target.parentNode);a.metaKey===b&&(a.metaKey=a.ctrlKey);return f.filter?f.filter(a,e):a},special:{ready:{setup:i.bindReady},load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(a,b,c){i.isWindow(this)&&(this.onbeforeunload=c)},teardown:function(a,
b){this.onbeforeunload===b&&(this.onbeforeunload=null)}}},simulate:function(a,b,c,d){a=i.extend(new i.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?i.event.trigger(a,null,b):i.event.dispatch.call(b,a);a.isDefaultPrevented()&&c.preventDefault()}};i.event.handle=i.event.dispatch;i.removeEvent=y.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){a.detachEvent&&a.detachEvent("on"+b,c)};i.Event=function(a,b){if(!(this instanceof i.Event))return new i.Event(a,
b);a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||!1===a.returnValue||a.getPreventDefault&&a.getPreventDefault()?x:C):this.type=a;b&&i.extend(this,b);this.timeStamp=a&&a.timeStamp||i.now();this[i.expando]=!0};i.Event.prototype={preventDefault:function(){this.isDefaultPrevented=x;var a=this.originalEvent;!a||(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=x;var a=this.originalEvent;!a||(a.stopPropagation&&
a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=x;this.stopPropagation()},isDefaultPrevented:C,isPropagationStopped:C,isImmediatePropagationStopped:C};i.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){i.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c=a.relatedTarget,d=a.handleObj,e;if(!c||c!==this&&!i.contains(this,c))a.type=d.origType,e=d.handler.apply(this,arguments),a.type=b;return e}}});i.support.submitBubbles||
(i.event.special.submit={setup:function(){if(i.nodeName(this,"form"))return!1;i.event.add(this,"click._submit keypress._submit",function(a){a=a.target;(a=i.nodeName(a,"input")||i.nodeName(a,"button")?a.form:b)&&!a._submit_attached&&(i.event.add(a,"submit._submit",function(a){a._submit_bubble=!0}),a._submit_attached=!0)})},postDispatch:function(a){a._submit_bubble&&(delete a._submit_bubble,this.parentNode&&!a.isTrigger&&i.event.simulate("submit",this.parentNode,a,!0))},teardown:function(){if(i.nodeName(this,
"form"))return!1;i.event.remove(this,"._submit")}});i.support.changeBubbles||(i.event.special.change={setup:function(){if(ta.test(this.nodeName)){if("checkbox"===this.type||"radio"===this.type)i.event.add(this,"propertychange._change",function(a){"checked"===a.originalEvent.propertyName&&(this._just_changed=!0)}),i.event.add(this,"click._change",function(a){this._just_changed&&!a.isTrigger&&(this._just_changed=!1,i.event.simulate("change",this,a,!0))});return!1}i.event.add(this,"beforeactivate._change",
function(a){a=a.target;ta.test(a.nodeName)&&!a._change_attached&&(i.event.add(a,"change._change",function(a){this.parentNode&&!a.isSimulated&&!a.isTrigger&&i.event.simulate("change",this.parentNode,a,!0)}),a._change_attached=!0)})},handle:function(a){var b=a.target;if(this!==b||a.isSimulated||a.isTrigger||"radio"!==b.type&&"checkbox"!==b.type)return a.handleObj.handler.apply(this,arguments)},teardown:function(){i.event.remove(this,"._change");return ta.test(this.nodeName)}});i.support.focusinBubbles||
i.each({focus:"focusin",blur:"focusout"},function(a,b){var c=0,d=function(a){i.event.simulate(b,a.target,i.event.fix(a),!0)};i.event.special[b]={setup:function(){0===c++&&y.addEventListener(a,d,!0)},teardown:function(){0===--c&&y.removeEventListener(a,d,!0)}}});i.fn.extend({on:function(a,c,d,e,f){var g,h;if("object"==typeof a){"string"!=typeof c&&(d=d||c,c=b);for(h in a)this.on(h,c,d,a[h],f);return this}null==d&&null==e?(e=c,d=c=b):null==e&&("string"==typeof c?(e=d,d=b):(e=d,d=c,c=b));if(!1===e)e=
C;else if(!e)return this;1===f&&(g=e,e=function(a){i().off(a);return g.apply(this,arguments)},e.guid=g.guid||(g.guid=i.guid++));return this.each(function(){i.event.add(this,a,e,d,c)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,c,d){if(a&&a.preventDefault&&a.handleObj){var e=a.handleObj;i(a.delegateTarget).off(e.namespace?e.origType+"."+e.namespace:e.origType,e.selector,e.handler);return this}if("object"==typeof a){for(e in a)this.off(e,c,a[e]);return this}if(!1===c||"function"==
typeof c)d=c,c=b;!1===d&&(d=C);return this.each(function(){i.event.remove(this,a,d,c)})},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},live:function(a,b,c){i(this.context).on(a,this.selector,b,c);return this},die:function(a,b){i(this.context).off(a,this.selector||"**",b);return this},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1==arguments.length?this.off(a,"**"):this.off(b,a,c)},trigger:function(a,b){return this.each(function(){i.event.trigger(a,
b,this)})},triggerHandler:function(a,b){if(this[0])return i.event.trigger(a,b,this[0],!0)},toggle:function(a){var b=arguments,c=a.guid||i.guid++,d=0,e=function(c){var e=(i._data(this,"lastToggle"+a.guid)||0)%d;i._data(this,"lastToggle"+a.guid,e+1);c.preventDefault();return b[e].apply(this,arguments)||!1};for(e.guid=c;d<b.length;)b[d++].guid=c;return this.click(e)},hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}});i.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),
function(a,b){i.fn[b]=function(a,c){c==null&&(c=a,a=null);return arguments.length>0?this.on(b,null,a,c):this.trigger(b)};i.attrFn&&(i.attrFn[b]=true);bb.test(b)&&(i.event.fixHooks[b]=i.event.keyHooks);cb.test(b)&&(i.event.fixHooks[b]=i.event.mouseHooks)});(function(){function a(b,c,d,f,g,h){for(var g=0,i=f.length;g<i;g++){var j=f[g];if(j){for(var D=!1,j=j[b];j;){if(j[e]===d){D=f[j.sizset];break}if(1===j.nodeType)if(h||(j[e]=d,j.sizset=g),"string"!=typeof c){if(j===c){D=!0;break}}else if(0<p.filter(c,
[j]).length){D=j;break}j=j[b]}f[g]=D}}}function c(a,b,d,f,g,h){for(var g=0,i=f.length;g<i;g++){var j=f[g];if(j){for(var D=!1,j=j[a];j;){if(j[e]===d){D=f[j.sizset];break}1===j.nodeType&&!h&&(j[e]=d,j.sizset=g);if(j.nodeName.toLowerCase()===b){D=j;break}j=j[a]}f[g]=D}}}var d=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,e="sizcache"+(Math.random()+"").replace(".",""),f=0,g=Object.prototype.toString,h=!1,j=!0,m=/\\/g,
o=/\r\n/g,q=/\W/;[0,0].sort(function(){j=!1;return 0});var p=function(a,b,c,e){var c=c||[],f=b=b||y;if(1!==b.nodeType&&9!==b.nodeType)return[];if(!a||"string"!=typeof a)return c;var h,i,j,D,m,o,q=!0,r=p.isXML(b),F=[],S=a;do if(d.exec(""),h=d.exec(S))if(S=h[3],F.push(h[1]),h[2]){D=h[3];break}while(h);if(1<F.length&&t.exec(a))if(2===F.length&&s.relative[F[0]])i=B(F[0]+F[1],b,e);else for(i=s.relative[F[0]]?[b]:p(F.shift(),b);F.length;)a=F.shift(),s.relative[a]&&(a+=F.shift()),i=B(a,i,e);else if(!e&&
1<F.length&&9===b.nodeType&&!r&&s.match.ID.test(F[0])&&!s.match.ID.test(F[F.length-1])&&(m=p.find(F.shift(),b,r),b=m.expr?p.filter(m.expr,m.set)[0]:m.set[0]),b){m=e?{expr:F.pop(),set:v(e)}:p.find(F.pop(),1===F.length&&("~"===F[0]||"+"===F[0])&&b.parentNode?b.parentNode:b,r);i=m.expr?p.filter(m.expr,m.set):m.set;for(0<F.length?j=v(i):q=!1;F.length;)h=o=F.pop(),s.relative[o]?h=F.pop():o="",null==h&&(h=b),s.relative[o](j,h,r)}else j=[];j||(j=i);j||p.error(o||a);if("[object Array]"===g.call(j))if(q)if(b&&
1===b.nodeType)for(a=0;null!=j[a];a++)j[a]&&(!0===j[a]||1===j[a].nodeType&&p.contains(b,j[a]))&&c.push(i[a]);else for(a=0;null!=j[a];a++)j[a]&&1===j[a].nodeType&&c.push(i[a]);else c.push.apply(c,j);else v(j,c);D&&(p(D,f,c,e),p.uniqueSort(c));return c};p.uniqueSort=function(a){if(x&&(h=j,a.sort(x),h))for(var b=1;b<a.length;b++)a[b]===a[b-1]&&a.splice(b--,1);return a};p.matches=function(a,b){return p(a,null,null,b)};p.matchesSelector=function(a,b){return 0<p(b,null,null,[a]).length};p.find=function(a,
b,c){var d,e,f,g,h,i;if(!a)return[];e=0;for(f=s.order.length;e<f;e++)if(h=s.order[e],g=s.leftMatch[h].exec(a))if(i=g[1],g.splice(1,1),"\\"!==i.substr(i.length-1)&&(g[1]=(g[1]||"").replace(m,""),d=s.find[h](g,b,c),null!=d)){a=a.replace(s.match[h],"");break}d||(d="undefined"!=typeof b.getElementsByTagName?b.getElementsByTagName("*"):[]);return{set:d,expr:a}};p.filter=function(a,c,d,e){for(var f,g,h,i,j,D,m,o,q=a,F=[],r=c,S=c&&c[0]&&p.isXML(c[0]);a&&c.length;){for(h in s.filter)if(null!=(f=s.leftMatch[h].exec(a))&&
f[2])if(D=s.filter[h],j=f[1],g=!1,f.splice(1,1),"\\"!==j.substr(j.length-1)){r===F&&(F=[]);if(s.preFilter[h])if(f=s.preFilter[h](f,r,d,F,e,S)){if(!0===f)continue}else g=i=!0;if(f)for(m=0;null!=(j=r[m]);m++)j&&(i=D(j,f,m,r),o=e^i,d&&null!=i?o?g=!0:r[m]=!1:o&&(F.push(j),g=!0));if(i!==b){d||(r=F);a=a.replace(s.match[h],"");if(!g)return[];break}}if(a===q)if(null==g)p.error(a);else break;q=a}return r};p.error=function(a){throw Error("Syntax error, unrecognized expression: "+a);};var r=p.getText=function(a){var b,
c;b=a.nodeType;var d="";if(b)if(1===b||9===b||11===b){if("string"==typeof a.textContent)return a.textContent;if("string"==typeof a.innerText)return a.innerText.replace(o,"");for(a=a.firstChild;a;a=a.nextSibling)d+=r(a)}else{if(3===b||4===b)return a.nodeValue}else for(b=0;c=a[b];b++)8!==c.nodeType&&(d+=r(c));return d},s=p.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,
ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(a){return a.getAttribute("href")},
type:function(a){return a.getAttribute("type")}},relative:{"+":function(a,b){var c="string"==typeof b,d=c&&!q.test(b),c=c&&!d;d&&(b=b.toLowerCase());for(var d=0,e=a.length,f;d<e;d++)if(f=a[d]){for(;(f=f.previousSibling)&&1!==f.nodeType;);a[d]=c||f&&f.nodeName.toLowerCase()===b?f||!1:f===b}c&&p.filter(b,a,!0)},">":function(a,b){var c,d="string"==typeof b,e=0,f=a.length;if(d&&!q.test(b))for(b=b.toLowerCase();e<f;e++){if(c=a[e])c=c.parentNode,a[e]=c.nodeName.toLowerCase()===b?c:!1}else{for(;e<f;e++)(c=
a[e])&&(a[e]=d?c.parentNode:c.parentNode===b);d&&p.filter(b,a,!0)}},"":function(b,d,e){var g,h=f++,i=a;"string"==typeof d&&!q.test(d)&&(d=d.toLowerCase(),g=d,i=c);i("parentNode",d,h,b,g,e)},"~":function(b,d,e){var g,h=f++,i=a;"string"==typeof d&&!q.test(d)&&(d=d.toLowerCase(),g=d,i=c);i("previousSibling",d,h,b,g,e)}},find:{ID:function(a,b,c){if("undefined"!=typeof b.getElementById&&!c)return(a=b.getElementById(a[1]))&&a.parentNode?[a]:[]},NAME:function(a,b){if("undefined"!=typeof b.getElementsByName){for(var c=
[],d=b.getElementsByName(a[1]),e=0,f=d.length;e<f;e++)d[e].getAttribute("name")===a[1]&&c.push(d[e]);return 0===c.length?null:c}},TAG:function(a,b){if("undefined"!=typeof b.getElementsByTagName)return b.getElementsByTagName(a[1])}},preFilter:{CLASS:function(a,b,c,d,e,f){a=" "+a[1].replace(m,"")+" ";if(f)return a;for(var f=0,g;null!=(g=b[f]);f++)g&&(e^(g.className&&0<=(" "+g.className+" ").replace(/[\t\n\r]/g," ").indexOf(a))?c||d.push(g):c&&(b[f]=!1));return!1},ID:function(a){return a[1].replace(m,
"")},TAG:function(a){return a[1].replace(m,"").toLowerCase()},CHILD:function(a){if("nth"===a[1]){a[2]||p.error(a[0]);a[2]=a[2].replace(/^\+|\s*/g,"");var b=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec("even"===a[2]&&"2n"||"odd"===a[2]&&"2n+1"||!/\D/.test(a[2])&&"0n+"+a[2]||a[2]);a[2]=b[1]+(b[2]||1)-0;a[3]=b[3]-0}else a[2]&&p.error(a[0]);a[0]=f++;return a},ATTR:function(a,b,c,d,e,f){b=a[1]=a[1].replace(m,"");!f&&s.attrMap[b]&&(a[1]=s.attrMap[b]);a[4]=(a[4]||a[5]||"").replace(m,"");"~="===a[2]&&(a[4]=" "+a[4]+
" ");return a},PSEUDO:function(a,b,c,e,f){if("not"===a[1])if(1<(d.exec(a[3])||"").length||/^\w/.test(a[3]))a[3]=p(a[3],null,null,b);else return a=p.filter(a[3],b,c,1^f),c||e.push.apply(e,a),!1;else if(s.match.POS.test(a[0])||s.match.CHILD.test(a[0]))return!0;return a},POS:function(a){a.unshift(!0);return a}},filters:{enabled:function(a){return!1===a.disabled&&"hidden"!==a.type},disabled:function(a){return!0===a.disabled},checked:function(a){return!0===a.checked},selected:function(a){a.parentNode&&
a.parentNode.selectedIndex;return!0===a.selected},parent:function(a){return!!a.firstChild},empty:function(a){return!a.firstChild},has:function(a,b,c){return!!p(c[3],a).length},header:function(a){return/h\d/i.test(a.nodeName)},text:function(a){var b=a.getAttribute("type"),c=a.type;return"input"===a.nodeName.toLowerCase()&&"text"===c&&(b===c||null===b)},radio:function(a){return"input"===a.nodeName.toLowerCase()&&"radio"===a.type},checkbox:function(a){return"input"===a.nodeName.toLowerCase()&&"checkbox"===
a.type},file:function(a){return"input"===a.nodeName.toLowerCase()&&"file"===a.type},password:function(a){return"input"===a.nodeName.toLowerCase()&&"password"===a.type},submit:function(a){var b=a.nodeName.toLowerCase();return("input"===b||"button"===b)&&"submit"===a.type},image:function(a){return"input"===a.nodeName.toLowerCase()&&"image"===a.type},reset:function(a){var b=a.nodeName.toLowerCase();return("input"===b||"button"===b)&&"reset"===a.type},button:function(a){var b=a.nodeName.toLowerCase();
return"input"===b&&"button"===a.type||"button"===b},input:function(a){return/input|select|textarea|button/i.test(a.nodeName)},focus:function(a){return a===a.ownerDocument.activeElement}},setFilters:{first:function(a,b){return 0===b},last:function(a,b,c,d){return b===d.length-1},even:function(a,b){return 0===b%2},odd:function(a,b){return 1===b%2},lt:function(a,b,c){return b<c[3]-0},gt:function(a,b,c){return b>c[3]-0},nth:function(a,b,c){return c[3]-0===b},eq:function(a,b,c){return c[3]-0===b}},filter:{PSEUDO:function(a,
b,c,d){var e=b[1],f=s.filters[e];if(f)return f(a,c,b,d);if("contains"===e)return 0<=(a.textContent||a.innerText||r([a])||"").indexOf(b[3]);if("not"===e){b=b[3];c=0;for(d=b.length;c<d;c++)if(b[c]===a)return!1;return!0}p.error(e)},CHILD:function(a,b){var c,d,f,g,h,i;c=b[1];i=a;switch(c){case "only":case "first":for(;i=i.previousSibling;)if(1===i.nodeType)return!1;if("first"===c)return!0;i=a;case "last":for(;i=i.nextSibling;)if(1===i.nodeType)return!1;return!0;case "nth":c=b[2];d=b[3];if(1===c&&0===
d)return!0;f=b[0];if((g=a.parentNode)&&(g[e]!==f||!a.nodeIndex)){h=0;for(i=g.firstChild;i;i=i.nextSibling)1===i.nodeType&&(i.nodeIndex=++h);g[e]=f}i=a.nodeIndex-d;return 0===c?0===i:0===i%c&&0<=i/c}},ID:function(a,b){return 1===a.nodeType&&a.getAttribute("id")===b},TAG:function(a,b){return"*"===b&&1===a.nodeType||!!a.nodeName&&a.nodeName.toLowerCase()===b},CLASS:function(a,b){return-1<(" "+(a.className||a.getAttribute("class"))+" ").indexOf(b)},ATTR:function(a,b){var c=b[1],c=p.attr?p.attr(a,c):s.attrHandle[c]?
s.attrHandle[c](a):null!=a[c]?a[c]:a.getAttribute(c),d=c+"",e=b[2],f=b[4];return null==c?"!="===e:!e&&p.attr?null!=c:"="===e?d===f:"*="===e?0<=d.indexOf(f):"~="===e?0<=(" "+d+" ").indexOf(f):f?"!="===e?d!==f:"^="===e?0===d.indexOf(f):"$="===e?d.substr(d.length-f.length)===f:"|="===e?d===f||d.substr(0,f.length+1)===f+"-":!1:d&&!1!==c},POS:function(a,b,c,d){var e=s.setFilters[b[2]];if(e)return e(a,c,b,d)}}},t=s.match.POS,u=function(a,b){return"\\"+(b-0+1)},w;for(w in s.match)s.match[w]=RegExp(s.match[w].source+
/(?![^\[]*\])(?![^\(]*\))/.source),s.leftMatch[w]=RegExp(/(^(?:.|\r|\n)*?)/.source+s.match[w].source.replace(/\\(\d+)/g,u));s.match.globalPOS=t;var v=function(a,b){a=Array.prototype.slice.call(a,0);return b?(b.push.apply(b,a),b):a};try{Array.prototype.slice.call(y.documentElement.childNodes,0)[0].nodeType}catch(J){v=function(a,b){var c=0,d=b||[];if("[object Array]"===g.call(a))Array.prototype.push.apply(d,a);else if("number"==typeof a.length)for(var e=a.length;c<e;c++)d.push(a[c]);else for(;a[c];c++)d.push(a[c]);
return d}}var x,z;y.documentElement.compareDocumentPosition?x=function(a,b){return a===b?(h=!0,0):!a.compareDocumentPosition||!b.compareDocumentPosition?a.compareDocumentPosition?-1:1:a.compareDocumentPosition(b)&4?-1:1}:(x=function(a,b){if(a===b)return h=!0,0;if(a.sourceIndex&&b.sourceIndex)return a.sourceIndex-b.sourceIndex;var c,d,e=[],f=[];c=a.parentNode;d=b.parentNode;var g=c;if(c===d)return z(a,b);if(!c)return-1;if(!d)return 1;for(;g;)e.unshift(g),g=g.parentNode;for(g=d;g;)f.unshift(g),g=g.parentNode;
c=e.length;d=f.length;for(g=0;g<c&&g<d;g++)if(e[g]!==f[g])return z(e[g],f[g]);return g===c?z(a,f[g],-1):z(e[g],b,1)},z=function(a,b,c){if(a===b)return c;for(a=a.nextSibling;a;){if(a===b)return-1;a=a.nextSibling}return 1});(function(){var a=y.createElement("div"),c="script"+(new Date).getTime(),d=y.documentElement;a.innerHTML="<a name='"+c+"'/>";d.insertBefore(a,d.firstChild);y.getElementById(c)&&(s.find.ID=function(a,c,d){if("undefined"!=typeof c.getElementById&&!d)return(c=c.getElementById(a[1]))?
c.id===a[1]||"undefined"!=typeof c.getAttributeNode&&c.getAttributeNode("id").nodeValue===a[1]?[c]:b:[]},s.filter.ID=function(a,b){var c="undefined"!=typeof a.getAttributeNode&&a.getAttributeNode("id");return 1===a.nodeType&&c&&c.nodeValue===b});d.removeChild(a);d=a=null})();(function(){var a=y.createElement("div");a.appendChild(y.createComment(""));0<a.getElementsByTagName("*").length&&(s.find.TAG=function(a,b){var c=b.getElementsByTagName(a[1]);if("*"===a[1]){for(var d=[],e=0;c[e];e++)1===c[e].nodeType&&
d.push(c[e]);c=d}return c});a.innerHTML="<a href='#'></a>";a.firstChild&&"undefined"!=typeof a.firstChild.getAttribute&&"#"!==a.firstChild.getAttribute("href")&&(s.attrHandle.href=function(a){return a.getAttribute("href",2)});a=null})();y.querySelectorAll&&function(){var a=p,b=y.createElement("div");b.innerHTML="<p class='TEST'></p>";if(!b.querySelectorAll||0!==b.querySelectorAll(".TEST").length){p=function(b,c,d,e){c=c||y;if(!e&&!p.isXML(c)){var f=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(b);if(f&&
(1===c.nodeType||9===c.nodeType)){if(f[1])return v(c.getElementsByTagName(b),d);if(f[2]&&s.find.CLASS&&c.getElementsByClassName)return v(c.getElementsByClassName(f[2]),d)}if(9===c.nodeType){if("body"===b&&c.body)return v([c.body],d);if(f&&f[3]){var g=c.getElementById(f[3]);if(!g||!g.parentNode)return v([],d);if(g.id===f[3])return v([g],d)}try{return v(c.querySelectorAll(b),d)}catch(h){}}else if(1===c.nodeType&&"object"!==c.nodeName.toLowerCase()){var f=c,i=(g=c.getAttribute("id"))||"__sizzle__",j=
c.parentNode,D=/^\s*[+~]/.test(b);g?i=i.replace(/'/g,"\\$&"):c.setAttribute("id",i);D&&j&&(c=c.parentNode);try{if(!D||j)return v(c.querySelectorAll("[id='"+i+"'] "+b),d)}catch(m){}finally{g||f.removeAttribute("id")}}}return a(b,c,d,e)};for(var c in a)p[c]=a[c];b=null}}();(function(){var a=y.documentElement,b=a.matchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||a.msMatchesSelector;if(b){var c=!b.call(y.createElement("div"),"div"),d=!1;try{b.call(y.documentElement,"[test!='']:sizzle")}catch(e){d=
!0}p.matchesSelector=function(a,e){e=e.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!p.isXML(a))try{if(d||!s.match.PSEUDO.test(e)&&!/!=/.test(e)){var f=b.call(a,e);if(f||!c||a.document&&11!==a.document.nodeType)return f}}catch(g){}return 0<p(e,null,null,[a]).length}}})();(function(){var a=y.createElement("div");a.innerHTML="<div class='test e'></div><div class='test'></div>";a.getElementsByClassName&&0!==a.getElementsByClassName("e").length&&(a.lastChild.className="e",1!==a.getElementsByClassName("e").length&&
(s.order.splice(1,0,"CLASS"),s.find.CLASS=function(a,b,c){if("undefined"!=typeof b.getElementsByClassName&&!c)return b.getElementsByClassName(a[1])},a=null))})();y.documentElement.contains?p.contains=function(a,b){return a!==b&&(a.contains?a.contains(b):!0)}:y.documentElement.compareDocumentPosition?p.contains=function(a,b){return!!(a.compareDocumentPosition(b)&16)}:p.contains=function(){return!1};p.isXML=function(a){return(a=(a?a.ownerDocument||a:0).documentElement)?"HTML"!==a.nodeName:!1};var B=
function(a,b,c){for(var d,e=[],f="",b=b.nodeType?[b]:b;d=s.match.PSEUDO.exec(a);)f+=d[0],a=a.replace(s.match.PSEUDO,"");a=s.relative[a]?a+"*":a;d=0;for(var g=b.length;d<g;d++)p(a,b[d],e,c);return p.filter(f,e)};p.attr=i.attr;p.selectors.attrMap={};i.find=p;i.expr=p.selectors;i.expr[":"]=i.expr.filters;i.unique=p.uniqueSort;i.text=p.getText;i.isXMLDoc=p.isXML;i.contains=p.contains})();var fb=/Until$/,gb=/^(?:parents|prevUntil|prevAll)/,hb=/,/,Ya=/^.[^:#\[\.,]*$/,ib=Array.prototype.slice,Ia=i.expr.match.globalPOS,
jb={children:!0,contents:!0,next:!0,prev:!0};i.fn.extend({find:function(a){var b=this,c,d;if("string"!=typeof a)return i(a).filter(function(){c=0;for(d=b.length;c<d;c++)if(i.contains(b[c],this))return!0});var e=this.pushStack("","find",a),f,g,h;c=0;for(d=this.length;c<d;c++)if(f=e.length,i.find(a,this[c],e),0<c)for(g=f;g<e.length;g++)for(h=0;h<f;h++)if(e[h]===e[g]){e.splice(g--,1);break}return e},has:function(a){var b=i(a);return this.filter(function(){for(var a=0,c=b.length;a<c;a++)if(i.contains(this,
b[a]))return!0})},not:function(a){return this.pushStack(z(this,a,!1),"not",a)},filter:function(a){return this.pushStack(z(this,a,!0),"filter",a)},is:function(a){return!!a&&("string"==typeof a?Ia.test(a)?0<=i(a,this.context).index(this[0]):0<i.filter(a,this).length:0<this.filter(a).length)},closest:function(a,b){var c=[],d,e,f=this[0];if(i.isArray(a)){for(e=1;f&&f.ownerDocument&&f!==b;){for(d=0;d<a.length;d++)i(f).is(a[d])&&c.push({selector:a[d],elem:f,level:e});f=f.parentNode;e++}return c}var g=Ia.test(a)||
"string"!=typeof a?i(a,b||this.context):0;d=0;for(e=this.length;d<e;d++)for(f=this[d];f;){if(g?-1<g.index(f):i.find.matchesSelector(f,a)){c.push(f);break}f=f.parentNode;if(!f||!f.ownerDocument||f===b||11===f.nodeType)break}c=1<c.length?i.unique(c):c;return this.pushStack(c,"closest",a)},index:function(a){return!a?this[0]&&this[0].parentNode?this.prevAll().length:-1:"string"==typeof a?i.inArray(this[0],i(a)):i.inArray(a.jquery?a[0]:a,this)},add:function(a,b){var c="string"==typeof a?i(a,b):i.makeArray(a&&
a.nodeType?[a]:a),d=i.merge(this.get(),c);return this.pushStack(!c[0]||!c[0].parentNode||11===c[0].parentNode.nodeType||!d[0]||!d[0].parentNode||11===d[0].parentNode.nodeType?d:i.unique(d))},andSelf:function(){return this.add(this.prevObject)}});i.each({parent:function(a){return(a=a.parentNode)&&11!==a.nodeType?a:null},parents:function(a){return i.dir(a,"parentNode")},parentsUntil:function(a,b,c){return i.dir(a,"parentNode",c)},next:function(a){return i.nth(a,2,"nextSibling")},prev:function(a){return i.nth(a,
2,"previousSibling")},nextAll:function(a){return i.dir(a,"nextSibling")},prevAll:function(a){return i.dir(a,"previousSibling")},nextUntil:function(a,b,c){return i.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return i.dir(a,"previousSibling",c)},siblings:function(a){return i.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return i.sibling(a.firstChild)},contents:function(a){return i.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:i.makeArray(a.childNodes)}},function(a,
b){i.fn[a]=function(c,d){var e=i.map(this,b,c);fb.test(a)||(d=c);d&&"string"==typeof d&&(e=i.filter(d,e));e=1<this.length&&!jb[a]?i.unique(e):e;(1<this.length||hb.test(d))&&gb.test(a)&&(e=e.reverse());return this.pushStack(e,a,ib.call(arguments).join(","))}});i.extend({filter:function(a,b,c){c&&(a=":not("+a+")");return 1===b.length?i.find.matchesSelector(b[0],a)?[b[0]]:[]:i.find.matches(a,b)},dir:function(a,c,d){for(var e=[],a=a[c];a&&9!==a.nodeType&&(d===b||1!==a.nodeType||!i(a).is(d));)1===a.nodeType&&
e.push(a),a=a[c];return e},nth:function(a,b,c){for(var b=b||1,d=0;a&&!(1===a.nodeType&&++d===b);a=a[c]);return a},sibling:function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c}});var Aa="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",kb=/ jQuery\d+="(?:\d+|null)"/g,ua=/^\s+/,Ja=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,Ka=/<([\w:]+)/,
lb=/<tbody/i,mb=/<|&#?\w+;/,nb=/<(?:script|style)/i,ob=/<(?:script|object|embed|option|style)/i,La=RegExp("<(?:"+Aa+")[\\s/>]","i"),Ma=/checked\s*(?:[^=]|=\s*.checked.)/i,Na=/\/(java|ecma)script/i,pb=/^\s*<!(?:\[CDATA\[|\-\-)/,L={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],
area:[1,"<map>","</map>"],_default:[0,"",""]},va=q(y);L.optgroup=L.option;L.tbody=L.tfoot=L.colgroup=L.caption=L.thead;L.th=L.td;i.support.htmlSerialize||(L._default=[1,"div<div>","</div>"]);i.fn.extend({text:function(a){return i.access(this,function(a){return a===b?i.text(this):this.empty().append((this[0]&&this[0].ownerDocument||y).createTextNode(a))},null,a,arguments.length)},wrapAll:function(a){if(i.isFunction(a))return this.each(function(b){i(this).wrapAll(a.call(this,b))});if(this[0]){var b=
i(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]);b.map(function(){for(var a=this;a.firstChild&&1===a.firstChild.nodeType;)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){return i.isFunction(a)?this.each(function(b){i(this).wrapInner(a.call(this,b))}):this.each(function(){var b=i(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=i.isFunction(a);return this.each(function(c){i(this).wrapAll(b?a.call(this,c):
a)})},unwrap:function(){return this.parent().each(function(){i.nodeName(this,"body")||i(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.appendChild(a)})},prepend:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.insertBefore(a,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this)});if(arguments.length){var a=
i.clean(arguments);a.push.apply(a,this.toArray());return this.pushStack(a,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this.nextSibling)});if(arguments.length){var a=this.pushStack(this,"after",arguments);a.push.apply(a,i.clean(arguments));return a}},remove:function(a,b){for(var c=0,d;null!=(d=this[c]);c++)if(!a||i.filter(a,[d]).length)!b&&1===d.nodeType&&(i.cleanData(d.getElementsByTagName("*")),
i.cleanData([d])),d.parentNode&&d.parentNode.removeChild(d);return this},empty:function(){for(var a=0,b;null!=(b=this[a]);a++)for(1===b.nodeType&&i.cleanData(b.getElementsByTagName("*"));b.firstChild;)b.removeChild(b.firstChild);return this},clone:function(a,b){a=null==a?!1:a;b=null==b?a:b;return this.map(function(){return i.clone(this,a,b)})},html:function(a){return i.access(this,function(a){var c=this[0]||{},d=0,e=this.length;if(a===b)return 1===c.nodeType?c.innerHTML.replace(kb,""):null;if("string"==
typeof a&&!nb.test(a)&&(i.support.leadingWhitespace||!ua.test(a))&&!L[(Ka.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(Ja,"<$1></$2>");try{for(;d<e;d++)c=this[d]||{},1===c.nodeType&&(i.cleanData(c.getElementsByTagName("*")),c.innerHTML=a);c=0}catch(f){}}c&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(a){if(this[0]&&this[0].parentNode){if(i.isFunction(a))return this.each(function(b){var c=i(this),d=c.html();c.replaceWith(a.call(this,b,d))});"string"!=typeof a&&(a=i(a).detach());
return this.each(function(){var b=this.nextSibling,c=this.parentNode;i(this).remove();b?i(b).before(a):i(c).append(a)})}return this.length?this.pushStack(i(i.isFunction(a)?a():a),"replaceWith",a):this},detach:function(a){return this.remove(a,!0)},domManip:function(a,c,d){var e,f,g,h=a[0],j=[];if(!i.support.checkClone&&3===arguments.length&&"string"==typeof h&&Ma.test(h))return this.each(function(){i(this).domManip(a,c,d,!0)});if(i.isFunction(h))return this.each(function(e){var f=i(this);a[0]=h.call(this,
e,c?f.html():b);f.domManip(a,c,d)});if(this[0]){g=h&&h.parentNode;i.support.parentNode&&g&&11===g.nodeType&&g.childNodes.length===this.length?e={fragment:g}:e=i.buildFragment(a,this,j);g=e.fragment;1===g.childNodes.length?f=g=g.firstChild:f=g.firstChild;if(f){c=c&&i.nodeName(f,"tr");f=0;for(var m=this.length,o=m-1;f<m;f++)d.call(c?i.nodeName(this[f],"table")?this[f].getElementsByTagName("tbody")[0]||this[f].appendChild(this[f].ownerDocument.createElement("tbody")):this[f]:this[f],e.cacheable||1<m&&
f<o?i.clone(g,!0,!0):g)}j.length&&i.each(j,function(a,b){b.src?i.ajax({type:"GET",global:!1,url:b.src,async:!1,dataType:"script"}):i.globalEval((b.text||b.textContent||b.innerHTML||"").replace(pb,"/*$0*/"));b.parentNode&&b.parentNode.removeChild(b)})}return this}});i.buildFragment=function(a,b,c){var d,e,f,g,h=a[0];b&&b[0]&&(g=b[0].ownerDocument||b[0]);g.createDocumentFragment||(g=y);1===a.length&&"string"==typeof h&&512>h.length&&g===y&&"<"===h.charAt(0)&&!ob.test(h)&&(i.support.checkClone||!Ma.test(h))&&
(i.support.html5Clone||!La.test(h))&&(e=!0,f=i.fragments[h],f&&1!==f&&(d=f));d||(d=g.createDocumentFragment(),i.clean(a,g,d,c));e&&(i.fragments[h]=f?d:1);return{fragment:d,cacheable:e}};i.fragments={};i.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){i.fn[a]=function(c){var d=[],c=i(c),e=1===this.length&&this[0].parentNode;if(e&&11===e.nodeType&&1===e.childNodes.length&&1===c.length)return c[b](this[0]),this;for(var e=0,
f=c.length;e<f;e++){var g=(0<e?this.clone(!0):this).get();i(c[e])[b](g);d=d.concat(g)}return this.pushStack(d,a,c.selector)}});i.extend({clone:function(a,b,c){var d,e,f;i.support.html5Clone||i.isXMLDoc(a)||!La.test("<"+a.nodeName+">")?d=a.cloneNode(!0):(d=y.createElement("div"),va.appendChild(d),d.innerHTML=a.outerHTML,d=d.firstChild);var g=d;if((!i.support.noCloneEvent||!i.support.noCloneChecked)&&(1===a.nodeType||11===a.nodeType)&&!i.isXMLDoc(a)){v(a,g);d=w(a);e=w(g);for(f=0;d[f];++f)e[f]&&v(d[f],
e[f])}if(b&&(t(a,g),c)){d=w(a);e=w(g);for(f=0;d[f];++f)t(d[f],e[f])}return g},clean:function(a,b,c,d){var e,f=[],b=b||y;"undefined"==typeof b.createElement&&(b=b.ownerDocument||b[0]&&b[0].ownerDocument||y);for(var g=0,h;null!=(h=a[g]);g++)if("number"==typeof h&&(h+=""),h){if("string"==typeof h)if(mb.test(h)){h=h.replace(Ja,"<$1></$2>");e=(Ka.exec(h)||["",""])[1].toLowerCase();var j=L[e]||L._default,m=j[0],o=b.createElement("div"),r=va.childNodes,s;b===y?va.appendChild(o):q(b).appendChild(o);for(o.innerHTML=
j[1]+h+j[2];m--;)o=o.lastChild;if(!i.support.tbody){m=lb.test(h);j="table"===e&&!m?o.firstChild&&o.firstChild.childNodes:"<table>"===j[1]&&!m?o.childNodes:[];for(e=j.length-1;0<=e;--e)i.nodeName(j[e],"tbody")&&!j[e].childNodes.length&&j[e].parentNode.removeChild(j[e])}!i.support.leadingWhitespace&&ua.test(h)&&o.insertBefore(b.createTextNode(ua.exec(h)[0]),o.firstChild);h=o.childNodes;o&&(o.parentNode.removeChild(o),0<r.length&&(s=r[r.length-1],s&&s.parentNode&&s.parentNode.removeChild(s)))}else h=
b.createTextNode(h);var t;if(!i.support.appendChecked)if(h[0]&&"number"==typeof(t=h.length))for(e=0;e<t;e++)p(h[e]);else p(h);h.nodeType?f.push(h):f=i.merge(f,h)}if(c){a=function(a){return!a.type||Na.test(a.type)};for(g=0;f[g];g++)b=f[g],d&&i.nodeName(b,"script")&&(!b.type||Na.test(b.type))?d.push(b.parentNode?b.parentNode.removeChild(b):b):(1===b.nodeType&&(h=i.grep(b.getElementsByTagName("script"),a),f.splice.apply(f,[g+1,0].concat(h))),c.appendChild(b))}return f},cleanData:function(a){for(var b,
c,d=i.cache,e=i.event.special,f=i.support.deleteExpando,g=0,h;null!=(h=a[g]);g++)if(!h.nodeName||!i.noData[h.nodeName.toLowerCase()])if(c=h[i.expando]){if((b=d[c])&&b.events){for(var j in b.events)e[j]?i.event.remove(h,j):i.removeEvent(h,j,b.handle);b.handle&&(b.handle.elem=null)}f?delete h[i.expando]:h.removeAttribute&&h.removeAttribute(i.expando);delete d[c]}}});var wa=/alpha\([^)]*\)/i,qb=/opacity=([^)]*)/,rb=/([A-Z]|^ms)/g,sb=/^[\-+]?(?:\d*\.)?\d+$/i,qa=/^-?(?:\d*\.)?\d+(?!px)[^\d\s]+$/i,tb=/^([\-+])=([\-+.\de]+)/,
ub=/^margin/,vb={position:"absolute",visibility:"hidden",display:"block"},T=["Top","Right","Bottom","Left"],Z,Oa,Pa;i.fn.css=function(a,c){return i.access(this,function(a,c,d){return d!==b?i.style(a,c,d):i.css(a,c)},a,c,1<arguments.length)};i.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=Z(a,"opacity");return""===c?"1":c}return a.style.opacity}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":i.support.cssFloat?
"cssFloat":"styleFloat"},style:function(a,c,d,e){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var f,g=i.camelCase(c),h=a.style,j=i.cssHooks[g],c=i.cssProps[g]||g;if(d===b)return j&&"get"in j&&(f=j.get(a,!1,e))!==b?f:h[c];e=typeof d;"string"===e&&(f=tb.exec(d))&&(d=+(f[1]+1)*+f[2]+parseFloat(i.css(a,c)),e="number");if(!(null==d||"number"===e&&isNaN(d)))if("number"===e&&!i.cssNumber[g]&&(d+="px"),!j||!("set"in j)||(d=j.set(a,d))!==b)try{h[c]=d}catch(m){}}},css:function(a,c,d){var e,f,c=i.camelCase(c);
f=i.cssHooks[c];c=i.cssProps[c]||c;"cssFloat"===c&&(c="float");if(f&&"get"in f&&(e=f.get(a,!0,d))!==b)return e;if(Z)return Z(a,c)},swap:function(a,b,c){var d={},e;for(e in b)d[e]=a.style[e],a.style[e]=b[e];c=c.call(a);for(e in b)a.style[e]=d[e];return c}});i.curCSS=i.css;y.defaultView&&y.defaultView.getComputedStyle&&(Oa=function(a,b){var c,d,e,f,g=a.style,b=b.replace(rb,"-$1").toLowerCase();(d=a.ownerDocument.defaultView)&&(e=d.getComputedStyle(a,null))&&(c=e.getPropertyValue(b),""===c&&!i.contains(a.ownerDocument.documentElement,
a)&&(c=i.style(a,b)));!i.support.pixelMargin&&e&&ub.test(b)&&qa.test(c)&&(f=g.width,g.width=c,c=e.width,g.width=f);return c});y.documentElement.currentStyle&&(Pa=function(a,b){var c,d,e,f=a.currentStyle&&a.currentStyle[b],g=a.style;null==f&&g&&(e=g[b])&&(f=e);qa.test(f)&&(c=g.left,d=a.runtimeStyle&&a.runtimeStyle.left,d&&(a.runtimeStyle.left=a.currentStyle.left),g.left="fontSize"===b?"1em":f,f=g.pixelLeft+"px",g.left=c,d&&(a.runtimeStyle.left=d));return""===f?"auto":f});Z=Oa||Pa;i.each(["height",
"width"],function(a,b){i.cssHooks[b]={get:function(a,c,d){if(c)return 0!==a.offsetWidth?o(a,b,d):i.swap(a,vb,function(){return o(a,b,d)})},set:function(a,b){return sb.test(b)?b+"px":b}}});i.support.opacity||(i.cssHooks.opacity={get:function(a,b){return qb.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?parseFloat(RegExp.$1)/100+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=i.isNumeric(b)?"alpha(opacity="+100*b+")":"",f=d&&d.filter||c.filter||"";c.zoom=1;if(1<=
b&&""===i.trim(f.replace(wa,""))&&(c.removeAttribute("filter"),d&&!d.filter))return;c.filter=wa.test(f)?f.replace(wa,e):f+" "+e}});i(function(){i.support.reliableMarginRight||(i.cssHooks.marginRight={get:function(a,b){return i.swap(a,{display:"inline-block"},function(){return b?Z(a,"margin-right"):a.style.marginRight})}})});i.expr&&i.expr.filters&&(i.expr.filters.hidden=function(a){var b=a.offsetHeight;return 0===a.offsetWidth&&0===b||!i.support.reliableHiddenOffsets&&"none"===(a.style&&a.style.display||
i.css(a,"display"))},i.expr.filters.visible=function(a){return!i.expr.filters.hidden(a)});i.each({margin:"",padding:"",border:"Width"},function(a,b){i.cssHooks[a+b]={expand:function(c){for(var d="string"==typeof c?c.split(" "):[c],e={},c=0;4>c;c++)e[a+T[c]+b]=d[c]||d[c-2]||d[0];return e}}});var wb=/%20/g,Xa=/\[\]$/,Qa=/\r?\n/g,xb=/#.*$/,yb=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,zb=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,Ab=/^(?:GET|HEAD)$/,
Bb=/^\/\//,Ra=/\?/,Cb=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,Db=/^(?:select|textarea)/i,za=/\s+/,Eb=/([?&])_=[^&]*/,Sa=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,Ta=i.fn.load,pa={},Ua={},V,W,Va=["*/"]+["*"];try{V=ia.href}catch(Kb){V=y.createElement("a"),V.href="",V=V.href}W=Sa.exec(V.toLowerCase())||[];i.fn.extend({load:function(a,c,d){if("string"!=typeof a&&Ta)return Ta.apply(this,arguments);if(!this.length)return this;var e=a.indexOf(" ");if(0<=e)var f=a.slice(e,a.length),a=
a.slice(0,e);e="GET";c&&(i.isFunction(c)?(d=c,c=b):"object"==typeof c&&(c=i.param(c,i.ajaxSettings.traditional),e="POST"));var g=this;i.ajax({url:a,type:e,dataType:"html",data:c,complete:function(a,b,c){c=a.responseText;a.isResolved()&&(a.done(function(a){c=a}),g.html(f?i("<div>").append(c.replace(Cb,"")).find(f):c));d&&g.each(d,[c,b,a])}});return this},serialize:function(){return i.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?i.makeArray(this.elements):
this}).filter(function(){return this.name&&!this.disabled&&(this.checked||Db.test(this.nodeName)||zb.test(this.type))}).map(function(a,b){var c=i(this).val();return null==c?null:i.isArray(c)?i.map(c,function(a){return{name:b.name,value:a.replace(Qa,"\r\n")}}):{name:b.name,value:c.replace(Qa,"\r\n")}}).get()}});i.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,b){i.fn[b]=function(a){return this.on(b,a)}});i.each(["get","post"],function(a,c){i[c]=function(a,
d,e,f){i.isFunction(d)&&(f=f||e,e=d,d=b);return i.ajax({type:c,url:a,data:d,success:e,dataType:f})}});i.extend({getScript:function(a,c){return i.get(a,b,c,"script")},getJSON:function(a,b,c){return i.get(a,b,c,"json")},ajaxSetup:function(a,b){b?m(a,i.ajaxSettings):(b=a,a=i.ajaxSettings);m(a,b);return a},ajaxSettings:{url:V,isLocal:/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/.test(W[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:!0,
async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":Va},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":a.String,"text html":!0,"text json":i.parseJSON,"text xml":i.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:s(pa),ajaxTransport:s(Ua),ajax:function(a,c){function d(a,c,p,q){if(2!==J){J=2;w&&clearTimeout(w);t=b;r=q||"";y.readyState=0<a?4:
0;var s,D,u,q=c;if(p){var v=e,F=y,I=v.contents,z=v.dataTypes,B=v.responseFields,A,C,N,E;for(C in B)C in p&&(F[B[C]]=p[C]);for(;"*"===z[0];)z.shift(),A===b&&(A=v.mimeType||F.getResponseHeader("content-type"));if(A)for(C in I)if(I[C]&&I[C].test(A)){z.unshift(C);break}if(z[0]in p)N=z[0];else{for(C in p){if(!z[0]||v.converters[C+" "+z[0]]){N=C;break}E||(E=C)}N=N||E}N?(N!==z[0]&&z.unshift(N),p=p[N]):p=void 0}else p=b;if(200<=a&&300>a||304===a){if(e.ifModified){if(A=y.getResponseHeader("Last-Modified"))i.lastModified[o]=
A;if(A=y.getResponseHeader("Etag"))i.etag[o]=A}if(304===a)q="notmodified",s=!0;else try{A=e;A.dataFilter&&(p=A.dataFilter(p,A.dataType));var ha=A.dataTypes;C={};var G,ba,Za=ha.length,U,Q=ha[0],P,ga,K,H,$;for(G=1;G<Za;G++){if(1===G)for(ba in A.converters)"string"==typeof ba&&(C[ba.toLowerCase()]=A.converters[ba]);P=Q;Q=ha[G];if("*"===Q)Q=P;else if("*"!==P&&P!==Q){ga=P+" "+Q;K=C[ga]||C["* "+Q];if(!K)for(H in $=b,C)if(U=H.split(" "),U[0]===P||"*"===U[0])if($=C[U[1]+" "+Q]){H=C[H];!0===H?K=$:!0===$&&
(K=H);break}!K&&!$&&i.error("No conversion from "+ga.replace(" "," to "));!0!==K&&(p=K?K(p):$(H(p)))}}D=p;q="success";s=!0}catch(L){q="parsererror",u=L}}else if(u=q,!q||a)q="error",0>a&&(a=0);y.status=a;y.statusText=""+(c||q);s?h.resolveWith(f,[D,q,y]):h.rejectWith(f,[y,q,u]);y.statusCode(m);m=b;x&&g.trigger("ajax"+(s?"Success":"Error"),[y,e,s?D:u]);j.fireWith(f,[y,q]);x&&(g.trigger("ajaxComplete",[y,e]),--i.active||i.event.trigger("ajaxStop"))}}"object"==typeof a&&(c=a,a=b);var c=c||{},e=i.ajaxSetup({},
c),f=e.context||e,g=f!==e&&(f.nodeType||f instanceof i)?i(f):i.event,h=i.Deferred(),j=i.Callbacks("once memory"),m=e.statusCode||{},o,p={},q={},r,s,t,w,v,J=0,x,z,y={readyState:0,setRequestHeader:function(a,b){if(!J){var c=a.toLowerCase(),a=q[c]=q[c]||a;p[a]=b}return this},getAllResponseHeaders:function(){return 2===J?r:null},getResponseHeader:function(a){var c;if(2===J){if(!s)for(s={};c=yb.exec(r);)s[c[1].toLowerCase()]=c[2];c=s[a.toLowerCase()]}return c===b?null:c},overrideMimeType:function(a){J||
(e.mimeType=a);return this},abort:function(a){a=a||"abort";t&&t.abort(a);d(0,a);return this}};h.promise(y);y.success=y.done;y.error=y.fail;y.complete=j.add;y.statusCode=function(a){if(a){var b;if(2>J)for(b in a)m[b]=[m[b],a[b]];else b=a[y.status],y.then(b,b)}return this};e.url=((a||e.url)+"").replace(xb,"").replace(Bb,W[1]+"//");e.dataTypes=i.trim(e.dataType||"*").toLowerCase().split(za);null==e.crossDomain&&(v=Sa.exec(e.url.toLowerCase()),e.crossDomain=!(!v||v[1]==W[1]&&v[2]==W[2]&&(v[3]||("http:"===
v[1]?80:443))==(W[3]||("http:"===W[1]?80:443))));e.data&&e.processData&&"string"!=typeof e.data&&(e.data=i.param(e.data,e.traditional));u(pa,e,c,y);if(2===J)return!1;x=e.global;e.type=e.type.toUpperCase();e.hasContent=!Ab.test(e.type);x&&0===i.active++&&i.event.trigger("ajaxStart");if(!e.hasContent&&(e.data&&(e.url+=(Ra.test(e.url)?"&":"?")+e.data,delete e.data),o=e.url,!1===e.cache)){v=i.now();var B=e.url.replace(Eb,"$1_="+v);e.url=B+(B===e.url?(Ra.test(e.url)?"&":"?")+"_="+v:"")}(e.data&&e.hasContent&&
!1!==e.contentType||c.contentType)&&y.setRequestHeader("Content-Type",e.contentType);e.ifModified&&(o=o||e.url,i.lastModified[o]&&y.setRequestHeader("If-Modified-Since",i.lastModified[o]),i.etag[o]&&y.setRequestHeader("If-None-Match",i.etag[o]));y.setRequestHeader("Accept",e.dataTypes[0]&&e.accepts[e.dataTypes[0]]?e.accepts[e.dataTypes[0]]+("*"!==e.dataTypes[0]?", "+Va+"; q=0.01":""):e.accepts["*"]);for(z in e.headers)y.setRequestHeader(z,e.headers[z]);if(e.beforeSend&&(!1===e.beforeSend.call(f,y,
e)||2===J))return y.abort(),!1;for(z in{success:1,error:1,complete:1})y[z](e[z]);if(t=u(Ua,e,c,y)){y.readyState=1;x&&g.trigger("ajaxSend",[y,e]);e.async&&0<e.timeout&&(w=setTimeout(function(){y.abort("timeout")},e.timeout));try{J=1,t.send(p,d)}catch(A){if(2>J)d(-1,A);else throw A;}}else d(-1,"No Transport");return y},param:function(a,c){var d=[],e=function(a,b){b=i.isFunction(b)?b():b;d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};c===b&&(c=i.ajaxSettings.traditional);if(i.isArray(a)||
a.jquery&&!i.isPlainObject(a))i.each(a,function(){e(this.name,this.value)});else for(var f in a)j(f,a[f],c,e);return d.join("&").replace(wb,"+")}});i.extend({active:0,lastModified:{},etag:{}});var Fb=i.now(),ma=/(\=)\?(&|$)|\?\?/i;i.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return i.expando+"_"+Fb++}});i.ajaxPrefilter("json jsonp",function(b,c,d){c="string"==typeof b.data&&/^application\/x\-www\-form\-urlencoded/.test(b.contentType);if("jsonp"===b.dataTypes[0]||!1!==b.jsonp&&(ma.test(b.url)||
c&&ma.test(b.data))){var e,f=b.jsonpCallback=i.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,g=a[f],h=b.url,j=b.data,m="$1"+f+"$2";!1!==b.jsonp&&(h=h.replace(ma,m),b.url===h&&(c&&(j=j.replace(ma,m)),b.data===j&&(h+=(/\?/.test(h)?"&":"?")+b.jsonp+"="+f)));b.url=h;b.data=j;a[f]=function(a){e=[a]};d.always(function(){a[f]=g;e&&i.isFunction(g)&&a[f](e[0])});b.converters["script json"]=function(){e||i.error(f+" was not called");return e[0]};b.dataTypes[0]="json";return"script"}});i.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},
contents:{script:/javascript|ecmascript/},converters:{"text script":function(a){i.globalEval(a);return a}}});i.ajaxPrefilter("script",function(a){a.cache===b&&(a.cache=!1);a.crossDomain&&(a.type="GET",a.global=!1)});i.ajaxTransport("script",function(a){if(a.crossDomain){var c,d=y.head||y.getElementsByTagName("head")[0]||y.documentElement;return{send:function(e,f){c=y.createElement("script");c.async="async";a.scriptCharset&&(c.charset=a.scriptCharset);c.src=a.url;c.onload=c.onreadystatechange=function(a,
e){if(e||!c.readyState||/loaded|complete/.test(c.readyState))c.onload=c.onreadystatechange=null,d&&c.parentNode&&d.removeChild(c),c=b,e||f(200,"success")};d.insertBefore(c,d.firstChild)},abort:function(){c&&c.onload(0,1)}}}});var xa=a.ActiveXObject?function(){for(var a in ca)ca[a](0,1)}:!1,Gb=0,ca;i.ajaxSettings.xhr=a.ActiveXObject?function(){var b;if(!(b=!this.isLocal&&g()))a:{try{b=new a.ActiveXObject("Microsoft.XMLHTTP");break a}catch(c){}b=void 0}return b}:g;(function(a){i.extend(i.support,{ajax:!!a,
cors:!!a&&"withCredentials"in a})})(i.ajaxSettings.xhr());i.support.ajax&&i.ajaxTransport(function(c){if(!c.crossDomain||i.support.cors){var d;return{send:function(e,f){var g=c.xhr(),h,j;c.username?g.open(c.type,c.url,c.async,c.username,c.password):g.open(c.type,c.url,c.async);if(c.xhrFields)for(j in c.xhrFields)g[j]=c.xhrFields[j];c.mimeType&&g.overrideMimeType&&g.overrideMimeType(c.mimeType);!c.crossDomain&&!e["X-Requested-With"]&&(e["X-Requested-With"]="XMLHttpRequest");try{for(j in e)g.setRequestHeader(j,
e[j])}catch(m){}g.send(c.hasContent&&c.data||null);d=function(a,e){var j,m,o,p,q;try{if(d&&(e||4===g.readyState))if(d=b,h&&(g.onreadystatechange=i.noop,xa&&delete ca[h]),e)4!==g.readyState&&g.abort();else{j=g.status;o=g.getAllResponseHeaders();p={};(q=g.responseXML)&&q.documentElement&&(p.xml=q);try{p.text=g.responseText}catch(s){}try{m=g.statusText}catch(r){m=""}!j&&c.isLocal&&!c.crossDomain?j=p.text?200:404:1223===j&&(j=204)}}catch(t){e||f(-1,t)}p&&f(j,m,p,o)};!c.async||4===g.readyState?d():(h=
++Gb,xa&&(ca||(ca={},i(a).unload(xa)),ca[h]=d),g.onreadystatechange=d)},abort:function(){d&&d(0,1)}}}});var oa={},O,Y,Hb=/^(?:toggle|show|hide)$/,Ib=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,na,ja=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]],ka;i.fn.extend({show:function(a,b,c){var f;if(a||0===a)return this.animate(d("show",3),a,b,c);b=0;for(c=this.length;b<c;b++)a=this[b],a.style&&(f=a.style.display,!i._data(a,
"olddisplay")&&"none"===f&&(f=a.style.display=""),(""===f&&"none"===i.css(a,"display")||!i.contains(a.ownerDocument.documentElement,a))&&i._data(a,"olddisplay",e(a.nodeName)));for(b=0;b<c;b++)if(a=this[b],a.style&&(f=a.style.display,""===f||"none"===f))a.style.display=i._data(a,"olddisplay")||"";return this},hide:function(a,b,c){if(a||0===a)return this.animate(d("hide",3),a,b,c);for(var e,b=0,c=this.length;b<c;b++)a=this[b],a.style&&(e=i.css(a,"display"),"none"!==e&&!i._data(a,"olddisplay")&&i._data(a,
"olddisplay",e));for(b=0;b<c;b++)this[b].style&&(this[b].style.display="none");return this},_toggle:i.fn.toggle,toggle:function(a,b,c){var e="boolean"==typeof a;i.isFunction(a)&&i.isFunction(b)?this._toggle.apply(this,arguments):null==a||e?this.each(function(){var b=e?a:i(this).is(":hidden");i(this)[b?"show":"hide"]()}):this.animate(d("toggle",3),a,b,c);return this},fadeTo:function(a,b,c,d){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,
b,c,d){function f(){!1===g.queue&&i._mark(this);var b=i.extend({},g),c=1===this.nodeType,d=c&&i(this).is(":hidden"),h,j,m,o,p,q,s,r,t;b.animatedProperties={};for(m in a)if(h=i.camelCase(m),m!==h&&(a[h]=a[m],delete a[m]),(j=i.cssHooks[h])&&"expand"in j)for(m in o=j.expand(a[h]),delete a[h],o)m in a||(a[m]=o[m]);for(h in a){j=a[h];i.isArray(j)?(b.animatedProperties[h]=j[1],j=a[h]=j[0]):b.animatedProperties[h]=b.specialEasing&&b.specialEasing[h]||b.easing||"swing";if("hide"===j&&d||"show"===j&&!d)return b.complete.call(this);
c&&("height"===h||"width"===h)&&(b.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY],"inline"===i.css(this,"display")&&"none"===i.css(this,"float")&&(!i.support.inlineBlockNeedsLayout||"inline"===e(this.nodeName)?this.style.display="inline-block":this.style.zoom=1))}null!=b.overflow&&(this.style.overflow="hidden");for(m in a)c=new i.fx(this,b,m),j=a[m],Hb.test(j)?(t=i._data(this,"toggle"+m)||("toggle"===j?d?"show":"hide":0),t?(i._data(this,"toggle"+m,"show"===t?"hide":"show"),
c[t]()):c[j]()):(p=Ib.exec(j),q=c.cur(),p?(s=parseFloat(p[2]),r=p[3]||(i.cssNumber[m]?"":"px"),"px"!==r&&(i.style(this,m,(s||1)+r),q*=(s||1)/c.cur(),i.style(this,m,q+r)),p[1]&&(s=("-="===p[1]?-1:1)*s+q),c.custom(q,s,r)):c.custom(q,j,""));return!0}var g=i.speed(b,c,d);if(i.isEmptyObject(a))return this.each(g.complete,[!1]);a=i.extend({},a);return!1===g.queue?this.each(f):this.queue(g.queue,f)},stop:function(a,c,d){"string"!=typeof a&&(d=c,c=a,a=b);c&&!1!==a&&this.queue(a||"fx",[]);return this.each(function(){var b,
c=!1,e=i.timers,f=i._data(this);d||i._unmark(!0,this);if(null==a)for(b in f){if(f[b]&&f[b].stop&&b.indexOf(".run")===b.length-4){var g=f[b];i.removeData(this,b,!0);g.stop(d)}}else if(f[b=a+".run"]&&f[b].stop)f=f[b],i.removeData(this,b,!0),f.stop(d);for(b=e.length;b--;)e[b].elem===this&&(null==a||e[b].queue===a)&&(d?e[b](!0):e[b].saveState(),c=!0,e.splice(b,1));(!d||!c)&&i.dequeue(this,a)})}});i.each({slideDown:d("show",1),slideUp:d("hide",1),slideToggle:d("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},
fadeToggle:{opacity:"toggle"}},function(a,b){i.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}});i.extend({speed:function(a,b,c){var d=a&&"object"==typeof a?i.extend({},a):{complete:c||!c&&b||i.isFunction(a)&&a,duration:a,easing:c&&b||b&&!i.isFunction(b)&&b};d.duration=i.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in i.fx.speeds?i.fx.speeds[d.duration]:i.fx.speeds._default;if(null==d.queue||!0===d.queue)d.queue="fx";d.old=d.complete;d.complete=function(a){i.isFunction(d.old)&&d.old.call(this);
d.queue?i.dequeue(this,d.queue):!1!==a&&i._unmark(this)};return d},easing:{linear:function(a){return a},swing:function(a){return-Math.cos(a*Math.PI)/2+0.5}},timers:[],fx:function(a,b,c){this.options=b;this.elem=a;this.prop=c;b.orig=b.orig||{}}});i.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this);(i.fx.step[this.prop]||i.fx.step._default)(this)},cur:function(){if(null!=this.elem[this.prop]&&(!this.elem.style||null==this.elem.style[this.prop]))return this.elem[this.prop];
var a,b=i.css(this.elem,this.prop);return isNaN(a=parseFloat(b))?!b||"auto"===b?0:b:a},custom:function(a,c,d){function e(a){return f.step(a)}var f=this,g=i.fx;this.startTime=ka||h();this.end=c;this.now=this.start=a;this.pos=this.state=0;this.unit=d||this.unit||(i.cssNumber[this.prop]?"":"px");e.queue=this.options.queue;e.elem=this.elem;e.saveState=function(){i._data(f.elem,"fxshow"+f.prop)===b&&(f.options.hide?i._data(f.elem,"fxshow"+f.prop,f.start):f.options.show&&i._data(f.elem,"fxshow"+f.prop,
f.end))};e()&&i.timers.push(e)&&!na&&(na=setInterval(g.tick,g.interval))},show:function(){var a=i._data(this.elem,"fxshow"+this.prop);this.options.orig[this.prop]=a||i.style(this.elem,this.prop);this.options.show=!0;a!==b?this.custom(this.cur(),a):this.custom("width"===this.prop||"height"===this.prop?1:0,this.cur());i(this.elem).show()},hide:function(){this.options.orig[this.prop]=i._data(this.elem,"fxshow"+this.prop)||i.style(this.elem,this.prop);this.options.hide=!0;this.custom(this.cur(),0)},step:function(a){var b,
c,d=ka||h(),e=!0,f=this.elem,g=this.options;if(a||d>=g.duration+this.startTime){this.now=this.end;this.pos=this.state=1;this.update();g.animatedProperties[this.prop]=!0;for(b in g.animatedProperties)!0!==g.animatedProperties[b]&&(e=!1);if(e){null!=g.overflow&&!i.support.shrinkWrapBlocks&&i.each(["","X","Y"],function(a,b){f.style["overflow"+b]=g.overflow[a]});g.hide&&i(f).hide();if(g.hide||g.show)for(b in g.animatedProperties)i.style(f,b,g.orig[b]),i.removeData(f,"fxshow"+b,!0),i.removeData(f,"toggle"+
b,!0);(a=g.complete)&&(g.complete=!1,a.call(f))}return!1}Infinity==g.duration?this.now=d:(c=d-this.startTime,this.state=c/g.duration,this.pos=i.easing[g.animatedProperties[this.prop]](this.state,c,0,1,g.duration),this.now=this.start+(this.end-this.start)*this.pos);this.update();return!0}};i.extend(i.fx,{tick:function(){for(var a,b=i.timers,c=0;c<b.length;c++)a=b[c],!a()&&b[c]===a&&b.splice(c--,1);b.length||i.fx.stop()},interval:13,stop:function(){clearInterval(na);na=null},speeds:{slow:600,fast:200,
_default:400},step:{opacity:function(a){i.style(a.elem,"opacity",a.now)},_default:function(a){a.elem.style&&null!=a.elem.style[a.prop]?a.elem.style[a.prop]=a.now+a.unit:a.elem[a.prop]=a.now}}});i.each(ja.concat.apply([],ja),function(a,b){b.indexOf("margin")&&(i.fx.step[b]=function(a){i.style(a.elem,b,Math.max(0,a.now)+a.unit)})});i.expr&&i.expr.filters&&(i.expr.filters.animated=function(a){return i.grep(i.timers,function(b){return a===b.elem}).length});var ya,Jb=/^t(?:able|d|h)$/i,Wa=/^(?:body|html)$/i;
"getBoundingClientRect"in y.documentElement?ya=function(a,b,d,e){try{e=a.getBoundingClientRect()}catch(f){}if(!e||!i.contains(d,a))return e?{top:e.top,left:e.left}:{top:0,left:0};a=b.body;b=c(b);return{top:e.top+(b.pageYOffset||i.support.boxModel&&d.scrollTop||a.scrollTop)-(d.clientTop||a.clientTop||0),left:e.left+(b.pageXOffset||i.support.boxModel&&d.scrollLeft||a.scrollLeft)-(d.clientLeft||a.clientLeft||0)}}:ya=function(a,b,c){var d,e=a.offsetParent,f=b.body;d=(b=b.defaultView)?b.getComputedStyle(a,
null):a.currentStyle;for(var g=a.offsetTop,h=a.offsetLeft;(a=a.parentNode)&&(a!==f&&a!==c)&&!(i.support.fixedPosition&&"fixed"===d.position);)d=b?b.getComputedStyle(a,null):a.currentStyle,g-=a.scrollTop,h-=a.scrollLeft,a===e&&(g+=a.offsetTop,h+=a.offsetLeft,i.support.doesNotAddBorder&&(!i.support.doesAddBorderForTableAndCells||!Jb.test(a.nodeName))&&(g+=parseFloat(d.borderTopWidth)||0,h+=parseFloat(d.borderLeftWidth)||0),e=a.offsetParent),i.support.subtractsBorderForOverflowNotVisible&&"visible"!==
d.overflow&&(g+=parseFloat(d.borderTopWidth)||0,h+=parseFloat(d.borderLeftWidth)||0);if("relative"===d.position||"static"===d.position)g+=f.offsetTop,h+=f.offsetLeft;i.support.fixedPosition&&"fixed"===d.position&&(g+=Math.max(c.scrollTop,f.scrollTop),h+=Math.max(c.scrollLeft,f.scrollLeft));return{top:g,left:h}};i.fn.offset=function(a){if(arguments.length)return a===b?this:this.each(function(b){i.offset.setOffset(this,a,b)});var c=this[0],d=c&&c.ownerDocument;return!d?null:c===d.body?i.offset.bodyOffset(c):
ya(c,d,d.documentElement)};i.offset={bodyOffset:function(a){var b=a.offsetTop,c=a.offsetLeft;i.support.doesNotIncludeMarginInBodyOffset&&(b+=parseFloat(i.css(a,"marginTop"))||0,c+=parseFloat(i.css(a,"marginLeft"))||0);return{top:b,left:c}},setOffset:function(a,b,c){var d=i.css(a,"position");"static"===d&&(a.style.position="relative");var e=i(a),f=e.offset(),g=i.css(a,"top"),h=i.css(a,"left"),j={},m={},o,p;("absolute"===d||"fixed"===d)&&-1<i.inArray("auto",[g,h])?(m=e.position(),o=m.top,p=m.left):
(o=parseFloat(g)||0,p=parseFloat(h)||0);i.isFunction(b)&&(b=b.call(a,c,f));null!=b.top&&(j.top=b.top-f.top+o);null!=b.left&&(j.left=b.left-f.left+p);"using"in b?b.using.call(a,j):e.css(j)}};i.fn.extend({position:function(){if(!this[0])return null;var a=this[0],b=this.offsetParent(),c=this.offset(),d=Wa.test(b[0].nodeName)?{top:0,left:0}:b.offset();c.top-=parseFloat(i.css(a,"marginTop"))||0;c.left-=parseFloat(i.css(a,"marginLeft"))||0;d.top+=parseFloat(i.css(b[0],"borderTopWidth"))||0;d.left+=parseFloat(i.css(b[0],
"borderLeftWidth"))||0;return{top:c.top-d.top,left:c.left-d.left}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent||y.body;a&&!Wa.test(a.nodeName)&&"static"===i.css(a,"position");)a=a.offsetParent;return a})}});i.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,d){var e=/Y/.test(d);i.fn[a]=function(f){return i.access(this,function(a,f,g){var h=c(a);if(g===b)return h?d in h?h[d]:i.support.boxModel&&h.document.documentElement[f]||h.document.body[f]:a[f];
h?h.scrollTo(e?i(h).scrollLeft():g,e?g:i(h).scrollTop()):a[f]=g},a,f,arguments.length,null)}});i.each({Height:"height",Width:"width"},function(a,c){var d="client"+a,e="scroll"+a,f="offset"+a;i.fn["inner"+a]=function(){var a=this[0];return a?a.style?parseFloat(i.css(a,c,"padding")):this[c]():null};i.fn["outer"+a]=function(a){var b=this[0];return b?b.style?parseFloat(i.css(b,c,a?"margin":"border")):this[c]():null};i.fn[c]=function(a){return i.access(this,function(a,c,g){if(i.isWindow(a))return c=a.document,
a=c.documentElement[d],i.support.boxModel&&a||c.body&&c.body[d]||a;if(9===a.nodeType)return c=a.documentElement,c[d]>=c[e]?c[d]:Math.max(a.body[e],c[e],a.body[f],c[f]);if(g===b)return a=i.css(a,c),c=parseFloat(a),i.isNumeric(c)?c:a;i(a).css(c,g)},c,a,arguments.length,null)}});a.jQuery=a.$=i;"function"==typeof define&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return i})})(window);
function Karyoscape(a,b){this.browser=a;this.dsn=b;this.svg=makeElementNS(NS_SVG,"g");this.width=250}Karyoscape.prototype.update=function(a,b,c){this.start=b;this.end=c;if(!this.chr||a!=this.chr){this.chr=a;removeChildren(this.svg);var e=this;this.dsn.features(new DASSegment(a),{type:"karyotype"},function(b,c,h){e.chrLen=h&&h[a]&&h[a].max?h[a].max:null;e.karyos=b||[];e.redraw()})}else this.setThumb()};
var karyo_palette={gneg:"white",gpos25:"rgb(200,200,200)",gpos33:"rgb(180,180,180)",gpos50:"rgb(128,128,128)",gpos66:"rgb(100,100,100)",gpos75:"rgb(64,64,64)",gpos100:"rgb(0,0,0)",gpos:"rgb(0,0,0)",gvar:"rgb(100,100,100)",acen:"rgb(100,100,100)",stalk:"rgb(100,100,100)"};
Karyoscape.prototype.redraw=function(){removeChildren(this.svg);this.karyos=this.karyos.sort(function(a,b){return(a.min|0)-(b.min|0)});0<this.karyos.length?this.chrLen||(this.chrLen=this.karyos[this.karyos.length-1].max):(this.chrLen||(alert("Warning: insufficient data to set up spatial navigator"),this.chrLen=2E8),this.karyos.push({min:1,max:this.chrLen,label:"gneg"}));for(var a=null,b=0;b<this.karyos.length;++b){var c=this.karyos[b],e=1*c.min/this.chrLen*this.width,d=1*c.max/this.chrLen*this.width,
f=karyo_palette[c.label];f&&d>e&&(e=makeElementNS(NS_SVG,"rect",null,{x:e,y:"stalk"==c.label||"acen"==c.label?5:0,width:d-e,height:"stalk"==c.label||"acen"==c.label?5:15,stroke:"none",fill:f}),"g"==c.label.substring(0,1)&&(d=new Range(c.min,c.max),a=null==a?d:union(a,d)),this.browser.makeTooltip(e,c.id),this.svg.appendChild(e))}if(a){for(var a=a.ranges(),b="M 0 10 L 0 0",c="M 0 5 L 0 15",h=f=0;h<a.length;++h)d=a[h],e=1*d.min()/this.chrLen*this.width,d=1*d.max()/this.chrLen*this.width,0.75<e-f&&(b+=
" M "+e+" 0",c+=" M "+e+" 15"),b+=" L "+d+" 0",c+=" L "+d+" 15",f=d;0.75<this.width-f?(b+=" M "+this.width+" 0",c+=" M "+this.width+" 15"):(b+=" L "+this.width+" 0",c+=" L "+this.width+" 15");b+=" L "+this.width+" 10";c+=" L "+this.width+" 5";this.svg.appendChild(makeElementNS(NS_SVG,"path",null,{d:b+" "+c,stroke:"black",strokeWidth:2,fill:"none"}))}this.thumb=makeElementNS(NS_SVG,"rect",null,{x:50,y:-5,width:8,height:25,fill:"blue",fillOpacity:0.5,stroke:"none"});this.svg.appendChild(this.thumb);
this.setThumb();var g=this,j,m=function(a){a.stopPropagation();a.preventDefault();a=Math.max(-4,Math.min(a.clientX+j,g.width-4));g.thumb.setAttribute("x",a)},u=function(a){a.stopPropagation();a.preventDefault();if(g.onchange)g.onchange(1*((g.thumb.getAttribute("x")|0)+4)/g.width,true);document.removeEventListener("mousemove",m,true);document.removeEventListener("mouseup",u,true)};this.thumb.addEventListener("mousedown",function(a){a.stopPropagation();a.preventDefault();j=g.thumb.getAttribute("x")-
a.clientX;document.addEventListener("mousemove",m,true);document.addEventListener("mouseup",u,true)},!1)};Karyoscape.prototype.setThumb=function(){var a=1*(((this.start|0)+(this.end|0))/2)/this.chrLen*this.width;this.thumb&&this.thumb.setAttribute("x",a-4)};function FetchPool(){this.reqs=[]}FetchPool.prototype.addRequest=function(a){this.reqs.push(a)};FetchPool.prototype.abortAll=function(){for(var a=0;a<this.reqs.length;++a)this.reqs[a].abort()};
function KSCacheBaton(a,b,c,e,d,f){this.chr=a;this.min=b;this.max=c;this.scale=e;this.features=d||[];this.status=f}KSCacheBaton.prototype.toString=function(){return this.chr+":"+this.min+".."+this.max+";scale="+this.scale};function KnownSpace(a,b,c,e,d,f){this.tierMap=a;this.chr=b;this.min=c;this.max=e;this.scale=d;this.seqSource=f||new DummySequenceSource;this.featureCache={}}KnownSpace.prototype.bestCacheOverlapping=function(){var a=this.featureCache[this.tierMap[0]];return a?a:null};
KnownSpace.prototype.viewFeatures=function(a,b,c,e){if(e!=e)throw"viewFeatures called with silly scale";if(a!=this.chr)throw"Can't extend Known Space to a new chromosome";this.min=b;this.max=c;this.scale=e;this.pool&&this.pool.abortAll();this.pool=new FetchPool;this.awaitedSeq=new Awaited;this.seqWasFetched=!1;this.startFetchesForTiers(this.tierMap)};
function filterFeatures(a,b,c){var e=[];featuresByGroup={};for(var d=0;d<a.length;++d){var f=a[d];!f.min||!f.max?e.push(f):f.groups&&0<f.groups.length?pusho(featuresByGroup,f.groups[0].id,f):f.min<=c&&f.max>=b&&e.push(f)}for(var h in featuresByGroup){for(var a=featuresByGroup[h],g=1E11,j=-1E11,d=0;d<a.length;++d)f=a[d],g=Math.min(g,f.min),j=Math.max(j,f.max);if(g<=c||j>=b)for(d=0;d<a.length;++d)e.push(a[d])}return e}KnownSpace.prototype.invalidate=function(a){this.featureCache[a]=null;this.startFetchesForTiers([a])};
KnownSpace.prototype.startFetchesForTiers=function(a){for(var b=this,c=this.awaitedSeq,e=!1,d=0;d<a.length;++d)this.startFetchesFor(a[d],c)&&(e=!0);if(e&&!this.seqWasFetched){this.seqWasFetched=!0;var f=this.min,h=this.max;if(this.cs&&this.cs.start<=f&&this.cs.end>=h)return a=this.cs.start==f&&this.cs.end==h?this.cs:new DASSequence(this.cs.name,f,h,this.cs.alphabet,this.cs.seq.substring(f-this.cs.start,h+1-this.cs.start)),c.provide(a);this.seqSource.fetch(this.chr,f,h,this.pool,function(a,d){if(d){if(!b.cs||
f<=b.cs.start&&h>=b.cs.end||f>=b.cs.end||h<=b.cs.start||h-f>b.cs.end-b.cs.start)b.cs=d;c.provide(d)}else dlog("Noseq: "+miniJSONify(a))})}};
KnownSpace.prototype.startFetchesFor=function(a,b){var c=this,e=a.getSource()||new DummyFeatureSource,d=a.needsSequence(this.scale),f=c.featureCache[a],h=a.getDesiredTypes(this.scale);if(void 0===h)return!1;if(f&&f.chr===this.chr&&f.min<=this.min&&f.max>=this.max){var g=f.features;if(f.min<this.min||f.max>this.max)g=filterFeatures(g,this.min,this.max);c.provision(a,f.chr,Math.max(f.min,this.min),Math.min(f.max,this.max),f.scale,h,g,f.status,d?b:null);g=e.getScales();if(f.scale<=this.scale||!g)return d}e.fetch(this.chr,
this.min,this.max,this.scale,h,this.pool,function(e,g,u){if(!f||c.min<f.min||c.max>f.max)c.featureCache[a]=new KSCacheBaton(c.chr,c.min,c.max,u,g,e);c.provision(a,c.chr,c.min,c.max,c.scale,h,g,e,d?b:null)});return d};
KnownSpace.prototype.provision=function(a,b,c,e,d,f,h,g,j){if(g)a.updateStatus(g);else{if(d<this.scale/2&&200<h.length||BWGFeatureSource.prototype.isPrototypeOf(a.getSource())&&f&&1==f.length&&0<=f.indexOf("density")||BAMFeatureSource.prototype.isPrototypeOf(a.getSource())&&f&&1==f.length&&0<=f.indexOf("density"))h=downsample(h,this.scale);j?j.await(function(f){a.viewFeatures(b,c,e,d,h,f)}):a.viewFeatures(b,c,e,d,h)}};function DASFeatureSource(a){this.dasSource=a}
DASFeatureSource.prototype.fetch=function(a,b,c,e,d,f,h){if(d&&0==d.length)h(null,[],e);else if(this.dasSource.uri){var g=!1!==this.dasSource.maxbins,d={type:d};g&&(d.maxbins=1+((c-b)/e|0));this.dasSource.features(new DASSegment(a,b,c),d,function(a,b){var c=e;g||(c=0.1);h(b,a,c)})}};function DASSequenceSource(a){this.dasSource=a}DASSequenceSource.prototype.fetch=function(a,b,c,e,d){this.dasSource.sequence(new DASSegment(a,b,c),function(a){return 1==a.length?d(null,a[0]):d("Didn't get sequence")})};
function TwoBitSequenceSource(a){var b=this;this.source=a;this.twoBit=new Awaited;makeTwoBit(new URLFetchable(a.twoBitURI),function(a,e){e?dlog(e):b.twoBit.provide(a)})}TwoBitSequenceSource.prototype.fetch=function(a,b,c,e,d){this.twoBit.await(function(e){e.fetch(a,b,c,function(e,f){if(f)return d(f,null);var j=new DASSequence(a,b,c,"DNA",e);return d(null,j)})})};DASFeatureSource.prototype.getScales=function(){return[]};var bwg_preflights={};
function BWGFeatureSource(a,b){var c=this;this.bwgSource=a;this.opts=b||{};c.bwgHolder=new Awaited;if(this.opts.preflight){var e=bwg_preflights[this.opts.preflight];if(!e){e=new Awaited;bwg_preflights[this.opts.preflight]=e;var d=new XMLHttpRequest;d.onreadystatechange=function(){4==d.readyState&&(200==d.status?e.provide("success"):e.provide("failure"))};d.open("get",this.opts.preflight+"?"+hex_sha1("salt"+Date.now()),!0);this.opts.credentials&&(d.withCredentials=!0);d.send("")}e.await(function(a){"success"===
a&&c.init()})}else c.init()}function BAMFeatureSource(a,b){var c=this;this.bamSource=a;this.opts=b||{};this.bamHolder=new Awaited;var e,d;a.bamBlob?(e=new BlobFetchable(a.bamBlob),d=new BlobFetchable(a.baiBlob)):(e=new URLFetchable(a.bamURI),d=new URLFetchable(a.baiURI||a.bamURI+".bai"));makeBam(e,d,function(a){c.bamHolder.provide(a)})}
BAMFeatureSource.prototype.fetch=function(a,b,c,e,d,f,h){this.bamHolder.await(function(d){d.fetch(a,b,c,function(a,b){if(b)h(b,null,null);else{for(var c=[],d=0;d<a.length;++d){var e=a[d],f=new DASFeature;f.min=e.pos+1;f.max=e.pos+e.seq.length;f.segment=e.segment;f.type="bam";f.id=e.readName;f.notes=["Sequence="+e.seq,"CIGAR="+e.cigar,"MQ="+e.mq];f.seq=e.seq;c.push(f)}h(null,c,1E9)}})})};BAMFeatureSource.prototype.getScales=function(){return 1E9};
BWGFeatureSource.prototype.init=function(){var a=this,b,c;this.bwgSource.bwgURI?(b=makeBwgFromURL,c=this.bwgSource.bwgURI):(b=makeBwgFromFile,c=this.bwgSource.bwgBlob);b(c,function(b){a.bwgHolder.provide(b)},this.opts.credentials)};
BWGFeatureSource.prototype.fetch=function(a,b,c,e,d,f,h){var g=this;this.bwgHolder.await(function(f){if(null==f)return h("Can't access binary file",null,null);var m=!d||0==d.length||0<=arrayIndexOf(d,"density");g.opts.clientBin&&(m=!1);if("bigwig"==f.type||m||"undefined"!==typeof g.opts.forceReduction){for(var m=-1,u=0;u<f.zoomLevels.length;++u)if(f.zoomLevels[u].reduction<=e)m=u;else break;"undefined"!==typeof g.opts.forceReduction&&(m=g.opts.forceReduction);f=0>m?f.getUnzoomedView():f.getZoomedView(m)}else f=
f.getUnzoomedView();f.readWigData(a,b,c,function(a){var d=1E9,e=(c-b)/a.length/2;e<d&&(d=e);h(null,a,d)})})};BWGFeatureSource.prototype.getScales=function(){var a=this.bwgHolder.res;if(a){for(var b=[1],c=0;c<a.zoomLevels.length;++c)b.push(a.zoomLevels[c].reduction);return b}return null};function MappedFeatureSource(a,b){this.source=a;this.mapping=b}MappedFeatureSource.prototype.getScales=function(){return this.source.getScales()};
MappedFeatureSource.prototype.fetch=function(a,b,c,e,d,f,h){var g=this;this.mapping.sourceBlocksForRange(a,b,c,function(b){0==b.length?h("No mapping available for this regions",[],e):(b=b[0],g.source.fetch(b.name,b.start,b.end,e,d,f,function(b,c,d){var e=[];if(c)for(var f=0;f<c.length;++f){var j=c[f],w=j.segment;0==w.indexOf("chr")&&(w=w.substr(3));var v=g.mapping.mapPoint(w,j.min),w=g.mapping.mapPoint(w,j.max);!v||!w||v.seq!=w.seq||v.seq!=a?j.parts&&0<j.parts.length&&e.push(j):(j.segment=v.seq,j.min=
v.pos,j.max=w.pos,j.min>j.max&&(w=j.max,j.max=j.min,j.min=w),v.flipped&&("-"==j.orientation?j.orientation="+":"+"==j.orientation&&(j.orientation="-")),e.push(j))}h(b,e,d)}))})};function DummyFeatureSource(){}DummyFeatureSource.prototype.getScales=function(){return null};DummyFeatureSource.prototype.fetch=function(a,b,c,e,d,f,h){return h(null,[],1E9)};function DummySequenceSource(){}DummySequenceSource.prototype.fetch=function(a,b,c,e,d){return d(null,null)};var VALID_BOUND_RE=/^-?[0-9]+(\.[0-9]+)?$/;
Browser.prototype.makeQuantConfigButton=function(a,b){var c=this;a.addEventListener("mousedown",function(a){a.stopPropagation();a.preventDefault();c.removeAllPopups();var d=makeElement("table"),f=makeElement("input","",{value:b.min});d.appendChild(makeElement("tr",[makeElement("td","Min:"),makeElement("td",f)]));var h=makeElement("input","",{value:b.max});d.appendChild(makeElement("tr",[makeElement("td","Max:"),makeElement("td",h)]));var g=makeElement("div","Update");g.style.backgroundColor="rgb(230,230,250)";
g.style.borderStyle="solid";g.style.borderColor="blue";g.style.borderWidth="3px";g.style.padding="2px";g.style.margin="10px";g.style.width="150px";g.addEventListener("mousedown",function(a){a.stopPropagation();a.preventDefault();VALID_BOUND_RE.test(f.value)?VALID_BOUND_RE.test(h.value)?(b.dasSource.forceMin=f.value,b.dasSource.forceMax=h.value,c.removeAllPopups(),b.draw(),c.storeStatus()):alert("Don't understand "+h.value):alert("Don't understand "+f.value)},!1);c.popit(a,"Configure: "+b.dasSource.name,
[d,g])},!1)};var __DS_SCALES=[1,2,5];function ds_scale(a){return __DS_SCALES[a%__DS_SCALES.length]*Math.pow(10,a/__DS_SCALES.length|0)}function DSBin(a,b,c){this.scale=a;this.cnt=this.tot=0;this.hasScore=!1;this.min=b;this.max=c;this.lap=0;this.covered=null}DSBin.prototype.score=function(){return 0==this.cnt?0:this.hasScore?this.tot/this.cnt:this.lap/coverage(this.covered)};
DSBin.prototype.feature=function(a){a.score&&(this.tot+=a.score,this.hasScore=!0);var b=a.max|0,a=Math.max(this.min,a.min|0),b=Math.min(this.max,b);this.lap+=1*(b-a+1);++this.cnt;b=new Range(a,b);this.covered=this.covered?union(this.covered,b):b};
function downsample(a,b){Date.now();for(var c=0;ds_scale(c+1)<b;)++c;for(var c=ds_scale(c),e=[],d=-1E10,f=1E10,h=0;h<a.length;++h){var g=a[h];if(g.groups&&0<g.groups.length)return a;for(var j=g.min/c|0,m=g.max/c|0,d=Math.max(d,m),f=Math.min(f,j);j<=m;++j){var u=e[j];u||(u=new DSBin(c,j*c,(j+1)*c-1),e[j]=u);u.feature(g)}}h=[];for(j=f;j<=d;++j)if(u=e[j])g=new DASFeature,g.segment=a[0].segment,g.min=j*c+1,g.max=(j+1)*c,g.score=u.score(),g.type="density",h.push(g);Date.now();return h}
var MIN_TILE=75,rulerTileColors=["black","white"],baseColors={A:"green",C:"blue",G:"black",T:"red"},steps=[1,2,5];function tileSizeForScale(a,b){b||(b=MIN_TILE);for(var c=steps.length;a*steps[c%steps.length]*Math.pow(10,c/steps.length|0)<b;)++c;return steps[c%steps.length]*Math.pow(10,c/steps.length|0)}
function drawGuidelines(a,b){if("background"==a.browser.guidelineStyle){var c=tileSizeForScale(a.browser.scale,teir.browser.guidelineSpacing),e=Math.max(0,(a.browser.knownStart/c|0)*c),d=knownEnd;0<a.browser.currentSeqMax&&a.browser.currentSeqMax<a.browser.knownEnd&&(d=a.browser.currentSeqMax);for(;e<=d;e+=c){var f=document.createElementNS(NS_SVG,"line");f.setAttribute("x1",(e-origin)*scale);f.setAttribute("y1",0);f.setAttribute("x2",(e-origin)*scale);f.setAttribute("y2",1E3);f.setAttribute("stroke",
"black");f.setAttribute("stroke-opacity",0.2);f.setAttribute("stroke-width",1);b.appendChild(f)}}}
function drawSeqTier(a,b){var c=a.browser.scale,e=a.knownStart,d=a.knownEnd,f=a.browser.origin,h=a.browser.currentSeqMax;if(c){for(var g=a.viewport;0<g.childNodes.length;)g.removeChild(g.firstChild);g.appendChild(a.background);drawGuidelines(a,g);var j=tileSizeForScale(c),e=Math.max(0,(e/j|0)*j),m=d;0<h&&h<d&&(m=h);d=!1;if(b&&b.seq)for(h=b.start;h<=b.end;++h){var u=b.seq.substr(h-b.start,1).toUpperCase(),s=baseColors[u];s||(s="gray");if(8<=c){var o=document.createElementNS(NS_SVG,"text");o.setAttribute("x",
(h-f)*c);o.setAttribute("y",12);o.setAttribute("stroke-width","0");o.setAttribute("fill",s);o.setAttribute("class","label-text");o.appendChild(document.createTextNode(u))}else o=document.createElementNS(NS_SVG,"rect"),o.setAttribute("x",(h-f)*c),o.setAttribute("y",5),o.setAttribute("height",10),o.setAttribute("width",c),o.setAttribute("fill",s),o.setAttribute("stroke","none");g.appendChild(o)}else d=!0;for(;e<=m;)d&&(o=document.createElementNS(NS_SVG,"rect"),o.setAttribute("x",(e-f)*c),o.setAttribute("y",
8),o.setAttribute("height",3),h=Math.min(j,m-e)*c,o.setAttribute("width",h),o.setAttribute("fill",rulerTileColors[e/j%2]),o.setAttribute("stroke-width",1),g.appendChild(o)),0==e/j%2&&(h=0,d||(g.appendChild(makeElementNS(NS_SVG,"line",null,{x1:(e-f)*c,y1:15,x2:(e-f)*c,y2:35,stroke:"rgb(80, 90, 150)",strokeWidth:1})),h+=3),o=document.createElementNS(NS_SVG,"text"),o.setAttribute("x",(e-f)*c+h),o.setAttribute("y",30),o.setAttribute("stroke-width","0"),o.setAttribute("fill","black"),o.setAttribute("class",
"label-text"),o.appendChild(document.createTextNode(""+e)),g.appendChild(o)),e+=j;a.layoutHeight=35;a.background.setAttribute("height",35);a.scale=1;a.browser.arrangeTiers()}}var hexcase=0,b64pad="";function hex_sha1(a){return rstr2hex(rstr_sha1(str2rstr_utf8(a)))}function b64_sha1(a){return rstr2b64(rstr_sha1(str2rstr_utf8(a)))}function any_sha1(a,b){return rstr2any(rstr_sha1(str2rstr_utf8(a)),b)}function hex_hmac_sha1(a,b){return rstr2hex(rstr_hmac_sha1(str2rstr_utf8(a),str2rstr_utf8(b)))}
function b64_hmac_sha1(a,b){return rstr2b64(rstr_hmac_sha1(str2rstr_utf8(a),str2rstr_utf8(b)))}function any_hmac_sha1(a,b,c){return rstr2any(rstr_hmac_sha1(str2rstr_utf8(a),str2rstr_utf8(b)),c)}function sha1_vm_test(){return"a9993e364706816aba3e25717850c26c9cd0d89d"==hex_sha1("abc").toLowerCase()}function rstr_sha1(a){return binb2rstr(binb_sha1(rstr2binb(a),8*a.length))}
function rstr_hmac_sha1(a,b){var c=rstr2binb(a);16<c.length&&(c=binb_sha1(c,8*a.length));for(var e=Array(16),d=Array(16),f=0;16>f;f++)e[f]=c[f]^909522486,d[f]=c[f]^1549556828;c=binb_sha1(e.concat(rstr2binb(b)),512+8*b.length);return binb2rstr(binb_sha1(d.concat(c),672))}function rstr2hex(a){try{hexcase}catch(b){hexcase=0}for(var c=hexcase?"0123456789ABCDEF":"0123456789abcdef",e="",d,f=0;f<a.length;f++)d=a.charCodeAt(f),e+=c.charAt(d>>>4&15)+c.charAt(d&15);return e}
function rstr2b64(a){try{b64pad}catch(b){b64pad=""}for(var c="",e=a.length,d=0;d<e;d+=3)for(var f=a.charCodeAt(d)<<16|(d+1<e?a.charCodeAt(d+1)<<8:0)|(d+2<e?a.charCodeAt(d+2):0),h=0;4>h;h++)c=8*d+6*h>8*a.length?c+b64pad:c+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(f>>>6*(3-h)&63);return c}
function rstr2any(a,b){var c=b.length,e=[],d,f,h,g,j=Array(Math.ceil(a.length/2));for(d=0;d<j.length;d++)j[d]=a.charCodeAt(2*d)<<8|a.charCodeAt(2*d+1);for(;0<j.length;){g=[];for(d=h=0;d<j.length;d++)if(h=(h<<16)+j[d],f=Math.floor(h/c),h-=f*c,0<g.length||0<f)g[g.length]=f;e[e.length]=h;j=g}c="";for(d=e.length-1;0<=d;d--)c+=b.charAt(e[d]);e=Math.ceil(8*a.length/(Math.log(b.length)/Math.log(2)));for(d=c.length;d<e;d++)c=b[0]+c;return c}
function str2rstr_utf8(a){for(var b="",c=-1,e,d;++c<a.length;)e=a.charCodeAt(c),d=c+1<a.length?a.charCodeAt(c+1):0,55296<=e&&(56319>=e&&56320<=d&&57343>=d)&&(e=65536+((e&1023)<<10)+(d&1023),c++),127>=e?b+=String.fromCharCode(e):2047>=e?b+=String.fromCharCode(192|e>>>6&31,128|e&63):65535>=e?b+=String.fromCharCode(224|e>>>12&15,128|e>>>6&63,128|e&63):2097151>=e&&(b+=String.fromCharCode(240|e>>>18&7,128|e>>>12&63,128|e>>>6&63,128|e&63));return b}
function str2rstr_utf16le(a){for(var b="",c=0;c<a.length;c++)b+=String.fromCharCode(a.charCodeAt(c)&255,a.charCodeAt(c)>>>8&255);return b}function str2rstr_utf16be(a){for(var b="",c=0;c<a.length;c++)b+=String.fromCharCode(a.charCodeAt(c)>>>8&255,a.charCodeAt(c)&255);return b}function rstr2binb(a){for(var b=Array(a.length>>2),c=0;c<b.length;c++)b[c]=0;for(c=0;c<8*a.length;c+=8)b[c>>5]|=(a.charCodeAt(c/8)&255)<<24-c%32;return b}
function binb2rstr(a){for(var b="",c=0;c<32*a.length;c+=8)b+=String.fromCharCode(a[c>>5]>>>24-c%32&255);return b}
function binb_sha1(a,b){a[b>>5]|=128<<24-b%32;a[(b+64>>9<<4)+15]=b;for(var c=Array(80),e=1732584193,d=-271733879,f=-1732584194,h=271733878,g=-1009589776,j=0;j<a.length;j+=16){for(var m=e,u=d,s=f,o=h,p=g,r=0;80>r;r++){c[r]=16>r?a[j+r]:bit_rol(c[r-3]^c[r-8]^c[r-14]^c[r-16],1);var w=safe_add(safe_add(bit_rol(e,5),sha1_ft(r,d,f,h)),safe_add(safe_add(g,c[r]),sha1_kt(r))),g=h,h=f,f=bit_rol(d,30),d=e,e=w}e=safe_add(e,m);d=safe_add(d,u);f=safe_add(f,s);h=safe_add(h,o);g=safe_add(g,p)}return[e,d,f,h,g]}
function sha1_ft(a,b,c,e){return 20>a?b&c|~b&e:40>a?b^c^e:60>a?b&c|b&e|c&e:b^c^e}function sha1_kt(a){return 20>a?1518500249:40>a?1859775393:60>a?-1894007588:-899497514}function safe_add(a,b){var c=(a&65535)+(b&65535);return(a>>16)+(b>>16)+(c>>16)<<16|c&65535}function bit_rol(a,b){return a<<b|a>>>32-b}
function DSlider(a,b){b||(b={});this.width=a;this.opts=b;var c=0,e=this,d;this.svg=document.createElementNS(NS_SVG,"g");this.track=document.createElementNS(NS_SVG,"path");this.track.setAttribute("fill","grey");this.track.setAttribute("stroke","grey");this.track.setAttribute("stroke-width","1");this.track.setAttribute("d","M 0 35 L "+a+" 35 L "+a+" 15 L 0 32 Z");this.svg.appendChild(this.track);this.handle=document.createElementNS(NS_SVG,"rect");this.handle.setAttribute("x",-4);this.handle.setAttribute("y",
10);this.handle.setAttribute("width",8);this.handle.setAttribute("height",30);this.handle.setAttribute("stroke","none");this.handle.setAttribute("fill","blue");this.handle.setAttribute("fill-opacity",0.5);this.svg.appendChild(this.handle);this.getValue=function(){return c};this.setValue=function(a){0>a?a=0:a>this.width&&(a=this.width);c=a;this.handle.setAttribute("x",c-4)};this.setColor=function(a){this.handle.setAttribute("fill",a)};this.onchange=null;var f=function(b){b.stopPropagation();b.preventDefault();
b=Math.max(-4,Math.min(b.clientX+d,a-4));e.handle.setAttribute("x",b);c=b+4;if(e.onchange)e.onchange(c,!1)},h=function(a){a.stopPropagation();a.preventDefault();if(e.onchange)e.onchange(c,!0);document.removeEventListener("mousemove",f,!0);document.removeEventListener("mouseup",h,!0)};this.handle.addEventListener("mousedown",function(a){a.stopPropagation();a.preventDefault();d=e.handle.getAttribute("x")-a.clientX;document.addEventListener("mousemove",f,!0);document.addEventListener("mouseup",h,!0)},
!1)}function Range(a,b){this._min=a|0;this._max=b|0}Range.prototype.min=function(){return this._min};Range.prototype.max=function(){return this._max};Range.prototype.contains=function(a){return a>=this._min&&a<=this._max};Range.prototype.isContiguous=function(){return!0};Range.prototype.ranges=function(){return[this]};Range.prototype.toString=function(){return"["+this._min+"-"+this._max+"]"};function _Compound(a){this._ranges=a}_Compound.prototype.min=function(){return this._ranges[0].min()};
_Compound.prototype.max=function(){return this._ranges[this._ranges.length-1].max()};_Compound.prototype.contains=function(a){for(var b=0;b<this._ranges.length;++b)if(this._ranges[b].contains(a))return!0;return!1};_Compound.prototype.isContiguous=function(){return 1<this._ranges.length};_Compound.prototype.ranges=function(){return this._ranges};_Compound.prototype.toString=function(){for(var a="",b=0;b<this._ranges.length;++b)0<b&&(a+=","),a+=this._ranges[b].toString();return a};
function union(a,b){for(var c=a.ranges().concat(b.ranges()).sort(rangeOrder),e=[],d=c[0],f=1;f<c.length;++f){var h=c[f];h.min()>d.max()+1?(e.push(d),d=h):h.max()>d.max()&&(d=new Range(d.min(),h.max()))}e.push(d);return 1==e.length?e[0]:new _Compound(e)}
function intersection(a,b){for(var c=a.ranges(),e=b.ranges(),d=c.length,f=e.length,h=0,g=0,j=[];h<d&&g<f;){var a=c[h],b=e[g],m=Math.max(a.min(),b.min()),u=Math.min(a.max(),b.max());u>=m&&j.push(new Range(m,u));a.max()>b.max()?++g:++h}return 0==j.length?null:1==j.length?j[0]:new _Compound(j)}function coverage(a){for(var b=0,a=a.ranges(),c=0;c<a.length;++c)var e=a[c],b=b+(e.max()-e.min()+1);return b}
function rangeOrder(a,b){return a.min()<b.min()?-1:a.min()>b.min()?1:a.max()<b.max()?-1:b.max()>a.max()?1:0}var __tier_idSeed=0;
function DasTier(a,b,c,e){var d=this;this.id="tier"+ ++__tier_idSeed;this.browser=a;this.dasSource=new DASSource(b);this.viewport=c;this.background=e;this.req=null;this.layoutHeight=25;this.bumped=!0;this.dasSource.collapseSuperGroups&&(this.bumped=!1);this.y=0;this.layoutWasDone=!1;var f,h;this.dasSource.bwgURI||this.dasSource.bwgBlob?(f=new BWGFeatureSource(this.dasSource,{credentials:this.dasSource.credentials,preflight:this.dasSource.preflight,clientBin:this.dasSource.clientBin,forceReduction:this.dasSource.forceReduction}),
!this.dasSource.uri&&!this.dasSource.stylesheet_uri&&f.bwgHolder.await(function(a){if(!a){d.stylesheet=new DASStylesheet;return d.browser.refreshTier(d)}if(d.dasSource.collapseSuperGroups===void 0&&a.definedFieldCount==12&&a.fieldCount>=14){d.dasSource.collapseSuperGroups=true;d.bumped=false;d.isLabelValid=false}if(a.type=="bigbed"){d.stylesheet=new DASStylesheet;a=new DASStyle;a.glyph="BOX";a.FGCOLOR="black";a.BGCOLOR="blue";a.HEIGHT=8;a.BUMP=true;a.LABEL=true;a.ZINDEX=20;d.stylesheet.pushStyle({type:"bigwig"},
null,a);a.glyph="BOX";a.FGCOLOR="black";a.BGCOLOR="red";a.HEIGHT=10;a.BUMP=true;a.LABEL=true;a.ZINDEX=20;d.stylesheet.pushStyle({type:"bb-translation"},null,a);var b=new DASStyle;b.glyph="BOX";b.FGCOLOR="black";b.BGCOLOR="white";a.HEIGHT=10;b.ZINDEX=10;b.BUMP=true;d.stylesheet.pushStyle({type:"bb-transcript"},null,b);a=new DASStyle;a.glyph="HISTOGRAM";a.COLOR1="white";a.COLOR2="black";a.HEIGHT=30;d.stylesheet.pushStyle({type:"density"},null,a)}else{d.stylesheet=new DASStylesheet;a=new DASStyle;a.glyph=
"HISTOGRAM";a.COLOR1="white";a.COLOR2="black";a.HEIGHT=30;d.stylesheet.pushStyle({type:"default"},null,a)}d.browser.refreshTier(d)})):this.dasSource.bamURI||this.dasSource.bamBlob?(f=new BAMFeatureSource(this.dasSource,{credentials:this.dasSource.credentials}),!this.dasSource.uri&&!this.dasSource.stylesheet_uri&&f.bamHolder.await(function(){d.stylesheet=new DASStylesheet;var a=new DASStyle;a.glyph="HISTOGRAM";a.COLOR1="black";a.COLOR2="red";a.HEIGHT=30;d.stylesheet.pushStyle({type:"density"},"low",
a);d.stylesheet.pushStyle({type:"density"},"medium",a);a=new DASStyle;a.glyph="BOX";a.FGCOLOR="black";a.BGCOLOR="blue";a.HEIGHT=8;a.BUMP=true;a.LABEL=false;a.ZINDEX=20;d.stylesheet.pushStyle({type:"bam"},"high",a);d.browser.refreshTier(d)})):"sequence"==this.dasSource.tier_type?h=this.dasSource.twoBitURI?new TwoBitSequenceSource(this.dasSource):new DASSequenceSource(this.dasSource):f=new DASFeatureSource(this.dasSource);this.dasSource.mapping&&(f=new MappedFeatureSource(f,this.browser.chains[this.dasSource.mapping]));
this.featureSource=f;this.sequenceSource=h;this.setBackground()}DasTier.prototype.toString=function(){return this.id};
DasTier.prototype.init=function(){var a=this;if(a.dasSource.uri||a.dasSource.stylesheet_uri)a.status="Fetching stylesheet",this.dasSource.stylesheet(function(b){a.stylesheet=b;a.browser.refreshTier(a)},function(){a.stylesheet=new DASStylesheet;var b=new DASStyle;b.glyph="BOX";b.BGCOLOR="blue";b.FGCOLOR="black";a.stylesheet.pushStyle({type:"default"},null,b);a.browser.refreshTier(a)});else if(a.dasSource.twoBitURI){a.stylesheet=new DASStylesheet;var b=new DASStyle;b.glyph="BOX";b.BGCOLOR="blue";b.FGCOLOR=
"black";a.stylesheet.pushStyle({type:"default"},null,b);a.browser.refreshTier(a)}};DasTier.prototype.styles=function(){return null==this.stylesheet?null:0.2<this.browser.scale?this.stylesheet.highZoomStyles:0.01<this.browser.scale?this.stylesheet.mediumZoomStyles:this.stylesheet.lowZoomStyles};DasTier.prototype.getSource=function(){return this.featureSource};
DasTier.prototype.getDesiredTypes=function(){var a=[],b=!1,c=zoomForScale(this.browser.scale);if(this.stylesheet){for(var e=this.stylesheet.styles,d=0;d<e.length;++d){var f=e[d];if(!f.zoom||f.zoom==c)if(!f.type||"default"==f.type){b=!0;break}else pushnew(a,f.type)}return b?null:a}};DasTier.prototype.needsSequence=function(a){return"sequence"===this.dasSource.tier_type&&5>a||(this.dasSource.bamURI||this.dasSource.bamBlob)&&20>a?!0:!1};DasTier.prototype.setStatus=function(a){dlog(a)};
DasTier.prototype.viewFeatures=function(a,b,c,e,d,f){this.currentFeatures=d;this.currentSequence=f;this.knownChr=a;this.knownStart=b;this.knownEnd=c;this.error=this.status=null;this.setBackground();this.draw()};DasTier.prototype.updateStatus=function(a){a&&(this.currentFeatures=[],this.currentSequence=null,this.error=a);this.setBackground();this.draw()};
DasTier.prototype.draw=function(){var a=this.currentSequence;"sequence"===this.dasSource.tier_type?drawSeqTier(this,a):drawFeatureTier(this);this.originHaxx=0;this.browser.arrangeTiers()};function zoomForScale(a){return 0.2<a?"high":0.01<a?"medium":"low"}DasTier.prototype.setBackground=function(){var a=this.knownEnd||-100000001;this.background.setAttribute("x",((this.knownStart||-1E8)-this.browser.origin)*this.browser.scale);this.background.setAttribute("width",(a-this.knownStart+1)*this.browser.scale)};
Browser.prototype.currentlyActive=function(a){for(var b=0;b<this.tiers.length;++b){var c=this.tiers[b].dasSource;if(c.uri==a.uri||c.uri==a.uri+"/")if(!c.tier_type||a.tier_type&&a.tier_type==c.tier_type)if(!c.stylesheet_uri||a.stylesheet_uri&&a.stylesheet_uri==c.stylesheet_uri)return!0}return!1};
Browser.prototype.makeButton=function(a,b){var c=makeElement("span",a);c.style.backgroundColor="rgb(230,230,250)";c.style.borderStyle="solid";c.style.borderColor="red";c.style.borderWidth="3px";c.style.padding="4px";c.style.marginLeft="10px";c.style.marginRight="10px";c.style["float"]="left";b&&this.makeTooltip(c,b);return c};function activateButton(a,b){for(var c=0;c<a.length;++c){var e=a[c];e.style.borderColor=e==b?"red":"blue"}}
Browser.prototype.showTrackAdder=function(a){function b(){A="bin";H.style.visibility="hidden";removeChildren(B);g.supportsBinary?(B.appendChild(makeElement("h2","Add custom URL-based data")),B.appendChild(makeElement("p",["You can add indexed binary data hosted on an web server that supports CORS (",makeElement("a","full details",{href:"http://www.biodalliance.org/bin.html"}),").  Currently supported formats are bigwig, bigbed, and indexed BAM."])),B.appendChild(makeElement("br")),B.appendChild(document.createTextNode("URL: ")),
q=makeElement("input","",{size:80,value:"http://www.biodalliance.org/datasets/ensGene.bb"}),B.appendChild(q),q.focus(),B.appendChild(makeElement("br")),B.appendChild(makeElement("b","- or -")),B.appendChild(makeElement("br")),B.appendChild(document.createTextNode("File: ")),E=makeElement("input",null,{type:"file"}),B.appendChild(E),B.appendChild(makeElement("p",'Clicking the "Add" button below will initiate a series of test queries.'))):(B.appendChild(makeElement("h2","Your browser does not support binary data")),
B.appendChild(makeElement("p","Browsers currently known to support this feature include Google Chrome 9 or later and Mozilla Firefox 4 or later.")))}function c(){if(A)if("das"===A){var a=q.value.trim();/^.+:\/\//.exec(a)||(a="http://"+a);a=new DASSource({name:"temporary",uri:a});da(a)}else if("bin"===A){var c={name:"temporary"};(a=E.files)&&0<a.length&&a[0]?(c.bwgBlob=a[0],c.noPersist=!0):(a=q.value.trim(),/^.+:\/\//.exec(a)||(a="http://"+a),c.bwgURI=a);a=new DASSource(c);ea(a)}else"reset"===A?ia():
"reset-bin"===A?b():"prompt-bai"===A?(a=E.files)&&0<a.length&&a[0]?(G.baiBlob=a[0],f(G)):d(G):"finalize"===A&&(G.name=z.value,c=x.value,G.mapping="__default__"!=c?c:void 0,C&&(G.maxbins=C.checked),g.sources.push(G),g.makeTier(G),g.storeStatus(),g.removeAllPopups());else{for(c=0;c<t.length;++c)a=t[c],a.checked&&(a=a.dalliance_source,g.sources.push(a),g.makeTier(a),g.storeStatus());g.removeAllPopups()}}function e(a,b){var c=a.uri;if(b){var d=/(.+)\/[^\/]+\/?/.exec(c);d&&(c=d[1]+"/sources")}(new DASRegistry(c,
{credentials:a.credentials})).sources(function(c){if(!c||0==c.length)return b?R(a):e(a,!0);var d=null;if(1==c.length)d=c[0];else for(var f=0;f<c.length;++f)if(c[f].uri===a.uri){d=c[f];break}f=c=!1;if(d&&(a.name=d.name,a.desc=d.desc,a.maxbins=d.maxbins?!0:!1,f=!0,d.coords&&1==d.coords.length))if(d=d.coords[0],coordsMatch(d,g.coordSystem))c=!0;else if(g.chains)for(var h in g.chains)coordsMatch(d,g.chains[h].coords)&&(a.mapping=h,c=!0);return R(a,c,f)},function(){return b?R(a):e(a,!0)})}function d(a){removeChildren(B);
A="prompt-bai";B.appendChild(makeElement("h2","Select an index file"));B.appendChild(makeElement("p","Dalliance requires a BAM index (.bai) file when displaying BAM data.  These normally accompany BAM files.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate BAI file"));B.appendChild(document.createTextNode("Index file: "));E=makeElement("input",null,{type:"file"});B.appendChild(E);
G=a}function f(a){(a.baiBlob?new BlobFetchable(a.baiBlob):new URLFetchable(a.bwgURI+".bai")).slice(0,256).fetch(function(b){var c=!1;b&&(b=new Uint8Array(b),c=readInt(b,0)==BAI_MAGIC);if(c){if(b=/\/?([^/]+?)(.bam)?$/.exec(a.bwgURI||a.bwgBlob.name))a.name=b[1];a.bamURI=a.bwgURI;a.bamBlob=a.bwgBlob;a.bwgURI=void 0;a.bwgBlob=void 0;return R(a,!1,!1,!0)}return h("You have selected a valid BAM file, but a corresponding index (.bai) file was not found.  Please index your BAM (samtools index) and place the BAI file in the same directory")})}
function h(a){removeChildren(B);a=a||"Custom data format not recognized";B.appendChild(makeElement("h2","Error adding custom data"));B.appendChild(makeElement("p",a));B.appendChild(makeElement("p","Currently supported formats are bigBed, bigWig, and BAM."));A="reset-bin"}var g=this,j=document.createElement("div");j.appendChild(makeElement("div",null,{},{clear:"both",height:"10px"}));var m=[],u,s,o=this.makeButton("Registry","Browse compatible datasources from the DAS registry");m.push(o);for(var p in this.mappableSources)(function(a){var b=
g.makeButton(g.chains[a].srcTag,"Browse datasources mapped from "+g.chains[a].srcTag);m.push(b);b.addEventListener("mousedown",function(c){c.preventDefault();c.stopPropagation();activateButton(m,b);u(g.mappableSources[a],a)},!1)})(p);var r=this.makeButton("Defaults","Browse the default set of data for this browser");m.push(r);var w=this.makeButton("Custom","Add arbitrary DAS data");m.push(w);var v=this.makeButton("Binary","Add data in bigwig or bigbed format");m.push(v);activateButton(m,o);j.appendChild(makeElement("div",
m),null);j.appendChild(makeElement("div",null,{},{clear:"both",height:"10px"}));var t=[],q,z,x,C,E,A=!1,G=null;p=makeElement("form",null,{},{clear:"both"});p.addEventListener("submit",function(a){a.stopPropagation();a.preventDefault();c();return!1},!0);var B=document.createElement("div");B.style.position="relative";B.style.overflow="auto";B.style.height="400px";p.appendChild(B);var y,X;u=function(a,b){H.style.visibility="visible";X&&X.removeListener(s);y=b;X=a;X.addListenerAndFire(s)};s=function(a){A=
!1;t=[];removeChildren(B);if(a){var b=document.createElement("table");b.style.width="100%";for(var c=0,d=[],e=0;e<a.length;++e)d.push(a[e]);d.sort(function(a,b){return a.name.toLowerCase().trim().localeCompare(b.name.toLowerCase().trim())});for(e=0;e<d.length;++e){var a=d[e],f=document.createElement("tr");f.style.backgroundColor=g.tierBackgroundColors[c%g.tierBackgroundColors.length];var h=document.createElement("td");h.style.textAlign="center";if(g.currentlyActive(a))h.appendChild(document.createTextNode("X")),
g.makeTooltip(h,"This data source is already active.");else if(!a.props||a.props.cors){var i=document.createElement("input");i.type="checkbox";i.dalliance_source=a;y&&(i.dalliance_mapping=y);h.appendChild(i);t.push(i);g.makeTooltip(h,"Check here then click 'Add' to activate.")}else h.appendChild(document.createTextNode("!")),g.makeTooltip(h,makeElement("span",["This data source isn't accessible because it doesn't support ",makeElement("a","CORS",{href:"http://www.w3.org/TR/cors/"}),"."]));f.appendChild(h);
h=document.createElement("td");h.appendChild(document.createTextNode(a.name));a.desc&&0<a.desc.length&&g.makeTooltip(h,a.desc);f.appendChild(h);b.appendChild(f);++c}B.appendChild(b)}else B.appendChild(makeElement("p","Dalliance was unable to retrieve data source information from the DAS registry, please try again later"))};o.addEventListener("mousedown",function(a){a.preventDefault();a.stopPropagation();activateButton(m,o);u(g.availableSources)},!1);r.addEventListener("mousedown",function(a){a.preventDefault();
a.stopPropagation();activateButton(m,r);u(new Observed(g.defaultSources))},!1);v.addEventListener("mousedown",function(a){a.preventDefault();a.stopPropagation();activateButton(m,v);b()},!1);w.addEventListener("mousedown",function(a){a.preventDefault();a.stopPropagation();activateButton(m,w);ia()},!1);var ia=function(){A="das";H.style.visibility="hidden";removeChildren(B);var a=makeElement("div");a.appendChild(makeElement("h2","Add custom DAS data"));a.appendChild(makeElement("p","This interface is intended for adding custom or lab-specific data.  Public data can be added more easily via the registry interface."));
a.appendChild(document.createTextNode("URL: "));a.appendChild(makeElement("br"));q=makeElement("input","",{size:80,value:"http://www.derkholm.net:8080/das/medipseq_reads/"});a.appendChild(q);a.appendChild(makeElement("p",'Clicking the "Add" button below will initiate a series of test queries.  If the source is password-protected, you may be prompted to enter credentials.'));B.appendChild(a);q.focus()},i=document.createElement("span");i.style.backgroundColor="rgb(230,230,250)";i.style.borderStyle=
"solid";i.style.borderColor="blue";i.style.borderWidth="3px";i.style.padding="2px";i.style.margin="10px";i.style.width="150px";i.appendChild(document.createTextNode("Add"));i.addEventListener("mousedown",function(a){a.stopPropagation();a.preventDefault();c()},!1);var da=function(a,b){var c=g.knownSpace;if(c){var d=Math.max(c.min,(c.min+c.max-100)/2)|0,c=new DASSegment(c.chr,d,Math.min(d+99,c.max));a.features(c,{},function(c,d){if(d)b?(removeChildren(B),B.appendChild(makeElement("h2","Custom data not found")),
B.appendChild(makeElement("p","DAS uri: "+a.uri+" is not answering features requests")),A="reset"):(dlog("retrying with credentials"),a.credentials=!0,da(a,!0));else{var f=/\/([^/]+)\/?$/.exec(a.uri);f&&(a.name=f[1]);e(a)}})}else alert("Can't confirm track-addition to an uninit browser.")},ea=function(a){(a.bwgURI?new URLFetchable(a.bwgURI):new BlobFetchable(a.bwgBlob)).slice(0,65536).fetch(function(b,c){if(b){var e=new Uint8Array(b),g=readInt(e,0);if(g==BIG_WIG_MAGIC||g==BIG_BED_MAGIC){if(e=/\/?([^/]+?)(.bw|.bb|.bigWig|.bigBed)?$/.exec(a.bwgURI||
a.bwgBlob.name))a.name=e[1];return R(a,!1,!1,!0)}if(31!=e[0]||139!=e[1])return h();e=unbgzf(b);e=new Uint8Array(e);g=readInt(e,0);return g==BAM_MAGIC?a.bwgBlob?d(a):f(a):h()}removeChildren(B);B.appendChild(makeElement("h2","Custom data not found"));a.bwgURI?B.appendChild(makeElement("p","Data URI: "+a.bwgURI+" is not accessible.")):B.appendChild(makeElement("p","File access failed, are you using an up-to-date browser?"));c&&B.appendChild(makeElement("p",""+c));B.appendChild(makeElement("p","If in doubt, please check that the server where the file is hosted supports CORS."));
A="reset-bin"})},R=function(a,b,c,d){removeChildren(B);B.appendChild(makeElement("h2","Add custom data: step 2"));B.appendChild(document.createTextNode("Label: "));z=makeElement("input","",{value:a.name});B.appendChild(z);B.appendChild(makeElement("br"));B.appendChild(makeElement("br"));B.appendChild(makeElement("h4","Coordinate system: "));x=makeElement("select",null);x.appendChild(makeElement("option",g.coordSystem.auth+g.coordSystem.version,{value:"__default__"}));if(g.chains)for(var e in g.chains){var f=
g.chains[e].coords;x.appendChild(makeElement("option",f.auth+f.version,{value:e}))}x.value=a.mapping||"__default__";B.appendChild(x);b?B.appendChild(makeElement("p","(Based on server response, probably doesn't need changing.)")):(B.appendChild(makeElement("p",[makeElement("b","Warning: "),"unable to determine the correct value from server responses.  Please check carefully."])),B.appendChild(makeElement("p","If you don't see the mapping you're looking for, please contact thomas@biodalliance.org")));
d||(B.appendChild(document.createTextNode("Quantitative: ")),C=makeElement("input",null,{type:"checkbox",checked:!0}),"undefined"!==typeof a.maxbins&&(C.checked=a.maxbins),B.appendChild(C),c?B.appendChild(makeElement("p","(Based on server response, probably doesn't need changing.)")):B.appendChild(makeElement("p",[makeElement("b","Warning: "),"unable to determine correct value.  If in doubt, leave checked."])));a.bwgBlob&&B.appendChild(makeElement("p",[makeElement("b","Warning: "),"data added from local file.  Due to the browser security model, the track will disappear if you reload Dalliance."]));
z.focus();A="finalize";G=a},M=document.createElement("span");M.style.backgroundColor="rgb(230,230,250)";M.style.borderStyle="solid";M.style.borderColor="blue";M.style.borderWidth="3px";M.style.padding="2px";M.style.margin="10px";M.style.width="150px";M.appendChild(document.createTextNode("Cancel"));M.addEventListener("mousedown",function(a){a.stopPropagation();a.preventDefault();g.removeAllPopups()},!1);var H=makeElement("span","Refresh");H.style.backgroundColor="rgb(230,230,250)";H.style.borderStyle=
"solid";H.style.borderColor="blue";H.style.borderWidth="3px";H.style.padding="2px";H.style.margin="10px";H.style.width="120px";H.addEventListener("mousedown",function(a){a.stopPropagation();a.preventDefault();g.queryRegistry(y)},!1);this.makeTooltip(H,"Click to re-fetch data from the DAS registry");i=makeElement("div",[i,M,H]);i.style.margin="10px";p.appendChild(i);j.appendChild(p);u(g.availableSources);return this.popit(a,"Add DAS data",j,{width:600})};var TWOBIT_MAGIC=440477507;
function TwoBitFile(){}
function makeTwoBit(a,b){var c=new TwoBitFile;c.data=a;c.data.slice(0,1024).fetch(function(a){if(!a)return b(null,"Couldn't access data");a=new Uint8Array(a);if(readInt(a,0)!=TWOBIT_MAGIC)return b(null,"Not a .2bit fie");var d=readInt(a,4);if(0!=d)return b(null,"Unsupported version "+d);c.seqCount=readInt(a,8);c.seqDict={};for(var d=16,f=0;f<c.seqCount;++f){for(var h=a[d++],g="",j=1;j<=h;++j)g+=String.fromCharCode(a[d++]);h=readInt(a,d);d+=4;c.seqDict[g]=new TwoBitSeq(c,h)}return b(c)})}
TwoBitFile.prototype.getSeq=function(a){var b=this.seqDict[a];b||(b=this.seqDict["chr"+a]);return b};TwoBitFile.prototype.fetch=function(a,b,c,e){var d=this.getSeq(a);if(d)d.fetch(b,c,e);else return e(null,"Couldn't find "+a)};function TwoBitSeq(a,b){this.tbf=a;this.offset=b}
TwoBitSeq.prototype.init=function(a){if(this.seqOffset)return a();var b=this;b.tbf.data.slice(b.offset,8).fetch(function(c){if(!c)return a("Fetch failed");c=new Uint8Array(c);b.length=readInt(c,0);b.nBlockCnt=readInt(c,4);b.tbf.data.slice(b.offset+8,8*b.nBlockCnt+4).fetch(function(c){if(!c)return a("Fetch failed");for(var c=new Uint8Array(c),d=null,f=0;f<b.nBlockCnt;++f)var h=readInt(c,4*f),g=readInt(c,4*(f+b.nBlockCnt)),h=new Range(h,h+g-1),d=d?union(d,h):h;b.nBlocks=d;b.mBlockCnt=readInt(c,8*b.nBlockCnt);
b.seqLength=(b.length+3)/4|0;b.seqOffset=b.offset+16+8*(b.nBlockCnt+b.mBlockCnt);return a()})})};var TWOBIT_TABLE=["T","C","A","G"];
TwoBitSeq.prototype.fetch=function(a,b,c){--a;--b;var e=this;this.init(function(d){if(d)return c(null,d);var f=a>>2,d=b+3>>2;if(0>f||d>e.seqLength)return c("Coordinates out of bounds: "+a+":"+b);e.tbf.data.slice(e.seqOffset+f,d-f).fetch(function(d){function g(a){for(;s<=a;){var b=s&3,c=j[(s>>2)-f];u+=TWOBIT_TABLE[0==b?c>>6&3:1==b?c>>4&3:2==b?c>>2&3:c&3];++s}}if(null==d)return c("SeqFetch failed");var j=new Uint8Array(d),d=[];if(e.nBlocks){var m=intersection(new Range(a,b),e.nBlocks);m&&(d=m.ranges())}for(var u=
"",s=a,m=0;m<d.length;++m){var o=d[m];if(s>o.min())throw"N mismatch...";for(s<o.min()&&g(o.min()-1);s<o.max();)u+="N",++s}s<b&&g(b);return c(u)})})};TwoBitSeq.prototype.length=function(a){var b=this;this.init(function(c){return c?a(null,c):a(b.length)})};var NUM_REGEXP=/[0-9]+/;function stringToNumbersArray(a){for(var b=[],c;c=NUM_REGEXP.exec(a);)b.push(c[0]),a=a.substring(c.index+c[0].length);return b}var STRICT_NUM_REGEXP=/^[0-9]+$/;
function stringToInt(a){a=a.replace(RegExp(",","g"),"");return!STRICT_NUM_REGEXP.test(a)?(alert("Don't understand '"+a+"'"),null):a|0}function pushnew(a,b){for(var c=0;c<a.length;++c)if(a[c]==b)return;a.push(b)}function pusho(a,b,c){a[b]?a[b].push(c):a[b]=[c]}function pushnewo(a,b,c){var e=a[b];if(e){for(a=0;a<e.length;++a)if(e[a]==c)return;e.push(c)}else a[b]=[c]}function pick(a,b,c,e){if(a)return a;if(b)return b;if(c)return c;if(e)return e}
function pushnew(a,b){for(var c=0;c<a.length;++c)if(a[c]==b)return;a.push(b)}function maybeConcat(a,b){var c=[];if(a)for(var e=0;e<a.length;++e)pushnew(c,a[e]);if(b)for(e=0;e<b.length;++e)pushnew(c,b[e]);return c}function arrayIndexOf(a,b){if(!a)return-1;for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}function arrayRemove(a,b){var c=arrayIndexOf(a,b);return 0<=c?(a.splice(c,1),!0):!1}
function makeElement(a,b,c,e){a=document.createElement(a);if(b){b instanceof Array||(b=[b]);for(var d=0;d<b.length;++d){var f=b[d];"string"==typeof f&&(f=document.createTextNode(f));a.appendChild(f)}}if(c)for(var h in c)a[h]=c[h];if(e)for(h in e)a.style[h]=e[h];return a}function makeElementNS(a,b,c,e){a=document.createElementNS(a,b);if(c){c instanceof Array||(c=[c]);for(b=0;b<c.length;++b){var d=c[b];"string"==typeof d&&(d=document.createTextNode(d));a.appendChild(d)}}setAttrs(a,e);return a}
var attr_name_cache={};function setAttr(a,b,c){var e=attr_name_cache[b];if(!e){for(var e="",d=0;d<b.length;++d)var f=b.substring(d,d+1),h=f.toLowerCase(),e=h!=f?e+"-"+h:e+f;attr_name_cache[b]=e}a.setAttribute(e,c)}function setAttrs(a,b){if(b)for(var c in b)setAttr(a,c,b[c])}function removeChildren(a){if(a&&a.childNodes)for(;0<a.childNodes.length;)a.removeChild(a.firstChild)}
function miniJSONify(a){if("undefined"===typeof a)return"undefined";if(null==a)return"null";if("string"==typeof a)return"'"+a+"'";if("number"==typeof a||"boolean"==typeof a)return""+a;if("object"==typeof a){if(a instanceof Array){for(var b=null,c=0;c<a.length;++c)b=(null==b?"":b+", ")+miniJSONify(a[c]);return"["+(b?b:"")+"]"}b=null;for(c in a)void 0!=c&&"function"!=typeof a[c]&&(b=(null==b?"":b+", ")+c+": "+miniJSONify(a[c]));return"{"+(b?b:"")+"}"}return typeof a}
function shallowCopy(a){n={};for(k in a)n[k]=a[k];return n}function Observed(a){this.value=a;this.listeners=[]}Observed.prototype.addListener=function(a){this.listeners.push(a)};Observed.prototype.addListenerAndFire=function(a){this.listeners.push(a);a(this.value)};Observed.prototype.removeListener=function(a){arrayRemove(this.listeners,a)};Observed.prototype.get=function(){return this.value};Observed.prototype.set=function(a){this.value=a;for(var b=0;b<this.listeners.length;++b)this.listeners[b](a)};
function Awaited(){this.queue=[]}Awaited.prototype.provide=function(a){if(this.res)throw"Resource has already been provided.";this.res=a;for(var b=0;b<this.queue.length;++b)this.queue[b](a)};Awaited.prototype.await=function(a){if(this.res)return a(this.res),this.res;this.queue.push(a)};"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")});
var VERSION={CONFIG:3,MAJOR:0,MINOR:6,MICRO:5,PATCH:"",BRANCH:"",toString:function(){var a=""+this.MAJOR+"."+this.MINOR+"."+this.MICRO;this.PATCH&&(a=a+this.PATCH);this.BRANCH&&this.BRANCH!=""&&(a=a+"-"+this.BRANCH);return a}},JSON;JSON||(JSON={});
(function(){function a(a){return a<10?"0"+a:a}function b(a){d.lastIndex=0;return d.test(a)?'"'+a.replace(d,function(a){var b=g[a];return typeof b==="string"?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function c(a,d){var e,g,p,r,w=f,v,t=d[a];t&&(typeof t==="object"&&typeof t.toJSON==="function")&&(t=t.toJSON(a));typeof j==="function"&&(t=j.call(d,a,t));switch(typeof t){case "string":return b(t);case "number":return isFinite(t)?""+t:"null";case "boolean":case "null":return""+
t;case "object":if(!t)return"null";f=f+h;v=[];if(Object.prototype.toString.apply(t)==="[object Array]"){r=t.length;for(e=0;e<r;e=e+1)v[e]=c(e,t)||"null";p=v.length===0?"[]":f?"[\n"+f+v.join(",\n"+f)+"\n"+w+"]":"["+v.join(",")+"]";f=w;return p}if(j&&typeof j==="object"){r=j.length;for(e=0;e<r;e=e+1){g=j[e];if(typeof g==="string")(p=c(g,t))&&v.push(b(g)+(f?": ":":")+p)}}else for(g in t)if(Object.hasOwnProperty.call(t,g))(p=c(g,t))&&v.push(b(g)+(f?": ":":")+p);p=v.length===0?"{}":f?"{\n"+f+v.join(",\n"+
f)+"\n"+w+"}":"{"+v.join(",")+"}";f=w;return p}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var e=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
d=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,f,h,g={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},j;if(typeof JSON.stringify!=="function")JSON.stringify=function(a,b,d){var e;h=f="";if(typeof d==="number")for(e=0;e<d;e=e+1)h=h+" ";else typeof d==="string"&&(h=d);if((j=b)&&typeof b!=="function"&&(typeof b!=="object"||typeof b.length!=="number"))throw Error("JSON.stringify");return c("",
{"":a})};if(typeof JSON.parse!=="function")JSON.parse=function(a,b){function c(a,d){var e,f,g=a[d];if(g&&typeof g==="object")for(e in g)if(Object.hasOwnProperty.call(g,e)){f=c(g,e);f!==void 0?g[e]=f:delete g[e]}return b.call(a,d,g)}var d,a=""+a;e.lastIndex=0;e.test(a)&&(a=a.replace(e,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){d=eval("("+a+")");return typeof b==="function"?c({"":d},""):d}throw new SyntaxError("JSON.parse");}})();
var MAX_WBITS=15,DEF_WBITS=MAX_WBITS,MAX_MEM_LEVEL=9,MANY=1440,BMAX=15,PRESET_DICT=32,Z_NO_FLUSH=0,Z_PARTIAL_FLUSH=1,Z_SYNC_FLUSH=2,Z_FULL_FLUSH=3,Z_FINISH=4,Z_DEFLATED=8,Z_OK=0,Z_STREAM_END=1,Z_NEED_DICT=2,Z_ERRNO=-1,Z_STREAM_ERROR=-2,Z_DATA_ERROR=-3,Z_MEM_ERROR=-4,Z_BUF_ERROR=-5,Z_VERSION_ERROR=-6,METHOD=0,FLAG=1,DICT4=2,DICT3=3,DICT2=4,DICT1=5,DICT0=6,BLOCKS=7,CHECK4=8,CHECK3=9,CHECK2=10,CHECK1=11,DONE=12,BAD=13,inflate_mask=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],
IB_TYPE=0,IB_LENS=1,IB_STORED=2,IB_TABLE=3,IB_BTREE=4,IB_DTREE=5,IB_CODES=6,IB_DRY=7,IB_DONE=8,IB_BAD=9,fixed_bl=9,fixed_bd=5,fixed_tl=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,
7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,
9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,
125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,
82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,
8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,
0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,
9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],fixed_td=[80,
5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],cplens=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],cplext=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],cpdist=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,
129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],cpdext=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];function ZStream(){}ZStream.prototype.inflateInit=function(a,b){a||(a=DEF_WBITS);b&&(b=false);this.istate=new Inflate;return this.istate.inflateInit(this,b?-a:a)};ZStream.prototype.inflate=function(a){return this.istate==null?Z_STREAM_ERROR:this.istate.inflate(this,a)};
ZStream.prototype.inflateEnd=function(){if(this.istate==null)return Z_STREAM_ERROR;var a=istate.inflateEnd(this);this.istate=null;return a};ZStream.prototype.inflateSync=function(){return istate.inflateSync(this)};ZStream.prototype.inflateSetDictionary=function(a,b){return istate.inflateSetDictionary(this,a,b)};function Inflate(){this.was=[0]}
Inflate.prototype.inflateReset=function(a){if(a==null||a.istate==null)return Z_STREAM_ERROR;a.total_in=a.total_out=0;a.msg=null;a.istate.mode=a.istate.nowrap!=0?BLOCKS:METHOD;a.istate.blocks.reset(a,null);return Z_OK};Inflate.prototype.inflateEnd=function(a){this.blocks!=null&&this.blocks.free(a);this.blocks=null;return Z_OK};
Inflate.prototype.inflateInit=function(a,b){this.blocks=a.msg=null;nowrap=0;if(b<0){b=-b;nowrap=1}if(b<8||b>15){this.inflateEnd(a);return Z_STREAM_ERROR}this.wbits=b;a.istate.blocks=new InfBlocks(a,a.istate.nowrap!=0?null:this,1<<b);this.inflateReset(a);return Z_OK};
Inflate.prototype.inflate=function(a,b){var c,e;if(a==null||a.istate==null||a.next_in==null)return Z_STREAM_ERROR;b=b==Z_FINISH?Z_BUF_ERROR:Z_OK;for(c=Z_BUF_ERROR;;)switch(a.istate.mode){case METHOD:if(a.avail_in==0)return c;c=b;a.avail_in--;a.total_in++;if(((a.istate.method=a.next_in[a.next_in_index++])&15)!=Z_DEFLATED){a.istate.mode=BAD;a.msg="unknown compression method";a.istate.marker=5;break}if((a.istate.method>>4)+8>a.istate.wbits){a.istate.mode=BAD;a.msg="invalid window size";a.istate.marker=
5;break}a.istate.mode=FLAG;case FLAG:if(a.avail_in==0)return c;c=b;a.avail_in--;a.total_in++;e=a.next_in[a.next_in_index++]&255;if(((a.istate.method<<8)+e)%31!=0){a.istate.mode=BAD;a.msg="incorrect header check";a.istate.marker=5;break}if((e&PRESET_DICT)==0){a.istate.mode=BLOCKS;break}a.istate.mode=DICT4;case DICT4:if(a.avail_in==0)return c;c=b;a.avail_in--;a.total_in++;a.istate.need=(a.next_in[a.next_in_index++]&255)<<24&4278190080;a.istate.mode=DICT3;case DICT3:if(a.avail_in==0)return c;c=b;a.avail_in--;
a.total_in++;a.istate.need=a.istate.need+((a.next_in[a.next_in_index++]&255)<<16&16711680);a.istate.mode=DICT2;case DICT2:if(a.avail_in==0)return c;c=b;a.avail_in--;a.total_in++;a.istate.need=a.istate.need+((a.next_in[a.next_in_index++]&255)<<8&65280);a.istate.mode=DICT1;case DICT1:if(a.avail_in==0)return c;a.avail_in--;a.total_in++;a.istate.need=a.istate.need+(a.next_in[a.next_in_index++]&255);a.adler=a.istate.need;a.istate.mode=DICT0;return Z_NEED_DICT;case DICT0:a.istate.mode=BAD;a.msg="need dictionary";
a.istate.marker=0;return Z_STREAM_ERROR;case BLOCKS:c=a.istate.blocks.proc(a,c);if(c==Z_DATA_ERROR){a.istate.mode=BAD;a.istate.marker=0;break}c==Z_OK&&(c=b);if(c!=Z_STREAM_END)return c;c=b;a.istate.blocks.reset(a,a.istate.was);if(a.istate.nowrap!=0){a.istate.mode=DONE;break}a.istate.mode=CHECK4;case CHECK4:if(a.avail_in==0)return c;c=b;a.avail_in--;a.total_in++;a.istate.need=(a.next_in[a.next_in_index++]&255)<<24&4278190080;a.istate.mode=CHECK3;case CHECK3:if(a.avail_in==0)return c;c=b;a.avail_in--;
a.total_in++;a.istate.need=a.istate.need+((a.next_in[a.next_in_index++]&255)<<16&16711680);a.istate.mode=CHECK2;case CHECK2:if(a.avail_in==0)return c;c=b;a.avail_in--;a.total_in++;a.istate.need=a.istate.need+((a.next_in[a.next_in_index++]&255)<<8&65280);a.istate.mode=CHECK1;case CHECK1:if(a.avail_in==0)return c;c=b;a.avail_in--;a.total_in++;a.istate.need=a.istate.need+(a.next_in[a.next_in_index++]&255);if(a.istate.was[0]!=a.istate.need){a.istate.mode=BAD;a.msg="incorrect data check";a.istate.marker=
5;break}a.istate.mode=DONE;case DONE:return Z_STREAM_END;case BAD:return Z_DATA_ERROR;default:return Z_STREAM_ERROR}};Inflate.prototype.inflateSetDictionary=function(a,b,c){var e=0,d=c;if(a==null||a.istate==null||a.istate.mode!=DICT0)return Z_STREAM_ERROR;if(a._adler.adler32(1,b,0,c)!=a.adler)return Z_DATA_ERROR;a.adler=a._adler.adler32(0,null,0,0);if(d>=1<<a.istate.wbits){d=(1<<a.istate.wbits)-1;e=c-d}a.istate.blocks.set_dictionary(b,e,d);a.istate.mode=BLOCKS;return Z_OK};var mark=[0,0,255,255];
Inflate.prototype.inflateSync=function(a){var b,c,e;if(a==null||a.istate==null)return Z_STREAM_ERROR;if(a.istate.mode!=BAD){a.istate.mode=BAD;a.istate.marker=0}if((b=a.avail_in)==0)return Z_BUF_ERROR;c=a.next_in_index;for(e=a.istate.marker;b!=0&&e<4;){a.next_in[c]==mark[e]?e++:e=a.next_in[c]!=0?0:4-e;c++;b--}a.total_in=a.total_in+(c-a.next_in_index);a.next_in_index=c;a.avail_in=b;a.istate.marker=e;if(e!=4)return Z_DATA_ERROR;b=a.total_in;c=a.total_out;this.inflateReset(a);a.total_in=b;a.total_out=
c;a.istate.mode=BLOCKS;return Z_OK};Inflate.prototype.inflateSyncPoint=function(a){return a==null||a.istate==null||a.istate.blocks==null?Z_STREAM_ERROR:a.istate.blocks.sync_point()};var INFBLOCKS_BORDER=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];
function InfBlocks(a,b,c){this.hufts=new Int32Array(MANY*3);this.window=new Uint8Array(c);this.end=c;this.checkfn=b;this.mode=IB_TYPE;this.reset(a,null);this.index=this.table=this.left=0;this.blens=null;this.bb=new Int32Array(1);this.tb=new Int32Array(1);this.codes=new InfCodes;this.check=this.write=this.read=this.bitb=this.bitk=this.last=0;this.inftree=new InfTree}
InfBlocks.prototype.reset=function(a,b){if(b)b[0]=this.check;this.mode==IB_CODES&&this.codes.free(a);this.mode=IB_TYPE;this.read=this.write=this.bitb=this.bitk=0;if(this.checkfn)a.adler=this.check=a._adler.adler32(0,null,0,0)};
InfBlocks.prototype.proc=function(a,b){var c,e,d,f,h,g,j;f=a.next_in_index;h=a.avail_in;e=this.bitb;d=this.bitk;g=this.write;for(j=g<this.read?this.read-g-1:this.end-g;;)switch(this.mode){case IB_TYPE:for(;d<3;){if(h!=0)b=Z_OK;else{this.bitb=e;this.bitk=d;a.avail_in=h;a.total_in=a.total_in+(f-a.next_in_index);a.next_in_index=f;this.write=g;return this.inflate_flush(a,b)}h--;e=e|(a.next_in[f++]&255)<<d;d=d+8}c=e&7;this.last=c&1;switch(c>>>1){case 0:e=e>>>3;d=d-3;c=d&7;e=e>>>c;d=d-c;this.mode=IB_LENS;
break;case 1:var m=new Int32Array(1),u=new Int32Array(1),s=[],o=[];inflate_trees_fixed(m,u,s,o,a);this.codes.init(m[0],u[0],s[0],0,o[0],0,a);e=e>>>3;d=d-3;this.mode=IB_CODES;break;case 2:e=e>>>3;d=d-3;this.mode=IB_TABLE;break;case 3:e=e>>>3;d=d-3;this.mode=BAD;a.msg="invalid block type";b=Z_DATA_ERROR;this.bitb=e;this.bitk=d;a.avail_in=h;a.total_in=a.total_in+(f-a.next_in_index);a.next_in_index=f;this.write=g;return this.inflate_flush(a,b)}break;case IB_LENS:for(;d<32;){if(h!=0)b=Z_OK;else{this.bitb=
e;this.bitk=d;a.avail_in=h;a.total_in=a.total_in+(f-a.next_in_index);a.next_in_index=f;this.write=g;return this.inflate_flush(a,b)}h--;e=e|(a.next_in[f++]&255)<<d;d=d+8}if((~e>>>16&65535)!=(e&65535)){this.mode=BAD;a.msg="invalid stored block lengths";b=Z_DATA_ERROR;this.bitb=e;this.bitk=d;a.avail_in=h;a.total_in=a.total_in+(f-a.next_in_index);a.next_in_index=f;this.write=g;return this.inflate_flush(a,b)}this.left=e&65535;e=d=0;this.mode=left!=0?IB_STORED:this.last!=0?IB_DRY:IB_TYPE;break;case IB_STORED:if(h==
0){this.bitb=e;this.bitk=d;a.avail_in=h;a.total_in=a.total_in+(f-a.next_in_index);a.next_in_index=f;write=g;return this.inflate_flush(a,b)}if(j==0){if(g==end&&read!=0){g=0;j=g<this.read?this.read-g-1:this.end-g}if(j==0){this.write=g;b=this.inflate_flush(a,b);g=this.write;j=g<this.read?this.read-g-1:this.end-g;if(g==this.end&&this.read!=0){g=0;j=g<this.read?this.read-g-1:this.end-g}if(j==0){this.bitb=e;this.bitk=d;a.avail_in=h;a.total_in=a.total_in+(f-a.next_in_index);a.next_in_index=f;this.write=
g;return this.inflate_flush(a,b)}}}b=Z_OK;c=this.left;c>h&&(c=h);c>j&&(c=j);arrayCopy(a.next_in,f,window,g,c);f=f+c;h=h-c;g=g+c;j=j-c;if((this.left=this.left-c)!=0)break;this.mode=this.last!=0?IB_DRY:IB_TYPE;break;case IB_TABLE:for(;d<14;){if(h!=0)b=Z_OK;else{this.bitb=e;this.bitk=d;a.avail_in=h;a.total_in=a.total_in+(f-a.next_in_index);a.next_in_index=f;this.write=g;return this.inflate_flush(a,b)}h--;e=e|(a.next_in[f++]&255)<<d;d=d+8}this.table=c=e&16383;if((c&31)>29||(c>>5&31)>29){this.mode=IB_BAD;
a.msg="too many length or distance symbols";b=Z_DATA_ERROR;this.bitb=e;this.bitk=d;a.avail_in=h;a.total_in=a.total_in+(f-a.next_in_index);a.next_in_index=f;this.write=g;return this.inflate_flush(a,b)}c=258+(c&31)+(c>>5&31);if(this.blens==null||this.blens.length<c)this.blens=new Int32Array(c);else for(j=0;j<c;j++)this.blens[j]=0;e=e>>>14;d=d-14;this.index=0;mode=IB_BTREE;case IB_BTREE:for(;this.index<4+(this.table>>>10);){for(;d<3;){if(h!=0)b=Z_OK;else{this.bitb=e;this.bitk=d;a.avail_in=h;a.total_in=
a.total_in+(f-a.next_in_index);a.next_in_index=f;this.write=g;return this.inflate_flush(a,b)}h--;e=e|(a.next_in[f++]&255)<<d;d=d+8}this.blens[INFBLOCKS_BORDER[this.index++]]=e&7;e=e>>>3;d=d-3}for(;this.index<19;)this.blens[INFBLOCKS_BORDER[this.index++]]=0;this.bb[0]=7;c=this.inftree.inflate_trees_bits(this.blens,this.bb,this.tb,this.hufts,a);if(c!=Z_OK){b=c;if(b==Z_DATA_ERROR){this.blens=null;this.mode=IB_BAD}this.bitb=e;this.bitk=d;a.avail_in=h;a.total_in=a.total_in+(f-a.next_in_index);a.next_in_index=
f;write=g;return this.inflate_flush(a,b)}this.index=0;this.mode=IB_DTREE;case IB_DTREE:for(;;){c=this.table;if(!(this.index<258+(c&31)+(c>>5&31)))break;for(c=this.bb[0];d<c;){if(h!=0)b=Z_OK;else{this.bitb=e;this.bitk=d;a.avail_in=h;a.total_in=a.total_in+(f-a.next_in_index);a.next_in_index=f;this.write=g;return this.inflate_flush(a,b)}h--;e=e|(a.next_in[f++]&255)<<d;d=d+8}c=this.hufts[(this.tb[0]+(e&inflate_mask[c]))*3+1];u=this.hufts[(this.tb[0]+(e&inflate_mask[c]))*3+2];if(u<16){e=e>>>c;d=d-c;this.blens[this.index++]=
u}else{j=u==18?7:u-14;for(m=u==18?11:3;d<c+j;){if(h!=0)b=Z_OK;else{this.bitb=e;this.bitk=d;a.avail_in=h;a.total_in=a.total_in+(f-a.next_in_index);a.next_in_index=f;this.write=g;return this.inflate_flush(a,b)}h--;e=e|(a.next_in[f++]&255)<<d;d=d+8}e=e>>>c;d=d-c;m=m+(e&inflate_mask[j]);e=e>>>j;d=d-j;j=this.index;c=this.table;if(j+m>258+(c&31)+(c>>5&31)||u==16&&j<1){this.blens=null;this.mode=IB_BAD;a.msg="invalid bit length repeat";b=Z_DATA_ERROR;this.bitb=e;this.bitk=d;a.avail_in=h;a.total_in=a.total_in+
(f-a.next_in_index);a.next_in_index=f;this.write=g;return this.inflate_flush(a,b)}u=u==16?this.blens[j-1]:0;do this.blens[j++]=u;while(--m!=0);this.index=j}}this.tb[0]=-1;m=new Int32Array(1);u=new Int32Array(1);s=new Int32Array(1);o=new Int32Array(1);m[0]=9;u[0]=6;c=this.table;c=this.inftree.inflate_trees_dynamic(257+(c&31),1+(c>>5&31),this.blens,m,u,s,o,this.hufts,a);if(c!=Z_OK){if(c==Z_DATA_ERROR){this.blens=null;this.mode=BAD}b=c;this.bitb=e;this.bitk=d;a.avail_in=h;a.total_in=a.total_in+(f-a.next_in_index);
a.next_in_index=f;this.write=g;return this.inflate_flush(a,b)}this.codes.init(m[0],u[0],this.hufts,s[0],this.hufts,o[0],a);this.mode=IB_CODES;case IB_CODES:this.bitb=e;this.bitk=d;a.avail_in=h;a.total_in=a.total_in+(f-a.next_in_index);a.next_in_index=f;this.write=g;if((b=this.codes.proc(this,a,b))!=Z_STREAM_END)return this.inflate_flush(a,b);b=Z_OK;this.codes.free(a);f=a.next_in_index;h=a.avail_in;e=this.bitb;d=this.bitk;g=this.write;j=g<this.read?this.read-g-1:this.end-g;if(this.last==0){this.mode=
IB_TYPE;break}this.mode=IB_DRY;case IB_DRY:this.write=g;b=this.inflate_flush(a,b);g=this.write;if(this.read!=this.write){this.bitb=e;this.bitk=d;a.avail_in=h;a.total_in=a.total_in+(f-a.next_in_index);a.next_in_index=f;this.write=g;return this.inflate_flush(a,b)}mode=DONE;case IB_DONE:b=Z_STREAM_END;this.bitb=e;this.bitk=d;a.avail_in=h;a.total_in=a.total_in+(f-a.next_in_index);a.next_in_index=f;this.write=g;return this.inflate_flush(a,b);case IB_BAD:b=Z_DATA_ERROR;this.bitb=e;this.bitk=d;a.avail_in=
h;a.total_in=a.total_in+(f-a.next_in_index);a.next_in_index=f;this.write=g;return this.inflate_flush(a,b);default:b=Z_STREAM_ERROR;this.bitb=e;this.bitk=d;a.avail_in=h;a.total_in=a.total_in+(f-a.next_in_index);a.next_in_index=f;this.write=g;return this.inflate_flush(a,b)}};InfBlocks.prototype.free=function(a){this.reset(a,null);this.hufts=this.window=null};InfBlocks.prototype.set_dictionary=function(a,b,c){arrayCopy(a,b,window,0,c);this.read=this.write=c};
InfBlocks.prototype.sync_point=function(){return this.mode==IB_LENS};
InfBlocks.prototype.inflate_flush=function(a,b){var c,e,d;e=a.next_out_index;d=this.read;c=(d<=this.write?this.write:this.end)-d;if(c>a.avail_out)c=a.avail_out;c!=0&&b==Z_BUF_ERROR&&(b=Z_OK);a.avail_out=a.avail_out-c;a.total_out=a.total_out+c;if(this.checkfn!=null)a.adler=this.check=a._adler.adler32(this.check,this.window,d,c);arrayCopy(this.window,d,a.next_out,e,c);e=e+c;d=d+c;if(d==this.end){d=0;if(this.write==this.end)this.write=0;c=this.write-d;if(c>a.avail_out)c=a.avail_out;c!=0&&b==Z_BUF_ERROR&&
(b=Z_OK);a.avail_out=a.avail_out-c;a.total_out=a.total_out+c;if(this.checkfn!=null)a.adler=this.check=a._adler.adler32(this.check,this.window,d,c);arrayCopy(this.window,d,a.next_out,e,c);e=e+c;d=d+c}a.next_out_index=e;this.read=d;return b};var IC_START=0,IC_LEN=1,IC_LENEXT=2,IC_DIST=3,IC_DISTEXT=4,IC_COPY=5,IC_LIT=6,IC_WASH=7,IC_END=8,IC_BADCODE=9;function InfCodes(){}
InfCodes.prototype.init=function(a,b,c,e,d,f){this.mode=IC_START;this.lbits=a;this.dbits=b;this.ltree=c;this.ltree_index=e;this.dtree=d;this.dtree_index=f;this.tree=null};
InfCodes.prototype.proc=function(a,b,c){var e,d,f=0,h=0,g=0,j,m,u,g=b.next_in_index;j=b.avail_in;f=a.bitb;h=a.bitk;m=a.write;for(u=m<a.read?a.read-m-1:a.end-m;;)switch(this.mode){case IC_START:if(u>=258&&j>=10){a.bitb=f;a.bitk=h;b.avail_in=j;b.total_in=b.total_in+(g-b.next_in_index);b.next_in_index=g;a.write=m;c=this.inflate_fast(this.lbits,this.dbits,this.ltree,this.ltree_index,this.dtree,this.dtree_index,a,b);g=b.next_in_index;j=b.avail_in;f=a.bitb;h=a.bitk;m=a.write;u=m<a.read?a.read-m-1:a.end-
m;if(c!=Z_OK){this.mode=c==Z_STREAM_END?IC_WASH:IC_BADCODE;break}}this.need=this.lbits;this.tree=this.ltree;this.tree_index=this.ltree_index;this.mode=IC_LEN;case IC_LEN:for(e=this.need;h<e;){if(j!=0)c=Z_OK;else{a.bitb=f;a.bitk=h;b.avail_in=j;b.total_in=b.total_in+(g-b.next_in_index);b.next_in_index=g;a.write=m;return a.inflate_flush(b,c)}j--;f=f|(b.next_in[g++]&255)<<h;h=h+8}e=(this.tree_index+(f&inflate_mask[e]))*3;f=f>>>this.tree[e+1];h=h-this.tree[e+1];d=this.tree[e];if(d==0){this.lit=this.tree[e+
2];this.mode=IC_LIT;break}if((d&16)!=0){this.get=d&15;this.len=this.tree[e+2];this.mode=IC_LENEXT;break}if((d&64)==0){this.need=d;this.tree_index=e/3+this.tree[e+2];break}if((d&32)!=0){this.mode=IC_WASH;break}this.mode=IC_BADCODE;b.msg="invalid literal/length code";c=Z_DATA_ERROR;a.bitb=f;a.bitk=h;b.avail_in=j;b.total_in=b.total_in+(g-b.next_in_index);b.next_in_index=g;a.write=m;return a.inflate_flush(b,c);case IC_LENEXT:for(e=this.get;h<e;){if(j!=0)c=Z_OK;else{a.bitb=f;a.bitk=h;b.avail_in=j;b.total_in=
b.total_in+(g-b.next_in_index);b.next_in_index=g;a.write=m;return a.inflate_flush(b,c)}j--;f=f|(b.next_in[g++]&255)<<h;h=h+8}this.len=this.len+(f&inflate_mask[e]);f=f>>e;h=h-e;this.need=this.dbits;this.tree=this.dtree;this.tree_index=this.dtree_index;this.mode=IC_DIST;case IC_DIST:for(e=this.need;h<e;){if(j!=0)c=Z_OK;else{a.bitb=f;a.bitk=h;b.avail_in=j;b.total_in=b.total_in+(g-b.next_in_index);b.next_in_index=g;a.write=m;return a.inflate_flush(b,c)}j--;f=f|(b.next_in[g++]&255)<<h;h=h+8}e=(this.tree_index+
(f&inflate_mask[e]))*3;f=f>>this.tree[e+1];h=h-this.tree[e+1];d=this.tree[e];if((d&16)!=0){this.get=d&15;this.dist=this.tree[e+2];this.mode=IC_DISTEXT;break}if((d&64)==0){this.need=d;this.tree_index=e/3+this.tree[e+2];break}this.mode=IC_BADCODE;b.msg="invalid distance code";c=Z_DATA_ERROR;a.bitb=f;a.bitk=h;b.avail_in=j;b.total_in=b.total_in+(g-b.next_in_index);b.next_in_index=g;a.write=m;return a.inflate_flush(b,c);case IC_DISTEXT:for(e=this.get;h<e;){if(j!=0)c=Z_OK;else{a.bitb=f;a.bitk=h;b.avail_in=
j;b.total_in=b.total_in+(g-b.next_in_index);b.next_in_index=g;a.write=m;return a.inflate_flush(b,c)}j--;f=f|(b.next_in[g++]&255)<<h;h=h+8}this.dist=this.dist+(f&inflate_mask[e]);f=f>>e;h=h-e;this.mode=IC_COPY;case IC_COPY:for(e=m-this.dist;e<0;)e=e+a.end;for(;this.len!=0;){if(u==0){if(m==a.end&&a.read!=0){m=0;u=m<a.read?a.read-m-1:a.end-m}if(u==0){a.write=m;c=a.inflate_flush(b,c);m=a.write;u=m<a.read?a.read-m-1:a.end-m;if(m==a.end&&a.read!=0){m=0;u=m<a.read?a.read-m-1:a.end-m}if(u==0){a.bitb=f;a.bitk=
h;b.avail_in=j;b.total_in=b.total_in+(g-b.next_in_index);b.next_in_index=g;a.write=m;return a.inflate_flush(b,c)}}}a.window[m++]=a.window[e++];u--;e==a.end&&(e=0);this.len--}this.mode=IC_START;break;case IC_LIT:if(u==0){if(m==a.end&&a.read!=0){m=0;u=m<a.read?a.read-m-1:a.end-m}if(u==0){a.write=m;c=a.inflate_flush(b,c);m=a.write;u=m<a.read?a.read-m-1:a.end-m;if(m==a.end&&a.read!=0){m=0;u=m<a.read?a.read-m-1:a.end-m}if(u==0){a.bitb=f;a.bitk=h;b.avail_in=j;b.total_in=b.total_in+(g-b.next_in_index);b.next_in_index=
g;a.write=m;return a.inflate_flush(b,c)}}}c=Z_OK;a.window[m++]=this.lit;u--;this.mode=IC_START;break;case IC_WASH:if(h>7){h=h-8;j++;g--}a.write=m;c=a.inflate_flush(b,c);m=a.write;if(a.read!=a.write){a.bitb=f;a.bitk=h;b.avail_in=j;b.total_in=b.total_in+(g-b.next_in_index);b.next_in_index=g;a.write=m;return a.inflate_flush(b,c)}this.mode=IC_END;case IC_END:c=Z_STREAM_END;a.bitb=f;a.bitk=h;b.avail_in=j;b.total_in=b.total_in+(g-b.next_in_index);b.next_in_index=g;a.write=m;return a.inflate_flush(b,c);
case IC_BADCODE:c=Z_DATA_ERROR;a.bitb=f;a.bitk=h;b.avail_in=j;b.total_in=b.total_in+(g-b.next_in_index);b.next_in_index=g;a.write=m;return a.inflate_flush(b,c);default:c=Z_STREAM_ERROR;a.bitb=f;a.bitk=h;b.avail_in=j;b.total_in=b.total_in+(g-b.next_in_index);b.next_in_index=g;a.write=m;return a.inflate_flush(b,c)}};InfCodes.prototype.free=function(){};
InfCodes.prototype.inflate_fast=function(a,b,c,e,d,f,h,g){var j,m,u,s,o,p,r,w,v,t,q,z;p=g.next_in_index;r=g.avail_in;s=h.bitb;o=h.bitk;w=h.write;v=w<h.read?h.read-w-1:h.end-w;a=inflate_mask[a];t=inflate_mask[b];do{for(;o<20;){r--;s=s|(g.next_in[p++]&255)<<o;o=o+8}j=s&a;m=c;u=e;z=(u+j)*3;if((b=m[z])==0){s=s>>m[z+1];o=o-m[z+1];h.window[w++]=m[z+2];v--}else{do{s=s>>m[z+1];o=o-m[z+1];if((b&16)!=0){b=b&15;q=m[z+2]+(s&inflate_mask[b]);s=s>>b;for(o=o-b;o<15;){r--;s=s|(g.next_in[p++]&255)<<o;o=o+8}j=s&t;
m=d;u=f;z=(u+j)*3;b=m[z];do{s=s>>m[z+1];o=o-m[z+1];if((b&16)!=0){for(b=b&15;o<b;){r--;s=s|(g.next_in[p++]&255)<<o;o=o+8}j=m[z+2]+(s&inflate_mask[b]);s=s>>b;o=o-b;v=v-q;if(w>=j){j=w-j;if(w-j>0&&2>w-j){h.window[w++]=h.window[j++];h.window[w++]=h.window[j++]}else{arrayCopy(h.window,j,h.window,w,2);w=w+2;j=j+2}q=q-2}else{j=w-j;do j=j+h.end;while(j<0);b=h.end-j;if(q>b){q=q-b;if(w-j>0&&b>w-j){do h.window[w++]=h.window[j++];while(--b!=0)}else{arrayCopy(h.window,j,h.window,w,b);w=w+b}j=0}}if(w-j>0&&q>w-j){do h.window[w++]=
h.window[j++];while(--q!=0)}else{arrayCopy(h.window,j,h.window,w,q);w=w+q}break}else if((b&64)==0){j=j+m[z+2];j=j+(s&inflate_mask[b]);z=(u+j)*3;b=m[z]}else{g.msg="invalid distance code";q=g.avail_in-r;q=o>>3<q?o>>3:q;r=r+q;p=p-q;o=o-(q<<3);h.bitb=s;h.bitk=o;g.avail_in=r;g.total_in=g.total_in+(p-g.next_in_index);g.next_in_index=p;h.write=w;return Z_DATA_ERROR}}while(1);break}if((b&64)==0){j=j+m[z+2];j=j+(s&inflate_mask[b]);z=(u+j)*3;if((b=m[z])==0){s=s>>m[z+1];o=o-m[z+1];h.window[w++]=m[z+2];v--;break}}else{if((b&
32)!=0){q=g.avail_in-r;q=o>>3<q?o>>3:q;r=r+q;p=p-q;o=o-(q<<3);h.bitb=s;h.bitk=o;g.avail_in=r;g.total_in=g.total_in+(p-g.next_in_index);g.next_in_index=p;h.write=w;return Z_STREAM_END}g.msg="invalid literal/length code";q=g.avail_in-r;q=o>>3<q?o>>3:q;r=r+q;p=p-q;o=o-(q<<3);h.bitb=s;h.bitk=o;g.avail_in=r;g.total_in=g.total_in+(p-g.next_in_index);g.next_in_index=p;h.write=w;return Z_DATA_ERROR}}while(1)}}while(v>=258&&r>=10);q=g.avail_in-r;q=o>>3<q?o>>3:q;p=p-q;h.bitb=s;h.bitk=o-(q<<3);g.avail_in=r+
q;g.total_in=g.total_in+(p-g.next_in_index);g.next_in_index=p;h.write=w;return Z_OK};function InfTree(){}
InfTree.prototype.huft_build=function(a,b,c,e,d,f,h,g,j,m,u){var s,o,p,r,w,v,t,q,z;v=0;o=c;do{this.c[a[b+v]]++;v++;o--}while(o!=0);if(this.c[0]==c){h[0]=-1;g[0]=0;return Z_OK}w=g[0];for(p=1;p<=BMAX;p++)if(this.c[p]!=0)break;r=p;w<p&&(w=p);for(o=BMAX;o!=0;o--)if(this.c[o]!=0)break;m=o;w>o&&(w=o);g[0]=w;for(g=1<<p;p<o;p++,g=g<<1)if((g=g-this.c[p])<0)return Z_DATA_ERROR;if((g=g-this.c[o])<0)return Z_DATA_ERROR;this.c[o]=this.c[o]+g;this.x[1]=p=0;v=1;for(t=2;--o!=0;){this.x[t]=p=p+this.c[v];t++;v++}v=
o=0;do{if((p=a[b+v])!=0)this.v[this.x[p]++]=o;v++}while(++o<c);c=this.x[m];v=this.x[0]=o=0;b=-1;q=-w;for(z=t=this.u[0]=0;r<=m;r++)for(a=this.c[r];a--!=0;){for(;r>q+w;){b++;q=q+w;z=m-q;z=z>w?w:z;if((s=1<<(p=r-q))>a+1){s=s-(a+1);t=r;if(p<z)for(;++p<z;){if((s=s<<1)<=this.c[++t])break;s=s-this.c[t]}}z=1<<p;if(this.hn[0]+z>MANY)return Z_DATA_ERROR;this.u[b]=t=this.hn[0];this.hn[0]=this.hn[0]+z;if(b!=0){this.x[b]=o;this.r[0]=p;this.r[1]=w;p=o>>>q-w;this.r[2]=t-this.u[b-1]-p;arrayCopy(this.r,0,j,(this.u[b-
1]+p)*3,3)}else h[0]=t}this.r[1]=r-q;if(v>=c)this.r[0]=192;else if(u[v]<e){this.r[0]=this.v[v]<256?0:96;this.r[2]=this.v[v++]}else{this.r[0]=f[this.v[v]-e]+16+64;this.r[2]=d[this.v[v++]-e]}s=1<<r-q;for(p=o>>>q;p<z;p=p+s)arrayCopy(this.r,0,j,(t+p)*3,3);for(p=1<<r-1;(o&p)!=0;p=p>>>1)o=o^p;o=o^p;for(p=(1<<q)-1;(o&p)!=this.x[b];){b--;q=q-w;p=(1<<q)-1}}return g!=0&&m!=1?Z_BUF_ERROR:Z_OK};
InfTree.prototype.inflate_trees_bits=function(a,b,c,e,d){this.initWorkArea(19);this.hn[0]=0;a=this.huft_build(a,0,19,19,null,null,c,b,e,this.hn,this.v);if(a==Z_DATA_ERROR)d.msg="oversubscribed dynamic bit lengths tree";else if(a==Z_BUF_ERROR||b[0]==0){d.msg="incomplete dynamic bit lengths tree";a=Z_DATA_ERROR}return a};
InfTree.prototype.inflate_trees_dynamic=function(a,b,c,e,d,f,h,g,j){this.initWorkArea(288);this.hn[0]=0;f=this.huft_build(c,0,a,257,cplens,cplext,f,e,g,this.hn,this.v);if(f!=Z_OK||e[0]==0){if(f==Z_DATA_ERROR)j.msg="oversubscribed literal/length tree";else if(f!=Z_MEM_ERROR){j.msg="incomplete literal/length tree";f=Z_DATA_ERROR}return f}this.initWorkArea(288);f=this.huft_build(c,a,b,0,cpdist,cpdext,h,d,g,this.hn,this.v);if(f!=Z_OK||d[0]==0&&a>257){if(f==Z_DATA_ERROR)j.msg="oversubscribed distance tree";
else if(f==Z_BUF_ERROR){j.msg="incomplete distance tree";f=Z_DATA_ERROR}else if(f!=Z_MEM_ERROR){j.msg="empty distance tree with lengths";f=Z_DATA_ERROR}return f}return Z_OK};function inflate_trees_fixed(a,b,c,e){a[0]=fixed_bl;b[0]=fixed_bd;c[0]=fixed_tl;e[0]=fixed_td;return Z_OK}
InfTree.prototype.initWorkArea=function(a){if(this.hn==null){this.hn=new Int32Array(1);this.v=new Int32Array(a);this.c=new Int32Array(BMAX+1);this.r=new Int32Array(3);this.u=new Int32Array(BMAX);this.x=new Int32Array(BMAX+1)}if(this.v.length<a)this.v=new Int32Array(a);for(var b=0;b<a;b++)this.v[b]=0;for(b=0;b<BMAX+1;b++)this.c[b]=0;for(b=0;b<3;b++)this.r[b]=0;arrayCopy(this.c,0,this.u,0,BMAX);arrayCopy(this.c,0,this.x,0,BMAX+1)};
var testArray=new Uint8Array(1),hasSubarray="function"===typeof testArray.subarray,hasSlice=!1;function arrayCopy(a,b,c,e,d){if(d!=0){if(a){if(!c)throw"Undef dest";}else throw"Undef src";b==0&&d==a.length?arrayCopy_fast(a,c,e):hasSubarray?arrayCopy_fast(a.subarray(b,b+d),c,e):a.BYTES_PER_ELEMENT==1&&d>100?arrayCopy_fast(new Uint8Array(a.buffer,a.byteOffset+b,d),c,e):arrayCopy_slow(a,b,c,e,d)}}function arrayCopy_slow(a,b,c,e,d){for(var f=0;f<d;++f)c[e+f]=a[b+f]}
function arrayCopy_fast(a,b,c){b.set(a,c)}var ADLER_BASE=65521,ADLER_NMAX=5552;
function adler32(a,b,c,e){if(b==null)return 1;for(var d=a&65535,a=a>>16&65535,f;e>0;){f=e<ADLER_NMAX?e:ADLER_NMAX;for(e=e-f;f>=16;){d=d+(b[c++]&255);a=a+d;d=d+(b[c++]&255);a=a+d;d=d+(b[c++]&255);a=a+d;d=d+(b[c++]&255);a=a+d;d=d+(b[c++]&255);a=a+d;d=d+(b[c++]&255);a=a+d;d=d+(b[c++]&255);a=a+d;d=d+(b[c++]&255);a=a+d;d=d+(b[c++]&255);a=a+d;d=d+(b[c++]&255);a=a+d;d=d+(b[c++]&255);a=a+d;d=d+(b[c++]&255);a=a+d;d=d+(b[c++]&255);a=a+d;d=d+(b[c++]&255);a=a+d;d=d+(b[c++]&255);a=a+d;d=d+(b[c++]&255);a=a+d;f=
f-16}if(f!=0){do{d=d+(b[c++]&255);a=a+d}while(--f!=0)}d=d%ADLER_BASE;a=a%ADLER_BASE}return a<<16|d}
function jszlib_inflate_buffer(a,b,c,e){a=b?new Uint8Array(a,b,c):new Uint8Array(a);c=new ZStream;c.inflateInit(DEF_WBITS,true);c.next_in=a;c.next_in_index=0;c.avail_in=a.length;for(var a=[],d=0;;){var f=new Uint8Array(32E3);c.next_out=f;c.next_out_index=0;c.avail_out=f.length;var h=c.inflate(Z_NO_FLUSH);if(h!=Z_OK&&h!=Z_STREAM_END)throw c.msg;if(c.avail_out!=0){var g=new Uint8Array(f.length-c.avail_out);arrayCopy(f,0,g,0,f.length-c.avail_out);f=g}a.push(f);d=d+f.length;if(h==Z_STREAM_END)break}e&&
(e[0]=(b||0)+c.next_in_index);if(a.length==1)return a[0].buffer;b=new Uint8Array(d);for(c=e=0;c<a.length;++c){d=a[c];arrayCopy(d,0,b,e,d.length);e=e+d.length}return b.buffer};
